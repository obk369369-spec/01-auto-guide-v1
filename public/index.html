<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>1번 고객 자동화 안내서 · WIC Guide Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f5f7;
      color: #222;
    }
    header {
      background: #1f2937;
      color: #fff;
      padding: 16px 24px;
    }
    header h1 {
      margin: 0;
      font-size: 20px;
    }
    header p {
      margin: 4px 0 0;
      font-size: 13px;
      opacity: 0.9;
    }
    main {
      padding: 16px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .grid {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 16px;
    }
    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
    .card {
      background: #fff;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      box-sizing: border-box;
    }
    .card h2 {
      margin: 0 0 8px;
      font-size: 16px;
    }
    .card h3 {
      margin: 12px 0 6px;
      font-size: 14px;
    }
    label {
      font-size: 13px;
      display: block;
      margin-bottom: 4px;
    }
    input[type="text"],
    input[type="email"],
    input[type="file"],
    select,
    textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 13px;
    }
    textarea {
      min-height: 80px;
      resize: vertical;
    }
    .row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }
    .row > div {
      flex: 1;
    }
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      background: #e5e7eb;
      color: #374151;
      margin-left: 4px;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      cursor: pointer;
      background: #2563eb;
      color: white;
      gap: 6px;
    }
    .btn.sub {
      background: #6b7280;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: default;
    }
    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .status-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 12px;
      margin-top: 8px;
      color: #4b5563;
    }
    .status-pill {
      padding: 4px 8px;
      border-radius: 999px;
      background: #e5e7eb;
    }
    .status-pill.ok {
      background: #dcfce7;
      color: #166534;
    }
    .status-pill.warn {
      background: #fef3c7;
      color: #92400e;
    }
    .status-pill.err {
      background: #fee2e2;
      color: #b91c1c;
    }
    .preview-box {
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      padding: 10px;
      background: #f9fafb;
      font-size: 13px;
      white-space: pre-wrap;
    }
    .log-list {
      max-height: 220px;
      overflow-y: auto;
      font-size: 12px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      padding: 8px;
      background: #f9fafb;
    }
    .log-item {
      padding: 4px 0;
      border-bottom: 1px solid #e5e7eb;
    }
    .log-item:last-child {
      border-bottom: none;
    }
    .log-meta {
      font-size: 11px;
      color: #6b7280;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    .pill {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e5e7eb;
      cursor: default;
    }
    footer {
      padding: 10px 16px 16px;
      font-size: 11px;
      color: #6b7280;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <h1>1번 고객 자동화 안내서 · Guide Generator</h1>
    <p>오프라인/온라인 고객 데이터를 읽고 · 고객별 워드 안내서를 만들고 · 메일 연동 후 반응 기반 사후 조치까지 한 흐름으로 관리합니다.</p>
  </header>

  <main>
    <div class="grid">
      <!-- 왼쪽: 데이터·템플릿 설정 -->
      <section class="card">
        <h2>① 고객 데이터 · 템플릿 설정</h2>

        <h3>고객 데이터 가져오기 <span class="badge">필수</span></h3>
        <div class="row">
          <div>
            <label>오프라인 엑셀 / CSV 업로드</label>
            <input type="file" id="fileInput" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>온라인 고객 DB 주소(예: API / 시트 링크)</label>
            <input type="text" id="onlineSource" placeholder="https://... 또는 내부 API 주소" />
          </div>
        </div>

        <h3>안내서 템플릿 선택</h3>
        <div class="row">
          <div>
            <label>기본 템플릿</label>
            <select id="templateSelect">
              <option value="basic">기본 안내서 (연구비·관심분야 중심)</option>
              <option value="renewal">재구매/갱신 안내서</option>
              <option value="new-report">신규 보고서 추천 안내서</option>
            </select>
          </div>
          <div>
            <label>언어</label>
            <select id="langSelect">
              <option value="ko">한국어</option>
              <option value="en">영어</option>
              <option value="ja">일본어</option>
            </select>
          </div>
        </div>

        <h3>메일 연동 설정</h3>
        <div class="row">
          <div>
            <label>발신 이메일(예: Thunderbird 계정)</label>
            <input type="email" id="fromEmail" placeholder="sender@example.com" />
          </div>
          <div>
            <label>연동 방식(예시)</label>
            <select id="mailMode">
              <option value="export">워드/EML 파일로 내보내기</option>
              <option value="api">메일 API로 직접 보내기(추후)</option>
            </select>
          </div>
        </div>

        <h3>사후 조치 규칙(반응별)</h3>
        <label>간단 규칙 설명(예: “구매 문의 = A등급 / 열람만 = B등급”)</label>
        <textarea id="followupRule" placeholder="예) 메일 회신·클릭·열람 기록에 따라 A/B/C 등급으로 나누고, A: 전화, B: 추가 메일, C: 분기별 안내만 보냄."></textarea>

        <div class="btn-row">
          <button class="btn" id="btnLoadDummy">테스트용 더미 고객 불러오기</button>
          <button class="btn sub" id="btnQuickGenerate">선택 고객 1명 미리보기 생성</button>
        </div>

        <div class="status-bar" id="leftStatus">
          <span class="status-pill">데이터: 0명</span>
          <span class="status-pill">템플릿: 기본</span>
          <span class="status-pill warn">메일 연동: 준비 중</span>
        </div>
      </section>

      <!-- 오른쪽: 미리보기 · 로그 -->
      <section class="card">
        <h2>② 안내서 미리보기 · 발송·사후 조치 요약</h2>

        <h3>고객 선택</h3>
        <div class="row">
          <div>
            <label>고객 선택</label>
            <select id="customerSelect">
              <option value="">먼저 데이터를 불러오세요.</option>
            </select>
          </div>
        </div>

        <h3>안내서 미리보기</h3>
        <div class="preview-box" id="previewBox">
안내서 미리보기 영역입니다.
고객 데이터를 불러오고, 고객을 선택한 뒤 “미리보기 생성”을 누르면 이곳에 내용이 나타납니다.
        </div>

        <div class="btn-row">
          <button class="btn" id="btnGenerate">선택 고객 안내서 미리보기</button>
          <button class="btn sub" id="btnExportWord">워드/EML로 내보내기(예시)</button>
          <button class="btn sub" id="btnMarkFollowup">사후 조치 상태 기록(예시)</button>
        </div>

        <div class="pill-row">
          <span class="pill" id="pillCustomer">고객: -</span>
          <span class="pill" id="pillTemplate">템플릿: -</span>
          <span class="pill" id="pillLang">언어: -</span>
          <span class="pill" id="pillFollowup">사후 조치: -</span>
        </div>

        <h3 style="margin-top:14px;">발송·사후 조치 로그(예시)</h3>
        <div class="log-list" id="logList">
          <div class="log-item">
            <div>로그가 여기에 시간순으로 쌓입니다. (예시 레코드)</div>
            <div class="log-meta">시간: --:-- · 고객: - · 상태: 안내서 생성 완료(예시)</div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    이 파일은 1번 고객 자동화 안내서 도구의 <strong>화면 뼈대(index.html)</strong>입니다.
    실제 고객 DB·메일 연동·사후 조치 로직은 나중에 공통 자동화 엔진 규칙에 따라 한 단계씩 연결할 수 있습니다.
  </footer>

  <script>
    // 아주 간단한 더미 데이터와 상태 관리 (테스트용)
    const state = {
      customers: [],
      selectedCustomerId: null,
      template: 'basic',
      lang: 'ko',
      followupRule: '',
    };

    const fileInput = document.getElementById('fileInput');
    const onlineSource = document.getElementById('onlineSource');
    const templateSelect = document.getElementById('templateSelect');
    const langSelect = document.getElementById('langSelect');
    const fromEmail = document.getElementById('fromEmail');
    const mailMode = document.getElementById('mailMode');
    const followupRule = document.getElementById('followupRule');

    const btnLoadDummy = document.getElementById('btnLoadDummy');
    const btnQuickGenerate = document.getElementById('btnQuickGenerate');
    const btnGenerate = document.getElementById('btnGenerate');
    const btnExportWord = document.getElementById('btnExportWord');
    const btnMarkFollowup = document.getElementById('btnMarkFollowup');

    const leftStatus = document.getElementById('leftStatus');
    const customerSelect = document.getElementById('customerSelect');
    const previewBox = document.getElementById('previewBox');
    const pillCustomer = document.getElementById('pillCustomer');
    const pillTemplate = document.getElementById('pillTemplate');
    const pillLang = document.getElementById('pillLang');
    const pillFollowup = document.getElementById('pillFollowup');
    const logList = document.getElementById('logList');

    function updateStatus() {
      leftStatus.innerHTML = '';
      const pills = [];

      pills.push(`데이터: ${state.customers.length}명`);
      const templateLabel = templateSelect.options[templateSelect.selectedIndex]?.text || '템플릿 없음';
      pills.push(`템플릿: ${templateLabel}`);
      const mailStatus =
        fromEmail.value.trim().length > 0 ? '메일 연동: 기본 설정 완료(예시)' : '메일 연동: 준비 중';
      pills.push(mailStatus);

      pills.forEach((text) => {
        const span = document.createElement('span');
        span.className = 'status-pill';
        span.textContent = text;
        leftStatus.appendChild(span);
      });
    }

    function fillCustomerSelect() {
      customerSelect.innerHTML = '';
      if (state.customers.length === 0) {
        const opt = document.createElement('option');
        opt.value = '';
        opt.textContent = '먼저 고객 데이터를 불러오세요.';
        customerSelect.appendChild(opt);
        return;
      }
      const defaultOpt = document.createElement('option');
      defaultOpt.value = '';
      defaultOpt.textContent = '고객을 선택하세요.';
      customerSelect.appendChild(defaultOpt);

      state.customers.forEach((c, idx) => {
        const opt = document.createElement('option');
        opt.value = String(idx);
        opt.textContent = `${c.name} (${c.org})`;
        customerSelect.appendChild(opt);
      });
    }

    function addLog(message, meta) {
      const item = document.createElement('div');
      item.className = 'log-item';

      const m = document.createElement('div');
      m.textContent = message;
      const mm = document.createElement('div');
      mm.className = 'log-meta';
      const time = new Date().toLocaleTimeString('ko-KR', { hour12: false });
      mm.textContent = `시간: ${time} · ${meta}`;

      item.appendChild(m);
      item.appendChild(mm);
      logList.appendChild(item);
      logList.scrollTop = logList.scrollHeight;
    }

    // 테스트용 더미 고객 데이터
    btnLoadDummy.addEventListener('click', () => {
      state.customers = [
        { name: '장박사', org: 'KRICT', field: '접착제·폴리머', email: 'jang@example.com' },
        { name: '김박사', org: 'KITECH', field: '유리기판·패키징', email: 'kim@example.com' },
      ];
      fillCustomerSelect();
      updateStatus();
      addLog('테스트용 더미 고객 2명을 불러왔습니다. (예시)', '고객: 2명 · 상태: 데이터 불러오기(예시)');
    });

    templateSelect.addEventListener('change', () => {
      state.template = templateSelect.value;
      updateStatus();
    });

    langSelect.addEventListener('change', () => {
      state.lang = langSelect.value;
      updateStatus();
    });

    followupRule.addEventListener('input', () => {
      state.followupRule = followupRule.value;
    });

    customerSelect.addEventListener('change', () => {
      state.selectedCustomerId = customerSelect.value === '' ? null : Number(customerSelect.value);
    });

    function buildPreview(customer) {
      const templateLabel = templateSelect.options[templateSelect.selectedIndex]?.text || '';
      const langLabel =
        state.lang === 'ko' ? '한국어' : state.lang === 'en' ? '영어' : '일본어';

      const lines = [];
      lines.push(`[${templateLabel}] 안내서 (언어: ${langLabel})`);
      lines.push('');
      lines.push(`수신: ${customer.name} 박사 (${customer.org})`);
      lines.push(`연구 분야: ${customer.field}`);
      lines.push('');
      lines.push('안녕하세요, 월드산업정보센터입니다.');
      lines.push('요청하신 연구 분야와 연관된 최신 보고서·기술자료를 중심으로 안내드립니다.');
      lines.push('');
      lines.push('- (예시) 추천 보고서 1');
      lines.push('- (예시) 추천 보고서 2');
      lines.push('');
      lines.push('연락을 주시면, 보다 상세한 목차·가격·구매 절차를 안내해 드리겠습니다.');
      lines.push('');
      if (state.followupRule.trim().length > 0) {
        lines.push('[사후 조치 규칙(메모)]');
        lines.push(state.followupRule.trim());
      }
      return lines.join('\n');
    }

    btnQuickGenerate.addEventListener('click', () => {
      if (state.customers.length === 0) return;
      const customer = state.customers[0];
      customerSelect.value = '0';
      state.selectedCustomerId = 0;
      const text = buildPreview(customer);
      previewBox.textContent = text;

      pillCustomer.textContent = `고객: ${customer.name} (${customer.org})`;
      pillTemplate.textContent = `템플릿: ${templateSelect.options[templateSelect.selectedIndex]?.text || ''}`;
      pillLang.textContent = `언어: ${state.lang}`;
      pillFollowup.textContent = '사후 조치: 준비 중';

      addLog('테스트용 고객 1명에 대한 안내서 미리보기를 생성했습니다. (예시)', `고객: ${customer.name} · 상태: 미리보기 생성(예시)`);
    });

    btnGenerate.addEventListener('click', () => {
      if (state.selectedCustomerId == null || isNaN(state.selectedCustomerId)) {
        alert('먼저 고객을 선택하세요.');
        return;
      }
      const customer = state.customers[state.selectedCustomerId];
      const text = buildPreview(customer);
      previewBox.textContent = text;

      pillCustomer.textContent = `고객: ${customer.name} (${customer.org})`;
      pillTemplate.textContent = `템플릿: ${templateSelect.options[templateSelect.selectedIndex]?.text || ''}`;
      pillLang.textContent = `언어: ${state.lang}`;
      pillFollowup.textContent = '사후 조치: 준비 중';

      addLog('선택 고객에 대한 안내서 미리보기를 생성했습니다. (예시)', `고객: ${customer.name} · 상태: 미리보기 생성(예시)`);
    });

    btnExportWord.addEventListener('click', () => {
      addLog('워드/EML로 내보내기 기능은 나중에 메일·워드 자동화 모듈과 연결합니다. (예시)', '상태: 내보내기 준비(예시)');
      alert('지금은 예시 단계입니다.\n나중에 워드/EML 파일 생성 모듈과 연결할 수 있습니다.');
    });

    btnMarkFollowup.addEventListener('click', () => {
      pillFollowup.textContent = '사후 조치: 처리 메모 기록됨(예시)';
      addLog('선택 고객에 대한 사후 조치 상태를 기록했습니다. (예시)', '상태: 사후 조치 기록(예시)');
    });

    updateStatus();
  </script>
</body>
</html>
