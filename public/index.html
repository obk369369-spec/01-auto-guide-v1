<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>1ë²ˆ ë„êµ¬ Â· ê³ ê° ìë™í™” ì•ˆë‚´ì„œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f4f5fb;
      --bg-card: #ffffff;
      --border-soft: #d3d7e6;
      --border-strong: #b7bfd6;
      --text-main: #111827;
      --text-sub: #6b7280;
      --accent: #2563eb;
      --accent-soft: #e0edff;
      --danger: #dc2626;
      --success: #16a34a;
      --radius-lg: 16px;
      --radius-md: 10px;
      --radius-sm: 6px;
      --shadow-soft: 0 6px 20px rgba(15, 23, 42, 0.08);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-main);
      background: radial-gradient(circle at top left, #e0edff 0, #f4f5fb 45%, #eef2ff 100%);
      color: var(--text-main);
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 1160px;
      padding: 18px 12px 32px;
    }

    @media (min-width: 960px) {
      .app {
        padding: 24px 0 40px;
      }
    }

    /* í—¤ë” */

    .header-card {
      background: linear-gradient(120deg, #e5efff, #f9fafb);
      border-radius: 20px;
      padding: 16px 18px 14px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-soft);
      border: 1px solid #d5dff5;
      display: grid;
      grid-template-columns: minmax(0, 1.8fr) minmax(0, 1.2fr);
      gap: 12px;
    }

    @media (max-width: 820px) {
      .header-card {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .header-title-main {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
      color: #111827;
    }

    .header-title-sub {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 8px;
    }

    .header-row-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 6px;
    }

    .tag {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(37, 99, 235, 0.4);
      background: rgba(255, 255, 255, 0.9);
      color: #1d4ed8;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .tag-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #2563eb;
    }

    .header-meta {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 4px;
    }

    .meta-strong {
      font-weight: 600;
      color: #374151;
    }

    .header-stats {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      align-items: center;
    }

    @media (max-width: 820px) {
      .header-stats {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.96);
      border-radius: 14px;
      padding: 7px 9px;
      border: 1px solid var(--border-soft);
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-height: 54px;
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-sub);
    }

    .stat-value {
      font-size: 16px;
      font-weight: 700;
      color: #111827;
    }

    .stat-pill {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      align-self: flex-start;
      background: var(--accent-soft);
      color: #1d4ed8;
    }

    .stat-pill-sub {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      align-self: flex-start;
      background: #eef2ff;
      color: #4b5563;
    }

    /* ë ˆì´ì•„ì›ƒ */

    .layout-main {
      display: grid;
      grid-template-columns: minmax(0, 1.35fr) minmax(0, 1.2fr);
      gap: 12px;
    }

    @media (max-width: 1040px) {
      .layout-main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 12px 13px 15px;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
    }

    .card + .card {
      margin-top: 8px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-sub);
    }

    .badge {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      color: var(--text-sub);
      white-space: nowrap;
    }

    .badge-status-ok {
      background: #dcfce7;
      color: #166534;
      border-color: #bbf7d0;
    }

    .badge-status-warn {
      background: #fef3c7;
      color: #92400e;
      border-color: #fde68a;
    }

    .badge-status-idle {
      background: #e5e7eb;
      color: #374151;
      border-color: #d1d5db;
    }

    .section-body {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .field-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    @media (max-width: 720px) {
      .field-row {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .field-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
    }

    .field-label {
      font-size: 12px;
      font-weight: 500;
    }

    .field-hint {
      font-size: 10px;
      color: var(--text-sub);
    }

    input[type="text"],
    input[type="email"],
    input[type="date"],
    textarea,
    select {
      width: 100%;
      padding: 6px 7px;
      font-size: 12px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      color: var(--text-main);
      font-family: var(--font-main);
      outline: none;
      transition: border-color 0.12s ease, box-shadow 0.12s ease,
        background 0.12s ease;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.15);
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
      max-height: 210px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    button {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #ffffff;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.12s ease, box-shadow 0.12s ease,
        transform 0.06s ease;
      white-space: nowrap;
    }

    button:hover {
      background: #eef2ff;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.12);
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .btn-primary {
      background: var(--accent);
      color: #ffffff;
      border-color: #1d4ed8;
    }

    .btn-primary:hover {
      background: #1d4ed8;
      color: #ffffff;
    }

    .btn-ghost {
      background: transparent;
    }

    .btn-icon {
      font-size: 14px;
      line-height: 0;
    }

    .note {
      font-size: 11px;
      color: var(--text-sub);
    }

    .note-strong {
      font-weight: 500;
      color: #4b5563;
    }

    /* ë¯¸ë¦¬ë³´ê¸° */

    .preview-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }

    .preview-mode-toggle {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #f3f4ff;
      overflow: hidden;
      font-size: 11px;
    }

    .preview-mode-btn {
      border: none;
      padding: 4px 8px;
      background: transparent;
      cursor: pointer;
      font-size: 11px;
      color: #4b5563;
    }

    .preview-mode-btn.active {
      background: #ffffff;
      color: #1d4ed8;
      font-weight: 600;
    }

    .preview-box {
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      padding: 8px 9px;
      min-height: 140px;
      max-height: 280px;
      overflow: auto;
      font-size: 12px;
      white-space: pre-wrap;
      line-height: 1.5;
    }

    .preview-empty {
      font-size: 12px;
      color: #9ca3af;
    }

    .preview-status {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-sub);
    }

    .preview-status span {
      font-weight: 600;
    }

    /* í›„ì†ì¡°ì¹˜ */

    .follow-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    @media (max-width: 720px) {
      .follow-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .summary-box {
      border-radius: 10px;
      border: 1px dashed var(--border-strong);
      background: #f9fafb;
      padding: 6px 7px;
      font-size: 12px;
      min-height: 48px;
    }

    .summary-empty {
      color: #9ca3af;
      font-size: 12px;
    }

    .footer-global {
      margin-top: 10px;
      font-size: 10px;
      color: var(--text-sub);
      text-align: right;
    }

    .footer-global span {
      font-weight: 500;
      color: #4b5563;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- í—¤ë” -->
    <section class="header-card" aria-label="ë„êµ¬ ì •ë³´">
      <div>
        <div class="header-title-main">1ë²ˆ ë„êµ¬ Â· ê³ ê° ìë™í™” ì•ˆë‚´ì„œ</div>
        <div class="header-title-sub">
          ì—°êµ¬ìÂ·ê³ ê° ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´, ì¸ì‚¬Â·ì†Œê°œÂ·ë§ì¶¤ ì œì•ˆÂ·í›„ì† ì•ˆë‚´ê¹Œì§€ í•œ ë²ˆì— ë¬¶ì¸
          ì›Œë“œ/ë©”ì¼ìš© ì•ˆë‚´ì„œ ì´ˆì•ˆê³¼ í›„ì† ì¡°ì¹˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ í•œ í™”ë©´ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.
        </div>
        <div class="header-row-tags">
          <span class="tag"><span class="tag-dot"></span> Local-only Â· Safe DOM Â· v1.0</span>
          <span class="tag"><span class="tag-dot"></span> í™”ë©´ì— ë³´ì´ëŠ” ê¸°ëŠ¥ë§Œ ë™ì‘</span>
          <span class="tag"><span class="tag-dot"></span> Word/ë©”ì¼ ì•ˆë‚´ì„œìš© í…ìŠ¤íŠ¸ ìƒì„±</span>
        </div>
        <div class="header-meta">
          <span class="meta-strong">ì´ˆê¸° ìƒíƒœ:</span>
          <span id="headerStateText">ì•„ì§ ì €ì¥ ì—†ìŒ</span> Â· ì €ì¥ ìœ„ì¹˜:
          <span class="meta-strong">localStorage Â· wic_tool1_state_v1</span>
        </div>
      </div>
      <div class="header-stats">
        <div class="stat-card">
          <div class="stat-label">ëˆ„ì  ì•ˆë‚´ì„œ ìƒì„±</div>
          <div class="stat-value" id="statTotalCount">0</div>
          <div class="stat-pill">Generate count</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ì˜¤ëŠ˜ ë§Œë“  ì•ˆë‚´ì„œ</div>
          <div class="stat-value" id="statTodayCount">0</div>
          <div class="stat-pill">Today</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ë§ˆì§€ë§‰ ìƒì„± ì‹œê°</div>
          <div class="stat-value" style="font-size:13px;" id="statLastTime">-</div>
          <div class="stat-pill-sub">Local-only ê¸°ë¡</div>
        </div>
      </div>
    </section>

    <main class="layout-main">
      <!-- ì™¼ìª½: ê³ ê° ì •ë³´ + ì˜µì…˜ -->
      <div>
        <!-- A. ê³ ê° ê¸°ë³¸ ì •ë³´ -->
        <section class="card" aria-label="ê³ ê° ê¸°ë³¸ ì •ë³´">
          <div class="card-header">
            <div>
              <div class="card-title">A. ê³ ê° ê¸°ë³¸ ì •ë³´</div>
              <div class="card-subtitle">
                ì—‘ì…€ ê³ ê°DBì—ì„œ ì˜®ê²¨ ì ëŠ” ê¸°ì¤€ìœ¼ë¡œ, ì•ˆë‚´ì„œì— í•„ìˆ˜ë¡œ ë“¤ì–´ê°€ëŠ” ê¸°ë³¸ í•„ë“œì…ë‹ˆë‹¤.
                <span class="note-strong">ì´ë¦„ ë˜ëŠ” ê¸°ê´€ ì¤‘ 1ê°œ ì´ìƒ</span>ì€ ê¼­ ì ì–´ì•¼ í•©ë‹ˆë‹¤.
              </div>
            </div>
            <span class="badge badge-status-idle" id="basicStatusBadge">ê¸°ë³¸ ì •ë³´ ìƒíƒœ: ëŒ€ê¸° ì¤‘</span>
          </div>
          <div class="section-body">
            <div class="field-row">
              <div class="field">
                <div class="field-label-row">
                  <label for="nameInput" class="field-label">ê³ ê° ì´ë¦„</label>
                  <span class="field-hint">ì˜ˆ: í™ê¸¸ë™</span>
                </div>
                <input id="nameInput" type="text" placeholder="ì˜ˆ: í™ê¸¸ë™" />
              </div>
              <div class="field">
                <div class="field-label-row">
                  <label for="titleInput" class="field-label">ì§í•¨ / ì§ìœ„</label>
                  <span class="field-hint">ì˜ˆ: ë°•ì‚¬ / ì±…ì„ì—°êµ¬ì›</span>
                </div>
                <input id="titleInput" type="text" placeholder="ì˜ˆ: ë°•ì‚¬ / ì±…ì„ì—°êµ¬ì›" />
              </div>
            </div>

            <div class="field-row">
              <div class="field">
                <div class="field-label-row">
                  <label for="orgInput" class="field-label">ê¸°ê´€ / íšŒì‚¬</label>
                  <span class="field-hint">ì˜ˆ: KIST / KITECH</span>
                </div>
                <input id="orgInput" type="text" placeholder="ì˜ˆ: KIST / KITECH" />
              </div>
              <div class="field">
                <div class="field-label-row">
                  <label for="deptInput" class="field-label">ë¶€ì„œ / ì—°êµ¬ì‹¤</label>
                  <span class="field-hint">ì˜ˆ: ì†Œì¬ë¶€í’ˆì—°êµ¬ë¶€</span>
                </div>
                <input id="deptInput" type="text" placeholder="ì˜ˆ: ì†Œì¬ë¶€í’ˆì—°êµ¬ë¶€" />
              </div>
            </div>

            <div class="field-row">
              <div class="field">
                <div class="field-label-row">
                  <label for="fieldInput" class="field-label">ì—°êµ¬ / ê´€ì‹¬ ë¶„ì•¼</label>
                  <span class="field-hint">ì˜ˆ: ë°˜ë„ì²´ íŒ¨í‚¤ì§• ì ‘ì°©ì œ</span>
                </div>
                <input id="fieldInput" type="text" placeholder="ì˜ˆ: ë°˜ë„ì²´ íŒ¨í‚¤ì§• ì ‘ì°©ì œ" />
              </div>
              <div class="field">
                <div class="field-label-row">
                  <label for="budgetInput" class="field-label">ì˜ˆìƒ ì˜ˆì‚° / ì—°êµ¬ë¹„</label>
                  <span class="field-hint">ì˜ˆ: ì—° 1,200ë§Œì›</span>
                </div>
                <input id="budgetInput" type="text" placeholder="ì˜ˆ: ì—° 1,200ë§Œì›" />
              </div>
            </div>

            <div class="field-row">
              <div class="field">
                <div class="field-label-row">
                  <label for="emailInput" class="field-label">ì´ë©”ì¼ (ì„ íƒ)</label>
                  <span class="field-hint">ì˜ˆ: example@org.re.kr</span>
                </div>
                <input id="emailInput" type="email" placeholder="ì˜ˆ: example@org.re.kr" />
              </div>
              <div class="field">
                <div class="field-label-row">
                  <label for="shortMemoInput" class="field-label">ë‚´ ë©”ëª¨ (ì§§ê²Œ)</label>
                  <span class="field-hint">ì˜ˆ: ê¸°ì¡´ ê³ ê° / ì˜ˆì‚° ìˆìŒ</span>
                </div>
                <input id="shortMemoInput" type="text" placeholder="ì˜ˆ: ê¸°ì¡´ ê³ ê° / ì˜ˆì‚° ìˆìŒ" />
              </div>
            </div>

            <div class="note">
              Â· <span class="note-strong">ì´ë¦„Â·ê¸°ê´€Â·ì—°êµ¬ë¶„ì•¼</span>ëŠ” ì•ˆë‚´ì„œ ì¸ì‚¬ë§, ë³¸ë¬¸ ìš”ì•½ì— ìë™ ë°˜ì˜ë©ë‹ˆë‹¤.
            </div>
          </div>
        </section>

        <!-- B. ì•ˆë‚´ì„œ ì˜µì…˜ -->
        <section class="card" aria-label="ì•ˆë‚´ì„œ ì˜µì…˜ ë° ë³´ê³ ì„œ ëª©ë¡">
          <div class="card-header">
            <div>
              <div class="card-title">B. ì•ˆë‚´ì„œ ì˜µì…˜ Â· ë³´ê³ ì„œ ëª©ë¡</div>
              <div class="card-subtitle">
                ì‹ ê·œ ë¬¸ì˜ / ê¸°ì¡´ ê³ ê° / ì¬ë¬¸ì˜ ìƒí™©ì— ë”°ë¼, í…œí”Œë¦¿ êµ¬ì¡°ì™€ í†¤ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
              </div>
            </div>
            <span class="badge badge-status-idle" id="optionStatusBadge">ì˜µì…˜ ìƒíƒœ: ê¸°ë³¸ê°’ ì‚¬ìš© ì¤‘</span>
          </div>
          <div class="section-body">
            <div class="field-row">
              <div class="field">
                <div class="field-label-row">
                  <label for="typeSelect" class="field-label">ì•ˆë‚´ì„œ ìœ í˜•</label>
                  <span class="field-hint">ìƒí™© ì„ íƒ</span>
                </div>
                <select id="typeSelect">
                  <option value="new">ì‹ ê·œ ë¬¸ì˜ / ì²« ì•ˆë‚´</option>
                  <option value="existing">ê¸°ì¡´ ê³ ê° ì¶”ê°€ ì œì•ˆ</option>
                  <option value="revisit">ì¬ë¬¸ì˜ / í›„ì† ì•ˆë‚´</option>
                </select>
              </div>
              <div class="field">
                <div class="field-label-row">
                  <label for="toneSelect" class="field-label">ë¬¸ì²´ / í†¤</label>
                  <span class="field-hint">ì˜ˆ: ì—°êµ¬ì ëŒ€ìƒ ì¡´ëŒ“ë§</span>
                </div>
                <select id="toneSelect">
                  <option value="researcher">ì—°êµ¬ììš© ì •ì¤‘í•œ í†¤ (ê¸°ë³¸)</option>
                  <option value="simple">ê°„ë‹¨Â·ì§ê´€ í†¤</option>
                  <option value="formal">ë§¤ìš° í˜•ì‹ì ì¸ í†¤</option>
                </select>
              </div>
            </div>

            <div class="field-row">
              <div class="field">
                <div class="field-label-row">
                  <label for="keywordInput" class="field-label">í•µì‹¬ í‚¤ì›Œë“œ (ì½¤ë§ˆ êµ¬ë¶„)</label>
                  <span class="field-hint">ì˜ˆ: ê¸€ë¼ìŠ¤ ì„œë¸ŒìŠ¤íŠ¸ë ˆì´íŠ¸, ì ‘ì°©ì œ</span>
                </div>
                <input
                  id="keywordInput"
                  type="text"
                  placeholder="í‚¤ì›Œë“œ1, í‚¤ì›Œë“œ2, ..."
                />
              </div>
              <div class="field">
                <div class="field-label-row">
                  <label for="channelSelect" class="field-label">ì˜ˆìƒ ì‚¬ìš© ì±„ë„</label>
                  <span class="field-hint">ë©”ì¼ / ì›Œë“œ / PDF</span>
                </div>
                <select id="channelSelect">
                  <option value="email">ì´ë©”ì¼ ë³¸ë¬¸ìš©</option>
                  <option value="word">ì›Œë“œ íŒŒì¼ìš©</option>
                  <option value="pdf">PDF ì•ˆë‚´ì„œìš©</option>
                  <option value="mix">ì´ë©”ì¼ + ì›Œë“œ ë³‘í–‰</option>
                </select>
              </div>
            </div>

            <div class="field">
              <div class="field-label-row">
                <label for="reportListInput" class="field-label">ë³´ê³ ì„œ / ìë£Œ ëª©ë¡</label>
                <span class="field-hint">í•œ ì¤„ë‹¹ 1ê°œ Â· ì œëª©ë§Œ ì ìœ¼ë©´ ë²ˆí˜¸ ë§¤ê¹€</span>
              </div>
              <textarea
                id="reportListInput"
                placeholder="ì˜ˆì‹œ)
Glass Substrate for Advanced Packaging 2025
Semiconductor Packaging Adhesives: Global Market 2024
ê³ ê¸°ëŠ¥ ì ‘ì°©ì œÂ·ì‹¤ë€íŠ¸ ì„¸ê³„ì‹œì¥ 2023"
              ></textarea>
            </div>

            <div class="field">
              <div class="field-label-row">
                <label for="detailMemoInput" class="field-label">ê³ ê° ìƒì„¸ ë©”ëª¨ (ì•ˆë‚´ì„œ ë³¸ë¬¸ ë°˜ì˜)</label>
                <span class="field-hint">ì „í™” ë‚´ìš©, ì˜ˆì‚°, ì›í•˜ëŠ” í¬ì¸íŠ¸ ë“± ììœ  ì…ë ¥</span>
              </div>
              <textarea
                id="detailMemoInput"
                placeholder="ì˜ˆ)
- ìµœê·¼ íŒ¨í‚¤ì§•ìš© ìœ ë¦¬ê¸°íŒ ê´€ë ¨ ì¤‘ì¥ê¸° ë¡œë“œë§µ ìˆ˜ë¦½ ì¤‘
- êµ­ë‚´Â·í•´ì™¸ ì—…ì²´ ë™í–¥, ê³µì •ë³„ ê¸°ìˆ  í¬ì¸íŠ¸, ë¹„ìš©Â·íˆ¬ì ê·œëª¨ ë°ì´í„° í•„ìš”
- ê¸°í•œ: ë‹¤ìŒ ë‹¬ ì˜ˆì‚° ì§‘í–‰ ì „ê¹Œì§€"
              ></textarea>
            </div>

            <div class="btn-row">
              <button type="button" class="btn-primary" id="btnGenerate">
                <span class="btn-icon">âš™ï¸</span> ìë™ ì•ˆë‚´ì„œ ì´ˆì•ˆ ìƒì„±
              </button>
              <button type="button" class="btn" id="btnAppendMemo">
                <span class="btn-icon">â•</span> ë©”ëª¨ë¥¼ ì•ˆë‚´ì„œì— ë§ë¶™ì´ê¸°
              </button>
              <button type="button" class="btn btn-ghost" id="btnClearInputs">
                <span class="btn-icon">ğŸ§¹</span> ì…ë ¥ ë‚´ìš© ì´ˆê¸°í™”
              </button>
            </div>

            <div class="note">
              Â· ì•ˆë‚´ì„œ ìƒì„± í›„ì—ë„ ì˜µì…˜ì„ ë°”ê¿” ë‹¤ì‹œ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
          </div>
        </section>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ë¯¸ë¦¬ë³´ê¸° + í›„ì† ì¡°ì¹˜ -->
      <div>
        <!-- C. ìë™ ì•ˆë‚´ì„œ ë¯¸ë¦¬ë³´ê¸° -->
        <section class="card" aria-label="ìë™ ì•ˆë‚´ì„œ ë¯¸ë¦¬ë³´ê¸°">
          <div class="card-header">
            <div>
              <div class="card-title">C. ìë™ ì•ˆë‚´ì„œ ë¯¸ë¦¬ë³´ê¸°</div>
              <div class="card-subtitle">
                ì¸ì‚¬Â·ì†Œê°œÂ·ë§ì¶¤ ì œì•ˆÂ·í›„ì† ì•ˆë‚´ê¹Œì§€ í•œ ë²ˆì— ë¶™ì—¬ ë„£ì„ ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.
              </div>
            </div>
            <span class="badge badge-status-idle" id="previewStatusBadge">
              ì•ˆë‚´ì„œ ìƒíƒœ: ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
            </span>
          </div>
          <div class="section-body">
            <div class="preview-header-row">
              <div class="preview-mode-toggle" role="group" aria-label="ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ">
                <button
                  type="button"
                  class="preview-mode-btn active"
                  id="btnModeStructured"
                >
                  ğŸ“„ ì•ˆë‚´ì„œ í˜•ì‹
                </button>
                <button
                  type="button"
                  class="preview-mode-btn"
                  id="btnModePlain"
                >
                  ğŸ“‹ ìˆœìˆ˜ í…ìŠ¤íŠ¸
                </button>
              </div>
              <div class="btn-row" style="margin-top:0;">
                <button type="button" class="btn" id="btnCopy">
                  <span class="btn-icon">ğŸ“</span> ë³µì‚¬
                </button>
                <button type="button" class="btn btn-ghost" id="btnAddDivider">
                  <span class="btn-icon">ğŸ“</span> ì›Œë“œ êµ¬ë¶„ì„ 
                </button>
              </div>
            </div>
            <div id="previewBox" class="preview-box preview-empty">
              ì•„ì§ ìë™ ì•ˆë‚´ì„œê°€ ì—†ìŠµë‹ˆë‹¤. ì™¼ìª½ì—ì„œ ê³ ê° ì •ë³´ì™€ ì˜µì…˜ì„ ì…ë ¥í•œ ë’¤
              ã€Œìë™ ì•ˆë‚´ì„œ ì´ˆì•ˆ ìƒì„±ã€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.
            </div>
            <div class="preview-status" id="previewStatusText">
              Â· ì´ ì•ˆë‚´ì„œëŠ” ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©°, ìƒˆë¡œê³ ì¹¨ í›„ì—ë„ ë³µì›ë©ë‹ˆë‹¤.
              (Word ì ê¸ˆì€ ë³„ë„ í…œí”Œë¦¿ì—ì„œ ì²˜ë¦¬)
            </div>
          </div>
        </section>

        <!-- D. í›„ì† ì¡°ì¹˜ -->
        <section class="card" aria-label="í›„ì† ì¡°ì¹˜ ì²´í¬ë¦¬ìŠ¤íŠ¸">
          <div class="card-header">
            <div>
              <div class="card-title">D. í›„ì† ì¡°ì¹˜ Â· Follow-up ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
              <div class="card-subtitle">
                ì•ˆë‚´ì„œì™€ ì—°ê²°ëœ ì „í™” / ë©”ì¼ / ê²¬ì  / ì…ì°° ë“± í›„ì† í–‰ë™ì„ ë¡œì»¬ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.
              </div>
            </div>
            <span class="badge badge-status-idle" id="followStatusBadge">
              í›„ì† ì¡°ì¹˜ ìƒíƒœ: ë¯¸ì €ì¥
            </span>
          </div>
          <div class="section-body">
            <div class="follow-grid">
              <div class="field">
                <div class="field-label-row">
                  <span class="field-label">ì „í™” ìƒë‹´ ì˜ˆì •</span>
                  <span class="field-hint">ì—°ë„-ì›”-ì¼</span>
                </div>
                <input id="callDateInput" type="date" />
              </div>
              <div class="field">
                <div class="field-label-row">
                  <span class="field-label">ì•ˆë‚´ ë©”ì¼ ë°œì†¡ / íšŒì‹  ëŒ€ê¸°</span>
                  <span class="field-hint">ì—°ë„-ì›”-ì¼</span>
                </div>
                <input id="mailDateInput" type="date" />
              </div>
              <div class="field">
                <div class="field-label-row">
                  <span class="field-label">ê³µì‹ ê²¬ì ì„œ / ì¸ë³´ì´ìŠ¤ ë°œì†¡</span>
                  <span class="field-hint">ì—°ë„-ì›”-ì¼</span>
                </div>
                <input id="quoteDateInput" type="date" />
              </div>
              <div class="field">
                <div class="field-label-row">
                  <span class="field-label">ì…ì°° / ì¡°ë‹¬ ë“±ë¡ ì¤€ë¹„</span>
                  <span class="field-hint">ì—°ë„-ì›”-ì¼</span>
                </div>
                <input id="bidDateInput" type="date" />
              </div>
            </div>

            <div class="field">
              <div class="field-label-row">
                <label for="followMemoInput" class="field-label">ì¶”ê°€ ë©”ëª¨ (í›„ì† ì¡°ì¹˜ìš©)</label>
                <span class="field-hint">ì˜ˆ: ì…ì°° ë§ˆê°ì¼ / ë‚´ë¶€ ê²°ì¬ ì¼ì •</span>
              </div>
              <textarea
                id="followMemoInput"
                placeholder="ì˜ˆ)
- KISTI ì¡°ë‹¬ ë“±ë¡ í•„ìš” ì—¬ë¶€ í™•ì¸
- ë‚´ë¶€ ê²°ì¬ë¼ì¸: íŒ€ì¥ â†’ ë³¸ë¶€ì¥
- ì˜ˆì‚° ì§‘í–‰ ê¸°í•œ: 1ì›” ë§ê¹Œì§€"
              ></textarea>
            </div>

            <div class="field">
              <div class="field-label-row">
                <span class="field-label">ë‹¤ìŒ í•  ì¼ ìš”ì•½</span>
                <span class="field-hint">ì²´í¬ë¦¬ìŠ¤íŠ¸ ê°’ìœ¼ë¡œ ìë™ ì •ë¦¬</span>
              </div>
              <div id="followSummaryBox" class="summary-box">
                <span class="summary-empty" id="followSummaryEmptyText">
                  ì•„ì§ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ ì±„ìš´ ë’¤ ã€Œìš”ì•½ ë‹¤ì‹œ ê³„ì‚°ã€ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.
                </span>
              </div>
            </div>

            <div class="btn-row">
              <button type="button" class="btn" id="btnFollowSave">
                <span class="btn-icon">ğŸ’¾</span> í›„ì† ì¡°ì¹˜ ìƒíƒœ ì €ì¥
              </button>
              <button type="button" class="btn btn-ghost" id="btnFollowRecalc">
                <span class="btn-icon">ğŸ”„</span> ìš”ì•½ ë‹¤ì‹œ ê³„ì‚°
              </button>
              <button type="button" class="btn btn-ghost" id="btnFollowReset">
                <span class="btn-icon">â™»ï¸</span> ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
              </button>
            </div>

            <div class="note">
              Â· ì²´í¬ë¦¬ìŠ¤íŠ¸ì™€ ë©”ëª¨ëŠ” ì´ ë¸Œë¼ìš°ì €ì˜ <span class="note-strong">localStorage</span>ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.
            </div>
          </div>
        </section>

        <div class="footer-global">
          <span>Local-only / Static</span> Â· public/index.html Â· ê³ ê° ìë™í™” ì•ˆë‚´ì„œ v1.0
        </div>
      </div>
    </main>
  </div>

  <script>
    (function () {
      "use strict";

      const STORAGE_KEY = "wic_tool1_state_v1";

      const $ = (id) => document.getElementById(id);

      const nameInput = $("nameInput");
      const titleInput = $("titleInput");
      const orgInput = $("orgInput");
      const deptInput = $("deptInput");
      const fieldInput = $("fieldInput");
      const budgetInput = $("budgetInput");
      const emailInput = $("emailInput");
      const shortMemoInput = $("shortMemoInput");

      const typeSelect = $("typeSelect");
      const toneSelect = $("toneSelect");
      const keywordInput = $("keywordInput");
      const channelSelect = $("channelSelect");
      const reportListInput = $("reportListInput");
      const detailMemoInput = $("detailMemoInput");

      const basicStatusBadge = $("basicStatusBadge");
      const optionStatusBadge = $("optionStatusBadge");
      const previewStatusBadge = $("previewStatusBadge");
      const previewStatusText = $("previewStatusText");
      const followStatusBadge = $("followStatusBadge");

      const btnGenerate = $("btnGenerate");
      const btnAppendMemo = $("btnAppendMemo");
      const btnClearInputs = $("btnClearInputs");

      const btnModeStructured = $("btnModeStructured");
      const btnModePlain = $("btnModePlain");
      const previewBox = $("previewBox");
      const btnCopy = $("btnCopy");
      const btnAddDivider = $("btnAddDivider");

      const callDateInput = $("callDateInput");
      const mailDateInput = $("mailDateInput");
      const quoteDateInput = $("quoteDateInput");
      const bidDateInput = $("bidDateInput");
      const followMemoInput = $("followMemoInput");
      const followSummaryBox = $("followSummaryBox");
      const followSummaryEmptyText = $("followSummaryEmptyText");
      const btnFollowSave = $("btnFollowSave");
      const btnFollowRecalc = $("btnFollowRecalc");
      const btnFollowReset = $("btnFollowReset");

      const statTotalCount = $("statTotalCount");
      const statTodayCount = $("statTodayCount");
      const statLastTime = $("statLastTime");
      const headerStateText = $("headerStateText");

      let currentPreviewMode = "structured"; // 'structured' | 'plain'
      let currentLetterText = "";

      function safeJSONParse(text, fallback) {
        try {
          if (!text) return fallback;
          const parsed = JSON.parse(text);
          return parsed;
        } catch (e) {
          return fallback;
        }
      }

      function getTodayKey() {
        const d = new Date();
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        return `${y}-${m}-${day}`;
      }

      function formatDateTime(d) {
        if (!(d instanceof Date) || Number.isNaN(d.getTime())) return "-";
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        const h = String(d.getHours()).padStart(2, "0");
        const mi = String(d.getMinutes()).padStart(2, "0");
        return `${y}-${m}-${day} ${h}:${mi}`;
      }

      function setBadge(badgeEl, status, text) {
        badgeEl.textContent = text;
        badgeEl.classList.remove(
          "badge-status-ok",
          "badge-status-warn",
          "badge-status-idle"
        );
        if (status === "ok") {
          badgeEl.classList.add("badge-status-ok");
        } else if (status === "warn") {
          badgeEl.classList.add("badge-status-warn");
        } else {
          badgeEl.classList.add("badge-status-idle");
        }
      }

      function readStateFromUI() {
        return {
          basic: {
            name: nameInput.value || "",
            title: titleInput.value || "",
            org: orgInput.value || "",
            dept: deptInput.value || "",
            field: fieldInput.value || "",
            budget: budgetInput.value || "",
            email: emailInput.value || "",
            shortMemo: shortMemoInput.value || "",
          },
          options: {
            type: typeSelect.value,
            tone: toneSelect.value,
            keywords: keywordInput.value || "",
            channel: channelSelect.value,
            reportList: reportListInput.value || "",
            detailMemo: detailMemoInput.value || "",
          },
          preview: {
            letter: currentLetterText || "",
            mode: currentPreviewMode,
          },
          follow: {
            callDate: callDateInput.value || "",
            mailDate: mailDateInput.value || "",
            quoteDate: quoteDateInput.value || "",
            bidDate: bidDateInput.value || "",
            memo: followMemoInput.value || "",
            summary: followSummaryBox.textContent || "",
          },
          stats: {
            totalCount: parseInt(statTotalCount.textContent || "0", 10) || 0,
            todayCount: parseInt(statTodayCount.textContent || "0", 10) || 0,
            lastDateKey: getTodayKey(), // ê°±ì‹  ì‹œì  ê¸°ì¤€
            lastTime: new Date().toISOString(),
          },
        };
      }

      function applyStateToUI(state) {
        if (!state) return;

        if (state.basic) {
          nameInput.value = state.basic.name || "";
          titleInput.value = state.basic.title || "";
          orgInput.value = state.basic.org || "";
          deptInput.value = state.basic.dept || "";
          fieldInput.value = state.basic.field || "";
          budgetInput.value = state.basic.budget || "";
          emailInput.value = state.basic.email || "";
          shortMemoInput.value = state.basic.shortMemo || "";
        }
        if (state.options) {
          if (state.options.type) typeSelect.value = state.options.type;
          if (state.options.tone) toneSelect.value = state.options.tone;
          keywordInput.value = state.options.keywords || "";
          if (state.options.channel) channelSelect.value = state.options.channel;
          reportListInput.value = state.options.reportList || "";
          detailMemoInput.value = state.options.detailMemo || "";
        }

        if (state.preview) {
          currentLetterText = state.preview.letter || "";
          currentPreviewMode = state.preview.mode || "structured";
          updatePreviewBox();
        }

        if (state.follow) {
          callDateInput.value = state.follow.callDate || "";
          mailDateInput.value = state.follow.mailDate || "";
          quoteDateInput.value = state.follow.quoteDate || "";
          bidDateInput.value = state.follow.bidDate || "";
          followMemoInput.value = state.follow.memo || "";

          if (state.follow.summary && state.follow.summary.trim()) {
            followSummaryBox.textContent = state.follow.summary;
            followSummaryEmptyText.style.display = "none";
          } else {
            followSummaryBox.textContent = "";
            followSummaryEmptyText.style.display = "";
          }
        }

        if (state.stats) {
          const total = state.stats.totalCount || 0;
          const todayCount = state.stats.todayCount || 0;
          statTotalCount.textContent = String(total);
          statTodayCount.textContent = String(todayCount);

          if (state.stats.lastTime) {
            const d = new Date(state.stats.lastTime);
            statLastTime.textContent = formatDateTime(d);
          } else {
            statLastTime.textContent = "-";
          }

          if (total > 0) {
            headerStateText.textContent = "ì´ì „ì— ì €ì¥ëœ ì•ˆë‚´ì„œê°€ ìˆìŠµë‹ˆë‹¤.";
          } else {
            headerStateText.textContent = "ì•„ì§ ì €ì¥ ì—†ìŒ";
          }
        }
      }

      function saveState() {
        const state = readStateFromUI();
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
          if (state.stats && state.stats.totalCount > 0) {
            headerStateText.textContent = "ì €ì¥ë¨ Â· ìµœê·¼ ì•ˆë‚´ì„œ ì¡´ì¬";
          }
        } catch (e) {
          // ì €ì¥ ì‹¤íŒ¨ ì‹œ ì¡°ìš©íˆ ë¬´ì‹œ
        }
      }

      function loadState() {
        const raw = localStorage.getItem(STORAGE_KEY);
        const state = safeJSONParse(raw, null);
        applyStateToUI(state);
      }

      function buildLetterText() {
        const name = (nameInput.value || "").trim();
        const title = (titleInput.value || "").trim();
        const org = (orgInput.value || "").trim();
        const dept = (deptInput.value || "").trim();
        const field = (fieldInput.value || "").trim();
        const budget = (budgetInput.value || "").trim();
        const shortMemo = (shortMemoInput.value || "").trim();
        const type = typeSelect.value;
        const tone = toneSelect.value;
        const keywords = (keywordInput.value || "").trim();
        const channel = channelSelect.value;
        const reportLines = (reportListInput.value || "")
          .split(/\r?\n/)
          .map((l) => l.trim())
          .filter((l) => l.length > 0);
        const detailMemo = (detailMemoInput.value || "").trim();

        if (!name && !org) {
          alert("ì´ë¦„ ë˜ëŠ” ê¸°ê´€ ì¤‘ í•˜ë‚˜ëŠ” ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ ì•ˆë‚´ì„œë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
          return "";
        }

        // ì¸ì‚¬ë§
        let greetingName = "";
        if (org && name) {
          greetingName = `${org} ${dept ? dept + " " : ""}${name}${title ? " " + title : ""} ê·€í•˜`;
        } else if (org) {
          greetingName = `${org} ${dept ? dept + " " : ""}ë‹´ë‹¹ì ê·€í•˜`;
        } else {
          greetingName = `${name}${title ? " " + title : ""} ê·€í•˜`;
        }

        const todayKey = getTodayKey().replace(/-/g, ".");
        let introLine = "";

        if (type === "new") {
          introLine = `í•­ìƒ ê·€ ì—°êµ¬ì†Œì˜ ë°œì „ì„ ê¸°ì›í•©ë‹ˆë‹¤. ì›”ë“œì‚°ì—…ì •ë³´ì„¼í„°ì—ì„œ ${field || "ê·€í•˜ì˜ ì—°êµ¬ ë¶„ì•¼"} ê´€ë ¨ ìë£Œë¥¼ ë‹´ë‹¹í•˜ê³  ìˆëŠ” ë‹´ë‹¹ìì…ë‹ˆë‹¤.`;
        } else if (type === "existing") {
          introLine = `í•­ìƒ ì €í¬ ìë£Œë¥¼ ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ì´ì „ì— ì œê³µí•´ ë“œë¦° ìë£Œ ì´í›„, ìµœê·¼ ë™í–¥ì„ ë°˜ì˜í•œ ì¶”ê°€ ì œì•ˆ ì•ˆë‚´ë¥¼ ë“œë¦¬ê³ ì í•©ë‹ˆë‹¤.`;
        } else {
          introLine = `ì´ì „ì— ë¬¸ì˜ ì£¼ì…¨ë˜ ë‚´ìš©ê³¼ ì—°ê³„í•˜ì—¬, ìµœì‹  ìë£Œ êµ¬ì„±ì„ í¬í•¨í•œ í›„ì† ì•ˆë‚´ë¥¼ ë“œë¦½ë‹ˆë‹¤.`;
        }

        let toneLine = "";
        if (tone === "researcher") {
          toneLine =
            "ë³¸ ì•ˆë‚´ì„œëŠ” ì—°êµ¬ì ì…ì¥ì—ì„œ ë°”ë¡œ ë¹„êµÂ·ê²€í† í•˜ì‹¤ ìˆ˜ ìˆë„ë¡, í•µì‹¬ ë°ì´í„°ì™€ êµ¬ì¡°ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°„ë‹¨ ëª…ë£Œí•˜ê²Œ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.";
        } else if (tone === "simple") {
          toneLine =
            "ë‚´ìš©ì„ ìµœëŒ€í•œ ê°„ë‹¨í•˜ê²Œ ì •ë¦¬í•˜ì—¬, ë°”ë¡œ ì½ê³  ê²€í† í•˜ì‹œê¸° ì‰½ë„ë¡ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.";
        } else {
          toneLine =
            "ë‹¤ì†Œ í˜•ì‹ì ì¸ í‘œí˜„ì„ ì‚¬ìš©í•˜ì—¬ ë‚´ë¶€ ê²°ì¬ ë° ê³µì‹ ë¬¸ì„œë¡œë„ ë°”ë¡œ í™œìš©í•˜ì‹¤ ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.";
        }

        let keywordLine = "";
        if (keywords) {
          keywordLine = `ì´ë²ˆ ì•ˆë‚´ì˜ í•µì‹¬ í‚¤ì›Œë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: ${keywords}.`;
        }

        let fieldLine = "";
        if (field) {
          fieldLine = `íŠ¹íˆ ${field}ì™€(ê³¼) ê´€ë ¨ëœ ê¸°ìˆ  ë™í–¥ ë° ì‹œì¥ ë°ì´í„°ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.`;
        }

        let budgetLine = "";
        if (budget) {
          budgetLine = `ì˜ˆìƒí•˜ì‹  ì˜ˆì‚° ê·œëª¨(${budget}) ë‚´ì—ì„œ, í•„ìš” ë°ì´í„°ë¥¼ ìµœëŒ€í•œ í¬ê´„í•  ìˆ˜ ìˆëŠ” êµ¬ì„±ì„ ìš°ì„ ì ìœ¼ë¡œ ê²€í† í–ˆìŠµë‹ˆë‹¤.`;
        }

        let channelLine = "";
        if (channel === "email") {
          channelLine =
            "ì•„ë˜ ì•ˆë‚´ ë‚´ìš©ì€ ì´ë©”ì¼ ë³¸ë¬¸ì— ë°”ë¡œ ë¶™ì—¬ ë„£ì–´ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆë„ë¡ ë¬¸ë‹¨ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ë‘ì—ˆìŠµë‹ˆë‹¤.";
        } else if (channel === "word") {
          channelLine =
            "ì•„ë˜ ì•ˆë‚´ ë‚´ìš©ì€ Word íŒŒì¼ë¡œ ì˜®ê²¨, ë‚´ë¶€ ê²°ì¬ ìš©ë„ë¡œ ë°”ë¡œ í™œìš©í•˜ì‹¤ ìˆ˜ ìˆëŠ” í˜•ì‹ì„ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.";
        } else if (channel === "pdf") {
          channelLine =
            "ì•„ë˜ ì•ˆë‚´ ë‚´ìš©ì€ PDF ì•ˆë‚´ì„œë¡œ ë³€í™˜í•˜ì—¬ ë³´ê´€Â·ê³µìœ í•˜ì‹œê¸° í¸ë¦¬í•˜ë„ë¡ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.";
        } else {
          channelLine =
            "ì´ë©”ì¼ ë³¸ë¬¸ê³¼ Word íŒŒì¼ ë‘ ê°€ì§€ ìš©ë„ë¡œ ëª¨ë‘ í™œìš©í•˜ì‹¤ ìˆ˜ ìˆë„ë¡, ë¬¸ë‹¨ ë°°ì—´ê³¼ êµ¬ë¶„ì„ ì„ ê³ ë ¤í•˜ì—¬ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.";
        }

        let reportBlock = "";
        if (reportLines.length > 0) {
          reportBlock += "1. ì œì•ˆ ìë£Œ ëª©ë¡\n";
          reportLines.forEach((title, idx) => {
            reportBlock += `   ${idx + 1}) ${title}\n`;
          });
          reportBlock +=
            "   ìœ„ ìë£Œë“¤ì€ ìƒí˜¸ ë³´ì™„ì ìœ¼ë¡œ êµ¬ì„±ë˜ì–´, ê¸°ìˆ  ë™í–¥Â·ì‹œì¥ ê·œëª¨Â·ê²½ìŸì‚¬ ë¶„ì„ ë“±ì„ ë‹¨ê³„ì ìœ¼ë¡œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.\n";
        }

        let memoBlock = "";
        if (detailMemo) {
          memoBlock += "2. ê³ ê° ìš”ì²­ ë° ì°¸ê³  ë©”ëª¨ ìš”ì•½\n";
          memoBlock += detailMemo + "\n";
        }

        if (shortMemo) {
          if (!memoBlock) {
            memoBlock += "2. ê³ ê° ìš”ì²­ ë° ì°¸ê³  ë©”ëª¨ ìš”ì•½\n";
          }
          memoBlock += `- ë‚´ë¶€ ë©”ëª¨: ${shortMemo}\n`;
        }

        if (!reportBlock) {
          reportBlock =
            "1. ì œì•ˆ ìë£Œ ëª©ë¡\n   (ì•„ì§ êµ¬ì²´ì ì¸ ë³´ê³ ì„œ ì œëª©ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì—‘ì…€ DB ë˜ëŠ” ê³ ê° ë©”ëª¨ë¥¼ ì°¸ê³ í•˜ì—¬ ì œëª©ì„ ì¶”ê°€í•´ ì£¼ì‹œë©´ ì•ˆë‚´ì„œê°€ ë” í’ë¶€í•´ì§‘ë‹ˆë‹¤.)\n";
        }

        if (!memoBlock) {
          memoBlock =
            "2. ê³ ê° ìš”ì²­ ë° ì°¸ê³  ë©”ëª¨ ìš”ì•½\n   (í˜„ì¬ ì „í™”/ë©”ì¼ ë©”ëª¨ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìƒë‹´ ë‚´ìš©ì´ ìƒê¸°ë©´ ì´ êµ¬ì—­ì— ì¶”ê°€í•´ ì£¼ì‹œë©´ ë‹¤ìŒ ì•ˆë‚´ì„œì— ìë™ ë°˜ì˜ë©ë‹ˆë‹¤.)\n";
        }

        const followIntro =
          "3. í›„ì† ì•ˆë‚´ ë° ì œì•ˆ ë°©í–¥\n" +
          "- ì•ˆë‚´ ë©”ì¼ ë°œì†¡ í›„ 1~2ì¼ ë‚´ ì „í™” ë˜ëŠ” ë©”ì¼ë¡œ ê°„ë‹¨í•œ í”¼ë“œë°±ì„ ìš”ì²­ë“œë¦´ ê²ƒì„ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤.\n" +
          "- ìë£Œ ê²€í†  í›„, ì¶”ê°€ë¡œ í•„ìš”í•˜ì‹  í•­ëª©(ì˜ˆ: íŠ¹ì • ê³µì •, íŠ¹ì • ì—…ì²´, ì„¸ë¶€ ìˆ˜ì¹˜ ë“±)ì„ ì•Œë ¤ì£¼ì‹œë©´ ë§ì¶¤ ì¬êµ¬ì„±ì„ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n";

        const closing =
          "\në§ˆì§€ë§‰ìœ¼ë¡œ, ë‚´ë¶€ ê²€í†  ê³¼ì •ì—ì„œ í•„ìš”í•œ í˜•ì‹(ì„œì‹, PDF, ì¸ì‡„ìš© ë“±)ì´ ë”°ë¡œ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ ì£¼ì‹œë©´ ë°˜ì˜í•˜ì—¬ ì¬ì „ì†¡ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n" +
          `ê°ì‚¬í•©ë‹ˆë‹¤.\n` +
          `ì›”ë“œì‚°ì—…ì •ë³´ì„¼í„° ë“œë¦¼ (${todayKey})`;

        const letter =
          `${greetingName}\n\n` +
          `${introLine}\n` +
          `${toneLine}\n` +
          (keywordLine ? keywordLine + "\n" : "") +
          (fieldLine ? fieldLine + "\n" : "") +
          (budgetLine ? budgetLine + "\n" : "") +
          (channelLine ? "\n" + channelLine + "\n" : "\n") +
          "\n" +
          reportBlock +
          "\n" +
          memoBlock +
          "\n" +
          followIntro +
          closing;

        return letter;
      }

      function updatePreviewBox() {
        previewBox.classList.remove("preview-empty");
        if (!currentLetterText) {
          previewBox.textContent =
            "ì•„ì§ ìë™ ì•ˆë‚´ì„œê°€ ì—†ìŠµë‹ˆë‹¤. ì™¼ìª½ì—ì„œ ê³ ê° ì •ë³´ì™€ ì˜µì…˜ì„ ì…ë ¥í•œ ë’¤ ã€Œìë™ ì•ˆë‚´ì„œ ì´ˆì•ˆ ìƒì„±ã€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.";
          previewBox.classList.add("preview-empty");
          setBadge(
            previewStatusBadge,
            "idle",
            "ì•ˆë‚´ì„œ ìƒíƒœ: ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
          );
          return;
        }

        if (currentPreviewMode === "structured") {
          previewBox.textContent = currentLetterText;
        } else {
          let plain = currentLetterText.replace(/\n{2,}/g, "\n");
          previewBox.textContent = plain;
        }

        setBadge(previewStatusBadge, "ok", "ì•ˆë‚´ì„œ ìƒíƒœ: ìƒì„±ë¨");
      }

      function onGenerateClick() {
        const letter = buildLetterText();
        if (!letter) return;

        currentLetterText = letter;
        updatePreviewBox();

        const todayKey = getTodayKey();
        const now = new Date();
        const nowText = formatDateTime(now);

        const raw = localStorage.getItem(STORAGE_KEY);
        const prev = safeJSONParse(raw, {});
        const prevStats = prev.stats || {};
        const prevTotal = prevStats.totalCount || 0;
        const prevTodayKey = prevStats.lastDateKey || "";

        let newTotal = prevTotal + 1;
        let newTodayCount = 1;
        if (prevTodayKey === todayKey) {
          const prevToday = prevStats.todayCount || 0;
          newTodayCount = prevToday + 1;
        }

        statTotalCount.textContent = String(newTotal);
        statTodayCount.textContent = String(newTodayCount);
        statLastTime.textContent = nowText;

        setBadge(basicStatusBadge, "ok", "ê¸°ë³¸ ì •ë³´ ìƒíƒœ: ì•ˆë‚´ì„œì— ë°˜ì˜ë¨");
        setBadge(optionStatusBadge, "ok", "ì˜µì…˜ ìƒíƒœ: ì•ˆë‚´ì„œì— ë°˜ì˜ë¨");

        saveState();
      }

      function onAppendMemoClick() {
        const extra = (detailMemoInput.value || "").trim();
        if (!currentLetterText) {
          alert("ë¨¼ì € ì•ˆë‚´ì„œë¥¼ í•œ ë²ˆ ìƒì„±í•œ ë’¤ ë©”ëª¨ë¥¼ ë§ë¶™ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
          return;
        }
        if (!extra) {
          alert("ë§ë¶™ì¼ ë©”ëª¨ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.");
          return;
        }
        currentLetterText =
          currentLetterText.trim() +
          "\n\n[ì¶”ê°€ ë©”ëª¨]\n" +
          extra +
          "\n";
        updatePreviewBox();
        saveState();
      }

      function onClearInputsClick() {
        if (
          !confirm(
            "ê³ ê° ê¸°ë³¸ ì •ë³´ì™€ ì•ˆë‚´ì„œ ì˜µì…˜ ì…ë ¥ ë‚´ìš©ì„ ëª¨ë‘ ì§€ìš°ê² ìŠµë‹ˆê¹Œ?\n(ë¯¸ë¦¬ë³´ê¸°ì™€ í›„ì† ì¡°ì¹˜ëŠ” ê·¸ëŒ€ë¡œ ë‚¨ìŠµë‹ˆë‹¤.)"
          )
        ) {
          return;
        }
        nameInput.value = "";
        titleInput.value = "";
        orgInput.value = "";
        deptInput.value = "";
        fieldInput.value = "";
        budgetInput.value = "";
        emailInput.value = "";
        shortMemoInput.value = "";

        typeSelect.value = "new";
        toneSelect.value = "researcher";
        keywordInput.value = "";
        channelSelect.value = "email";
        reportListInput.value = "";
        detailMemoInput.value = "";

        setBadge(basicStatusBadge, "idle", "ê¸°ë³¸ ì •ë³´ ìƒíƒœ: ëŒ€ê¸° ì¤‘");
        setBadge(optionStatusBadge, "idle", "ì˜µì…˜ ìƒíƒœ: ê¸°ë³¸ê°’ ì‚¬ìš© ì¤‘");
        saveState();
      }

      function onPreviewModeChange(mode) {
        currentPreviewMode = mode;
        btnModeStructured.classList.toggle("active", mode === "structured");
        btnModePlain.classList.toggle("active", mode === "plain");
        updatePreviewBox();
        saveState();
      }

      function onCopyClick() {
        if (!currentLetterText) {
          alert("ë³µì‚¬í•  ì•ˆë‚´ì„œê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì•ˆë‚´ì„œë¥¼ ìƒì„±í•´ ì£¼ì„¸ìš”.");
          return;
        }
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(currentLetterText)
            .then(() => {
              previewStatusText.textContent =
                "Â· ì•ˆë‚´ì„œ í…ìŠ¤íŠ¸ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆìŠµë‹ˆë‹¤. ë©”ì¼ ë˜ëŠ” Wordì— ë¶™ì—¬ ë„£ì–´ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
            })
            .catch(() => {
              alert("ë³µì‚¬ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ë“œë˜ê·¸í•´ì„œ ë³µì‚¬í•´ ì£¼ì„¸ìš”.");
            });
        } else {
          alert("ë³µì‚¬ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ë“œë˜ê·¸í•´ì„œ ë³µì‚¬í•´ ì£¼ì„¸ìš”.");
        }
      }

      function onAddDividerClick() {
        if (!currentLetterText) {
          alert("ë¨¼ì € ì•ˆë‚´ì„œë¥¼ í•œ ë²ˆ ìƒì„±í•œ ë’¤ êµ¬ë¶„ì„ ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
          return;
        }
        const divider = "\n----------------------------------------\n";
        currentLetterText = currentLetterText.trimEnd() + divider;
        updatePreviewBox();
        saveState();
      }

      function buildFollowSummary() {
        const lines = [];
        const callDate = callDateInput.value;
        const mailDate = mailDateInput.value;
        const quoteDate = quoteDateInput.value;
        const bidDate = bidDateInput.value;

        if (callDate) {
          lines.push(`- ${callDate} : ì „í™” ìƒë‹´ ì˜ˆì •`);
        }
        if (mailDate) {
          lines.push(`- ${mailDate} : ì•ˆë‚´ ë©”ì¼ ë°œì†¡ / íšŒì‹  í™•ì¸`);
        }
        if (quoteDate) {
          lines.push(`- ${quoteDate} : ê³µì‹ ê²¬ì ì„œ / ì¸ë³´ì´ìŠ¤ ë°œì†¡`);
        }
        if (bidDate) {
          lines.push(`- ${bidDate} : ì…ì°° / ì¡°ë‹¬ ë“±ë¡ ì¤€ë¹„`);
        }

        if (followMemoInput.value.trim()) {
          lines.push(`- ë©”ëª¨: ${followMemoInput.value.trim()}`);
        }

        return lines.join("\n");
      }

      function onFollowRecalcClick() {
        const summary = buildFollowSummary();
        if (!summary) {
          followSummaryBox.textContent = "";
          followSummaryEmptyText.style.display = "";
        } else {
          followSummaryBox.textContent = summary;
          followSummaryEmptyText.style.display = "none";
        }
        saveState();
      }

      function onFollowSaveClick() {
        onFollowRecalcClick();
        setBadge(followStatusBadge, "ok", "í›„ì† ì¡°ì¹˜ ìƒíƒœ: ì €ì¥ë¨");
        saveState();
      }

      function onFollowResetClick() {
        if (
          !confirm(
            "í›„ì† ì¡°ì¹˜ ë‚ ì§œÂ·ë©”ëª¨Â·ìš”ì•½ì„ ëª¨ë‘ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
          )
        ) {
          return;
        }
        callDateInput.value = "";
        mailDateInput.value = "";
        quoteDateInput.value = "";
        bidDateInput.value = "";
        followMemoInput.value = "";
        followSummaryBox.textContent = "";
        followSummaryEmptyText.style.display = "";
        setBadge(followStatusBadge, "idle", "í›„ì† ì¡°ì¹˜ ìƒíƒœ: ë¯¸ì €ì¥");
        saveState();
      }

      function initEvents() {
        btnGenerate.addEventListener("click", onGenerateClick);
        btnAppendMemo.addEventListener("click", onAppendMemoClick);
        btnClearInputs.addEventListener("click", onClearInputsClick);

        btnModeStructured.addEventListener("click", () =>
          onPreviewModeChange("structured")
        );
        btnModePlain.addEventListener("click", () =>
          onPreviewModeChange("plain")
        );
        btnCopy.addEventListener("click", onCopyClick);
        btnAddDivider.addEventListener("click", onAddDividerClick);

        btnFollowRecalc.addEventListener("click", onFollowRecalcClick);
        btnFollowSave.addEventListener("click", onFollowSaveClick);
        btnFollowReset.addEventListener("click", onFollowResetClick);

        const inputsToSave = [
          nameInput,
          titleInput,
          orgInput,
          deptInput,
          fieldInput,
          budgetInput,
          emailInput,
          shortMemoInput,
          typeSelect,
          toneSelect,
          keywordInput,
          channelSelect,
          reportListInput,
          detailMemoInput,
          callDateInput,
          mailDateInput,
          quoteDateInput,
          bidDateInput,
          followMemoInput,
        ];
        inputsToSave.forEach((el) => {
          el.addEventListener("input", () => saveState());
          el.addEventListener("change", () => saveState());
        });
      }

      function init() {
        loadState();
        updatePreviewBox();
        initEvents();
      }

      document.addEventListener("DOMContentLoaded", init);
    })();
  </script>
</body>
</html>
