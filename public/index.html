<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>1ë²ˆ ë„êµ¬ Â· ê³ ê° ìë™í™” ì•ˆë‚´ì„œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #1f2933;
      background: #f5f1e6;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 16px;
      display: flex;
      justify-content: center;
      background: #f5f1e6;
    }
    .app {
      width: 100%;
      max-width: 1180px;
      background: #fffdf7;
      border-radius: 16px;
      padding: 16px 18px 22px;
      border: 1px solid #e0d5c0;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.04);
    }
    .app-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 14px;
    }
    .app-title {
      font-size: 20px;
      font-weight: 700;
      color: #3b1f0a;
    }
    .app-subtitle {
      font-size: 13px;
      color: #6b5a43;
    }
    .app-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 6px;
      font-size: 11px;
      color: #7a6a4c;
    }
    .badge {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #d5c3a3;
      background: #faf3e2;
    }
    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.1fr);
      gap: 10px;
      margin-top: 8px;
    }
    @media (max-width: 960px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    .card {
      border-radius: 12px;
      border: 1px solid #e1d4c1;
      background: #fffaf0;
      padding: 10px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .card-title {
      font-size: 14px;
      font-weight: 600;
      color: #3b2b13;
    }
    .card-sub {
      font-size: 11px;
      color: #8c7a5b;
    }
    .status-pill {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #f3ebe0;
      border: 1px solid #ddccb2;
    }
    .field-group {
      display: grid;
      grid-template-columns: 1fr 1.2fr;
      gap: 4px 8px;
      align-items: center;
      margin-top: 2px;
    }
    .field-group.full {
      grid-template-columns: 1fr;
    }
    .field-label {
      font-size: 12px;
      color: #4b3b22;
    }
    .field-label small {
      color: #a0885e;
      font-size: 11px;
    }
    .field-control input,
    .field-control select,
    .field-control textarea {
      width: 100%;
      font-size: 12px;
      padding: 5px 7px;
      border-radius: 6px;
      border: 1px solid #d8c7aa;
      background: #fffdf8;
      color: #2b2113;
    }
    .field-control textarea {
      resize: vertical;
      min-height: 60px;
    }
    .field-control input:focus,
    .field-control select:focus,
    .field-control textarea:focus {
      outline: 1px solid #c49c5b;
      border-color: #c49c5b;
      box-shadow: 0 0 0 1px rgba(196,156,91,0.1);
    }
    .hint {
      font-size: 11px;
      color: #9a8662;
      margin-top: -2px;
    }
    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }
    button {
      cursor: pointer;
      border-radius: 999px;
      border: 1px solid #d2b68a;
      background: #f3e1ba;
      font-size: 12px;
      padding: 5px 10px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: #3b2b13;
      transition: background 0.12s ease, transform 0.05s ease;
    }
    button:hover {
      background: #f0d192;
      transform: translateY(-0.5px);
    }
    button.secondary {
      background: #f6efe4;
    }
    button.secondary:hover {
      background: #efe3d1;
    }
    button.danger {
      background: #fbe4e2;
      border-color: #f1b5ae;
      color: #8a1f22;
    }
    button.danger:hover {
      background: #f6cbc7;
    }
    .small {
      font-size: 11px;
    }
    .stats-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
      color: #7c6846;
      margin-top: 4px;
    }
    .stats-item {
      padding: 2px 7px;
      border-radius: 999px;
      background: #faf1dd;
      border: 1px solid #e0c9a0;
    }
    .preview-mode-row {
      display: flex;
      gap: 6px;
      margin-top: 4px;
    }
    .preview-mode-btn {
      padding: 3px 10px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid #d7c3a0;
      background: #f7efe0;
      cursor: pointer;
    }
    .preview-mode-btn.active {
      background: #e0c58a;
      color: #2d200f;
      font-weight: 600;
    }
    .preview-box {
      margin-top: 6px;
      border-radius: 10px;
      border: 1px solid #e0cfb3;
      background: #fffdf9;
      padding: 8px 9px;
      max-height: 320px;
      overflow: auto;
      font-size: 12px;
      line-height: 1.5;
      white-space: pre-wrap;
    }
    .preview-placeholder {
      font-size: 12px;
      color: #9b8a6c;
    }
    .followup-grid {
      display: grid;
      grid-template-columns: 1.1fr 1.3fr;
      gap: 6px 10px;
      align-items: center;
      margin-top: 4px;
    }
    @media (max-width: 768px) {
      .followup-grid {
        grid-template-columns: 1fr;
      }
    }
    .followup-summary {
      margin-top: 4px;
      font-size: 12px;
      color: #4b3b22;
      padding: 6px 8px;
      border-radius: 8px;
      background: #faf3e2;
      border: 1px dashed #dec69a;
      white-space: pre-wrap;
    }
    .footer-note {
      margin-top: 8px;
      font-size: 11px;
      color: #9a8662;
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="app-title">1ë²ˆ ë„êµ¬ Â· ê³ ê° ìë™í™” ì•ˆë‚´ì„œ</div>
      <div class="app-subtitle">
        ì—°êµ¬ìÂ·ê³ ê° ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´, ì¸ì‚¬Â·ì†Œê°œÂ·ë§ì¶¤ ì œì•ˆÂ·í›„ì† ì•ˆë‚´ê¹Œì§€ í•œ ë²ˆì— ë¬¶ì¸ ì›Œë“œ/ë©”ì¼ìš© ì•ˆë‚´ì„œ ì´ˆì•ˆê³¼
        í›„ì† ì¡°ì¹˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ í•œ í™”ë©´ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.
      </div>
      <div class="app-meta">
        <span class="badge">Local-only Â· Safe DOM Â· v1.0</span>
        <span class="badge">í™”ë©´ì— ë³´ì´ëŠ” ê¸°ëŠ¥ë§Œ ë™ì‘ Â· Static public/index.html</span>
        <span class="badge">ì €ì¥: localStorage Â· wic_tool1_state_v1</span>
      </div>
      <div class="stats-bar" id="stats-bar">
        <span class="stats-item" id="stat-total">ëˆ„ì  ì•ˆë‚´ì„œ ìƒì„±: 0</span>
        <span class="stats-item" id="stat-today">ì˜¤ëŠ˜ ë§Œë“  ì•ˆë‚´ì„œ: 0</span>
        <span class="stats-item" id="stat-last">ë§ˆì§€ë§‰ ìƒì„± ì‹œê°: -</span>
      </div>
    </header>

    <div class="grid">
      <!-- ì™¼ìª½: A + B -->
      <div class="left">
        <!-- A. ê³ ê° ê¸°ë³¸ ì •ë³´ -->
        <section class="card" id="section-basic">
          <div class="card-header">
            <div>
              <div class="card-title">A. ê³ ê° ê¸°ë³¸ ì •ë³´</div>
              <div class="card-sub">ì—‘ì…€ ê³ ê°DBì—ì„œ ì˜®ê²¨ ì ëŠ” í•„ìˆ˜ ì •ë³´ (ì´ë¦„ ë˜ëŠ” ê¸°ê´€ ì¤‘ 1ê°œ ì´ìƒ í•„ìˆ˜)</div>
            </div>
            <div class="status-pill" id="basic-status">ê¸°ë³¸ ì •ë³´ ìƒíƒœ: í•„ìˆ˜ í•­ëª© ëˆ„ë½</div>
          </div>

          <div class="field-group">
            <label class="field-label" for="customerName">ê³ ê° ì´ë¦„<br><small>ì˜ˆ: í™ê¸¸ë™</small></label>
            <div class="field-control">
              <input id="customerName" type="text" placeholder="í™ê¸¸ë™" />
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="customerTitle">ì§í•¨ / ì§ìœ„<br><small>ì˜ˆ: ë°•ì‚¬ / ì±…ì„ì—°êµ¬ì›</small></label>
            <div class="field-control">
              <input id="customerTitle" type="text" placeholder="ë°•ì‚¬ / ì±…ì„ì—°êµ¬ì›" />
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="customerOrg">ê¸°ê´€ / íšŒì‚¬<br><small>ì˜ˆ: KIST / KITECH</small></label>
            <div class="field-control">
              <input id="customerOrg" type="text" placeholder="KIST / KITECH" />
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="customerDept">ë¶€ì„œ / ì—°êµ¬ì‹¤<br><small>ì˜ˆ: ì†Œì¬ë¶€í’ˆì—°êµ¬ë¶€</small></label>
            <div class="field-control">
              <input id="customerDept" type="text" placeholder="ì†Œì¬ë¶€í’ˆì—°êµ¬ë¶€" />
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="customerField">ì—°êµ¬ / ê´€ì‹¬ ë¶„ì•¼<br><small>ì˜ˆ: ë°˜ë„ì²´ íŒ¨í‚¤ì§• ì ‘ì°©ì œ</small></label>
            <div class="field-control">
              <input id="customerField" type="text" placeholder="ë°˜ë„ì²´ íŒ¨í‚¤ì§• ì ‘ì°©ì œ" />
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="customerBudget">ì˜ˆìƒ ì˜ˆì‚° / ì—°êµ¬ë¹„<br><small>ì˜ˆ: ì—° 1,200ë§Œì›</small></label>
            <div class="field-control">
              <input id="customerBudget" type="text" placeholder="ì—° 1,200ë§Œì›" />
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="customerEmail">ì´ë©”ì¼ (ì„ íƒ)<br><small>ì˜ˆ: example@org.re.kr</small></label>
            <div class="field-control">
              <input id="customerEmail" type="email" placeholder="example@org.re.kr" />
            </div>
          </div>

          <div class="field-group full">
            <label class="field-label" for="customerShortMemo">ë‚´ ë©”ëª¨ (ì§§ê²Œ)<br><small>ì˜ˆ: ê¸°ì¡´ ê³ ê° / ì˜ˆì‚° ìˆìŒ</small></label>
            <div class="field-control">
              <textarea id="customerShortMemo" placeholder="ì˜ˆ: ê¸°ì¡´ ê³ ê° / ì˜ˆì‚° ìˆìŒ"></textarea>
            </div>
          </div>

          <div class="hint">
            Â· ì´ë¦„Â·ê¸°ê´€Â·ì—°êµ¬ë¶„ì•¼ëŠ” ì¸ì‚¬ë§ê³¼ ë³¸ë¬¸ ìš”ì•½, í›„ë°˜ë¶€ ì •ë¦¬ ë¬¸ì¥ì— ìë™ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.
          </div>
        </section>

        <!-- B. ì•ˆë‚´ì„œ ì˜µì…˜ Â· ë³´ê³ ì„œ ëª©ë¡ -->
        <section class="card" id="section-options" style="margin-top:8px;">
          <div class="card-header">
            <div>
              <div class="card-title">B. ì•ˆë‚´ì„œ ì˜µì…˜ Â· ë³´ê³ ì„œ ëª©ë¡</div>
              <div class="card-sub">ìƒí™©ì— ë”°ë¼ ë¬¸ì²´Â·êµ¬ì„±Â·ê°•ì¡° í¬ì¸íŠ¸ë¥¼ ìë™ ì¡°í•©í•©ë‹ˆë‹¤.</div>
            </div>
            <div class="status-pill" id="option-status">ì˜µì…˜ ìƒíƒœ: ê¸°ë³¸ê°’ ì‚¬ìš© ì¤‘</div>
          </div>

          <div class="field-group">
            <label class="field-label" for="guideType">ì•ˆë‚´ì„œ ìœ í˜•<br><small>ì‹ ê·œ / ê¸°ì¡´ / ì¬ë¬¸ì˜</small></label>
            <div class="field-control">
              <select id="guideType">
                <option value="new">ì‹ ê·œ ë¬¸ì˜ / ì²« ì•ˆë‚´</option>
                <option value="existing">ê¸°ì¡´ ê³ ê° / ì¶”ê°€ ì•ˆë‚´</option>
                <option value="re">ì¬ë¬¸ì˜ / ì—…ë°ì´íŠ¸ ì•ˆë‚´</option>
              </select>
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="tone">ë¬¸ì²´ / í†¤<br><small>ì˜ˆ: ì—°êµ¬ì ëŒ€ìƒ ì •ì¤‘í•œ í†¤</small></label>
            <div class="field-control">
              <select id="tone">
                <option value="polite">ì—°êµ¬ììš© ì •ì¤‘í•œ í†¤ (ê¸°ë³¸)</option>
                <option value="very_polite">ë§¤ìš° ê³µì†í•œ í†¤</option>
                <option value="simple">ê°„ë‹¨Â·ì§ê´€ í†¤</option>
              </select>
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="keywords">í•µì‹¬ í‚¤ì›Œë“œ (ì½¤ë§ˆ êµ¬ë¶„)<br><small>ì˜ˆ: ê¸€ë¼ìŠ¤ ì„œë¸ŒìŠ¤íŠ¸ë ˆì´íŠ¸, ì ‘ì°©ì œ</small></label>
            <div class="field-control">
              <input id="keywords" type="text" placeholder="ê¸€ë¼ìŠ¤ ì„œë¸ŒìŠ¤íŠ¸ë ˆì´íŠ¸, ì ‘ì°©ì œ" />
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="channel">ì˜ˆìƒ ì‚¬ìš© ì±„ë„<br><small>ë©”ì¼ / ì›Œë“œ / PDF</small></label>
            <div class="field-control">
              <select id="channel">
                <option value="email">ì´ë©”ì¼ ë³¸ë¬¸ìš©</option>
                <option value="word">ì›Œë“œ íŒŒì¼ìš©</option>
                <option value="pdf">PDF ì•ˆë‚´ìš©</option>
              </select>
            </div>
          </div>

          <div class="field-group full">
            <label class="field-label" for="reportList">
              ë³´ê³ ì„œ / ìë£Œ ëª©ë¡<br/>
              <small>í•œ ì¤„ë‹¹ 1ê°œ Â· ì œëª©ë§Œ ì ìœ¼ë©´ ìë™ ë²ˆí˜¸ ë§¤ê¹€</small>
            </label>
            <div class="field-control">
              <textarea id="reportList" placeholder="Glass Substrate for Advanced Packaging 2025&#10;Semiconductor Packaging Adhesives: Global Market 2024&#10;ê³ ê¸°ëŠ¥ ì ‘ì°©ì œÂ·ì‹¤ë€íŠ¸ ì„¸ê³„ì‹œì¥ 2023"></textarea>
            </div>
          </div>

          <div class="field-group full">
            <label class="field-label" for="detailMemo">
              ê³ ê° ìƒì„¸ ë©”ëª¨ (ì•ˆë‚´ì„œ ë³¸ë¬¸ ë°˜ì˜)<br/>
              <small>ì „í™” ë‚´ìš©, ì˜ˆì‚°, ì›í•˜ëŠ” í¬ì¸íŠ¸ ë“± ììœ  ì…ë ¥</small>
            </label>
            <div class="field-control">
              <textarea id="detailMemo" placeholder="- ìµœê·¼ íŒ¨í‚¤ì§•ìš© ìœ ë¦¬ê¸°íŒ ê´€ë ¨ ì¤‘ì¥ê¸° ë¡œë“œë§µ ìˆ˜ë¦½ ì¤‘&#10;- êµ­ë‚´Â·í•´ì™¸ ì—…ì²´ ë™í–¥, ê³µì •ë³„ ê¸°ìˆ  í¬ì¸íŠ¸, ë¹„ìš©Â·íˆ¬ì ê·œëª¨ ë°ì´í„° í•„ìš”&#10;- ê¸°í•œ: ë‹¤ìŒ ë‹¬ ì˜ˆì‚° ì§‘í–‰ ì „ê¹Œì§€"></textarea>
            </div>
          </div>

          <div class="btn-row">
            <button id="btn-generate">
              âš™ï¸ ìë™ ì•ˆë‚´ì„œ ì´ˆì•ˆ ìƒì„±
            </button>
            <button id="btn-append-memo" class="secondary">
              â• ë©”ëª¨ë¥¼ ì•ˆë‚´ì„œì— ë§ë¶™ì´ê¸°
            </button>
            <button id="btn-clear-inputs" class="secondary">
              ğŸ§¹ ì…ë ¥ ë‚´ìš© ì´ˆê¸°í™”
            </button>
          </div>
          <div class="hint">
            Â· ì•ˆë‚´ì„œ ìƒì„± í›„ì—ë„ ì˜µì…˜ë§Œ ë°”ê¿” ë‹¤ì‹œ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ê¸°ë³¸ ì •ë³´ëŠ” ìœ ì§€ / ë¯¸ë¦¬ë³´ê¸°ë§Œ ìƒˆë¡œ ìƒì„±)
          </div>
        </section>
      </div>

      <!-- ì˜¤ë¥¸ìª½: C + D -->
      <div class="right">
        <!-- C. ìë™ ì•ˆë‚´ì„œ ë¯¸ë¦¬ë³´ê¸° -->
        <section class="card" id="section-preview">
          <div class="card-header">
            <div>
              <div class="card-title">C. ìë™ ì•ˆë‚´ì„œ ë¯¸ë¦¬ë³´ê¸°</div>
              <div class="card-sub">
                ì¸ì‚¬ Â· ì†Œê°œ Â· ë§ì¶¤ ì œì•ˆ Â· í›„ì† ì•ˆë‚´ê¹Œì§€ í•œ ë²ˆì— ë¶™ì—¬ ë„£ì„ ìˆ˜ ìˆëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.
              </div>
            </div>
            <div class="status-pill" id="preview-status">ì•ˆë‚´ì„œ ìƒíƒœ: ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>
          </div>

          <div class="preview-mode-row">
            <button type="button" class="preview-mode-btn active" id="btn-mode-formatted">ğŸ“„ ì•ˆë‚´ì„œ í˜•ì‹</button>
            <button type="button" class="preview-mode-btn" id="btn-mode-plain">ğŸ“‹ ìˆœìˆ˜ í…ìŠ¤íŠ¸</button>
          </div>

          <div class="btn-row">
            <button type="button" id="btn-copy" class="secondary">
              ğŸ“ í´ë¦½ë³´ë“œ ë³µì‚¬
            </button>
            <button type="button" id="btn-add-divider" class="secondary">
              ğŸ“ ì›Œë“œ êµ¬ë¶„ì„  ì¶”ê°€
            </button>
          </div>

          
          <div class="preview-box" id="preview-box">
            <div class="preview-placeholder" id="preview-placeholder">
              ì•„ì§ ìë™ ì•ˆë‚´ì„œê°€ ì—†ìŠµë‹ˆë‹¤. ì™¼ìª½ì—ì„œ ê³ ê° ì •ë³´ì™€ ì˜µì…˜ì„ ì…ë ¥í•œ ë’¤
              ã€Œìë™ ì•ˆë‚´ì„œ ì´ˆì•ˆ ìƒì„±ã€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.
            </div>
            <pre id="preview-content" style="margin:0; white-space:pre-wrap; font:inherit;"></pre>
          </div>

          <div class="hint"><div class="hint">
            Â· ì´ ì•ˆë‚´ì„œëŠ” ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©°, ìƒˆë¡œê³ ì¹¨ í›„ì—ë„ ë³µì›ë©ë‹ˆë‹¤.
          </div>
        </section>

        <!-- D. í›„ì† ì¡°ì¹˜ Â· Follow-up ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
        <section class="card" id="section-followup" style="margin-top:8px;">
          <div class="card-header">
            <div>
              <div class="card-title">D. í›„ì† ì¡°ì¹˜ Â· Follow-up ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
              <div class="card-sub">ì „í™” Â· ë©”ì¼ Â· ê²¬ì  Â· ì…ì°° ë“± í›„ì† í–‰ë™ì„ í•œ í™”ë©´ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.</div>
            </div>
            <div class="status-pill" id="followup-status">í›„ì† ì¡°ì¹˜ ìƒíƒœ: ë¯¸ì €ì¥</div>
          </div>

          <div class="followup-grid">
            <div class="field-label">
              ì „í™” ìƒë‹´ ì˜ˆì •<br><small>ì˜ˆ: ì˜¤ëŠ˜ ë˜ëŠ” ì˜ˆì • ë‚ ì§œ</small>
            </div>
            <div class="field-control">
              <input id="fu-call" type="date" />
            </div>

            <div class="field-label">
              ì•ˆë‚´ ë©”ì¼ ë°œì†¡ / íšŒì‹  ëŒ€ê¸°<br><small>ë©”ì¼ ë³´ë‚¸ ë‚  í˜¹ì€ íšŒì‹  ê¸°í•œ</small>
            </div>
            <div class="field-control">
              <input id="fu-mail" type="date" />
            </div>

            <div class="field-label">
              ê³µì‹ ê²¬ì ì„œ / ì¸ë³´ì´ìŠ¤ ë°œì†¡<br><small>ê²¬ì  or ì¸ë³´ì´ìŠ¤ ë³´ë‚¸ ë‚ ì§œ</small>
            </div>
            <div class="field-control">
              <input id="fu-quote" type="date" />
            </div>

            <div class="field-label">
              ì…ì°° / ì¡°ë‹¬ ë“±ë¡ ì¤€ë¹„<br><small>ì…ì°° ë§ˆê° ë˜ëŠ” ë“±ë¡ ê¸°í•œ</small>
            </div>
            <div class="field-control">
              <input id="fu-bid" type="date" />
            </div>

            <div class="field-label">
              ì¶”ê°€ ë©”ëª¨ (í›„ì† ì¡°ì¹˜ìš©)<br><small>ì˜ˆ: ì…ì°° ë§ˆê°ì¼ / ë‚´ë¶€ ê²°ì¬ ì¼ì •</small>
            </div>
            <div class="field-control">
              <textarea id="fu-memo" placeholder="- KISTI ì¡°ë‹¬ ë“±ë¡ í•„ìš” ì—¬ë¶€ í™•ì¸&#10;- ë‚´ë¶€ ê²°ì¬ë¼ì¸: íŒ€ì¥ â†’ ë³¸ë¶€ì¥&#10;- ì˜ˆì‚° ì§‘í–‰ ê¸°í•œ: 1ì›” ë§ê¹Œì§€"></textarea>
            </div>
          </div>

          <div class="followup-summary" id="followup-summary">
            ë‹¤ìŒ í•  ì¼ ìš”ì•½: ì•„ì§ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ ì±„ìš´ ë’¤ ã€Œìš”ì•½ ë‹¤ì‹œ ê³„ì‚°ã€ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.
          </div>

          <div class="btn-row">
            <button type="button" id="btn-followup-save">
              ğŸ’¾ í›„ì† ì¡°ì¹˜ ìƒíƒœ ì €ì¥
            </button>
            <button type="button" id="btn-followup-recalc" class="secondary">
              ğŸ”„ ìš”ì•½ ë‹¤ì‹œ ê³„ì‚°
            </button>
            <button type="button" id="btn-followup-reset" class="danger">
              â™»ï¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
            </button>
          </div>
        </section>

        <div class="footer-note">
          Local-only / Static Â· public/index.html Â· ê³ ê° ìë™í™” ì•ˆë‚´ì„œ v1.0
        </div>
      </div>
    </div>
  </div>

  <script>
    (function() {
      const STORAGE_KEY = "wic_tool1_state_v1";

      // ===== ìœ í‹¸ =====
      function todayStr() {
        const d = new Date();
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        return `${y}-${m}-${day}`;
      }

      function formatDateTime(dt) {
        if (!dt) return "-";
        const d = new Date(dt);
        if (isNaN(d.getTime())) return "-";
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        const hh = String(d.getHours()).padStart(2, "0");
        const mm = String(d.getMinutes()).padStart(2, "0");
        return `${y}-${m}-${day} ${hh}:${mm}`;
      }

      function saveState(state) {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        } catch (_e) {
          // localStorage ì‹¤íŒ¨ëŠ” ì¡°ìš©íˆ ë¬´ì‹œ
        }
      }

      function loadState() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return null;
          return JSON.parse(raw);
        } catch (_e) {
          return null;
        }
      }

      function getInitialState() {
        return {
          version: "1.0",
          lastUpdated: null,
          totalCount: 0,
          todayDate: todayStr(),
          todayCount: 0,
          lastGeneratedAt: null,
          basic: {
            customerName: "",
            customerTitle: "",
            customerOrg: "",
            customerDept: "",
            customerField: "",
            customerBudget: "",
            customerEmail: "",
            customerShortMemo: ""
          },
          options: {
            guideType: "new",
            tone: "polite",
            keywords: "",
            channel: "email",
            reportList: "",
            detailMemo: ""
          },
          preview: {
            text: "",
            mode: "formatted"
          },
          followup: {
            call: "",
            mail: "",
            quote: "",
            bid: "",
            memo: "",
            summary: ""
          }
        };
      }

      // ===== DOM ì°¸ì¡° =====
      const el = {
        // stats
        statTotal: document.getElementById("stat-total"),
        statToday: document.getElementById("stat-today"),
        statLast: document.getElementById("stat-last"),

        // status
        basicStatus: document.getElementById("basic-status"),
        optionStatus: document.getElementById("option-status"),
        previewStatus: document.getElementById("preview-status"),
        followupStatus: document.getElementById("followup-status"),

        // basic
        customerName: document.getElementById("customerName"),
        customerTitle: document.getElementById("customerTitle"),
        customerOrg: document.getElementById("customerOrg"),
        customerDept: document.getElementById("customerDept"),
        customerField: document.getElementById("customerField"),
        customerBudget: document.getElementById("customerBudget"),
        customerEmail: document.getElementById("customerEmail"),
        customerShortMemo: document.getElementById("customerShortMemo"),

        // options
        guideType: document.getElementById("guideType"),
        tone: document.getElementById("tone"),
        keywords: document.getElementById("keywords"),
        channel: document.getElementById("channel"),
        reportList: document.getElementById("reportList"),
        detailMemo: document.getElementById("detailMemo"),

        // buttons
        btnGenerate: document.getElementById("btn-generate"),
        btnAppendMemo: document.getElementById("btn-append-memo"),
        btnClearInputs: document.getElementById("btn-clear-inputs"),
        btnModeFormatted: document.getElementById("btn-mode-formatted"),
        btnModePlain: document.getElementById("btn-mode-plain"),
        btnCopy: document.getElementById("btn-copy"),
        btnAddDivider: document.getElementById("btn-add-divider"),

        // preview
        previewBox: document.getElementById("preview-box"),
        previewPlaceholder: document.getElementById("preview-placeholder"),
        previewContent: document.getElementById("preview-content"),

        // followup
        fuCall: document.getElementById("fu-call"),
        fuMail: document.getElementById("fu-mail"),
        fuQuote: document.getElementById("fu-quote"),
        fuBid: document.getElementById("fu-bid"),
        fuMemo: document.getElementById("fu-memo"),
        fuSummary: document.getElementById("followup-summary"),
        btnFollowupSave: document.getElementById("btn-followup-save"),
        btnFollowupRecalc: document.getElementById("btn-followup-recalc"),
        btnFollowupReset: document.getElementById("btn-followup-reset"),

        // csv db
        dbFile: document.getElementById("dbFile"),
        dbRow: document.getElementById("dbRow"),
        btnApplyRow: document.getElementById("btn-apply-row")
      };

      // ===== ìƒíƒœ =====
      let state = getInitialState();

      // ===== ìƒíƒœ â†’ í™”ë©´ ë°˜ì˜ =====
      function renderStats() {
        el.statTotal.textContent = `ëˆ„ì  ì•ˆë‚´ì„œ ìƒì„±: ${state.totalCount}`;
        el.statToday.textContent = `ì˜¤ëŠ˜ ë§Œë“  ì•ˆë‚´ì„œ: ${state.todayCount}`;
        el.statLast.textContent = `ë§ˆì§€ë§‰ ìƒì„± ì‹œê°: ${formatDateTime(state.lastGeneratedAt)}`;
      }

      function renderBasic() {
        const b = state.basic;
        el.customerName.value = b.customerName || "";
        el.customerTitle.value = b.customerTitle || "";
        el.customerOrg.value = b.customerOrg || "";
        el.customerDept.value = b.customerDept || "";
        el.customerField.value = b.customerField || "";
        el.customerBudget.value = b.customerBudget || "";
        el.customerEmail.value = b.customerEmail || "";
        el.customerShortMemo.value = b.customerShortMemo || "";

        const hasNameOrOrg = !!(b.customerName || b.customerOrg);
        el.basicStatus.textContent = hasNameOrOrg
          ? "ê¸°ë³¸ ì •ë³´ ìƒíƒœ: ì¤€ë¹„ ì™„ë£Œ"
          : "ê¸°ë³¸ ì •ë³´ ìƒíƒœ: í•„ìˆ˜ í•­ëª© ëˆ„ë½";
      }

      function renderOptions() {
        const o = state.options;
        el.guideType.value = o.guideType || "new";
        el.tone.value = o.tone || "polite";
        el.keywords.value = o.keywords || "";
        el.channel.value = o.channel || "email";
        el.reportList.value = o.reportList || "";
        el.detailMemo.value = o.detailMemo || "";
        el.optionStatus.textContent = "ì˜µì…˜ ìƒíƒœ: ì„¤ì • ë°˜ì˜ë¨";
      }

      
      function renderPreview() {
        const p = state.preview;
        const hasText = !!p.text && p.text.trim().length > 0;

        if (!hasText) {
          el.previewPlaceholder.style.display = "block";
          el.previewContent.textContent = "";
          el.previewStatus.textContent = "ì•ˆë‚´ì„œ ìƒíƒœ: ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
        } else {
          el.previewPlaceholder.style.display = "none";
          // formatted/plainì€ ì¼ë‹¨ ë™ì¼ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ (ì›Œë“œ ë¶™ì—¬ë„£ê¸°ìš©)
          el.previewContent.textContent = p.text;
          el.previewStatus.textContent = "ì•ˆë‚´ì„œ ìƒíƒœ: ìƒì„± ì™„ë£Œ (ë³µì‚¬Â·í¸ì§‘ ê°€ëŠ¥)";
        }

        if (p.mode === "formatted") {
          el.btnModeFormatted.classList.add("active");
          el.btnModePlain.classList.remove("active");
        } else {
          el.btnModePlain.classList.add("active");
          el.btnModeFormatted.classList.remove("active");
        }
      } else {
          el.previewPlaceholder.style.display = "none";
          if (p.mode === "formatted") {
            el.previewBox.textContent = p.text;
          } else {
            el.previewBox.textContent = p.text;
          }
          el.previewStatus.textContent = "ì•ˆë‚´ì„œ ìƒíƒœ: ìƒì„± ì™„ë£Œ (ë³µì‚¬Â·í¸ì§‘ ê°€ëŠ¥)";
        }

        if (p.mode === "formatted") {
          el.btnModeFormatted.classList.add("active");
          el.btnModePlain.classList.remove("active");
        } else {
          el.btnModePlain.classList.add("active");
          el.btnModeFormatted.classList.remove("active");
        }
      }

      function renderFollowup() {
        const f = state.followup;
        el.fuCall.value = f.call || "";
        el.fuMail.value = f.mail || "";
        el.fuQuote.value = f.quote || "";
        el.fuBid.value = f.bid || "";
        el.fuMemo.value = f.memo || "";
        if (f.summary && f.summary.trim().length > 0) {
          el.fuSummary.textContent = f.summary;
        } else {
          el.fuSummary.textContent =
            "ë‹¤ìŒ í•  ì¼ ìš”ì•½: ì•„ì§ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ ì±„ìš´ ë’¤ ã€Œìš”ì•½ ë‹¤ì‹œ ê³„ì‚°ã€ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.";
        }
      }

      function renderFollowupStatus(saved) {
        el.followupStatus.textContent = saved
          ? "í›„ì† ì¡°ì¹˜ ìƒíƒœ: ì €ì¥ë¨"
          : "í›„ì† ì¡°ì¹˜ ìƒíƒœ: ë¯¸ì €ì¥";
      }

      function renderAll() {
        renderStats();
        renderBasic();
        renderOptions();
        renderPreview();
        renderFollowup();
      }

      // ===== í™”ë©´ â†’ ìƒíƒœ ë°˜ì˜ =====
      function readBasicFromDOM() {
        state.basic.customerName = el.customerName.value.trim();
        state.basic.customerTitle = el.customerTitle.value.trim();
        state.basic.customerOrg = el.customerOrg.value.trim();
        state.basic.customerDept = el.customerDept.value.trim();
        state.basic.customerField = el.customerField.value.trim();
        state.basic.customerBudget = el.customerBudget.value.trim();
        state.basic.customerEmail = el.customerEmail.value.trim();
        state.basic.customerShortMemo = el.customerShortMemo.value.trim();
      }

      function readOptionsFromDOM() {
        state.options.guideType = el.guideType.value;
        state.options.tone = el.tone.value;
        state.options.keywords = el.keywords.value.trim();
        state.options.channel = el.channel.value;
        state.options.reportList = el.reportList.value.trim();
        state.options.detailMemo = el.detailMemo.value.trim();
      }

      function readFollowupFromDOM() {
        state.followup.call = el.fuCall.value;
        state.followup.mail = el.fuMail.value;
        state.followup.quote = el.fuQuote.value;
        state.followup.bid = el.fuBid.value;
        state.followup.memo = el.fuMemo.value.trim();
      }

      
      // ===== CSV ê³ ê°DB (ê°„ë‹¨) =====
      function parseCSV(text) {
        // ì•„ì£¼ ë‹¨ìˆœ CSV (ë”°ì˜´í‘œ/ì‰¼í‘œ ë³µì¡ ì¼€ì´ìŠ¤ëŠ” ìµœì†Œ ì²˜ë¦¬)
        const lines = text.replace(/\r/g, "").split("\n").filter(l => l.trim().length);
        if (lines.length < 2) return { headers: [], rows: [] };
        const splitLine = (line) => {
          const out = [];
          let cur = "";
          let inQ = false;
          for (let i = 0; i < line.length; i++) {
            const ch = line[i];
            if (ch === '"') {
              if (inQ && line[i+1] === '"') { cur += '"'; i++; }
              else { inQ = !inQ; }
            } else if (ch === "," && !inQ) {
              out.push(cur.trim());
              cur = "";
            } else {
              cur += ch;
            }
          }
          out.push(cur.trim());
          return out;
        };
        const headers = splitLine(lines[0]).map(h => h.replace(/^"|"$/g, "").trim());
        const rows = lines.slice(1).map(l => splitLine(l).map(v => v.replace(/^"|"$/g, "").trim()));
        return { headers, rows };
      }

      function guessCol(headers, keys) {
        const lower = headers.map(h => (h || "").toLowerCase());
        for (let k of keys) {
          const kk = k.toLowerCase();
          const idx = lower.findIndex(h => h.includes(kk));
          if (idx >= 0) return idx;
        }
        return -1;
      }

      let csvCache = { headers: [], rows: [] };

      function wireCSVImport() {
        if (!el.dbFile || !el.dbRow || !el.btnApplyRow) return;

        el.dbFile.addEventListener("change", async function() {
          const file = el.dbFile.files && el.dbFile.files[0];
          if (!file) return;
          const text = await file.text();
          csvCache = parseCSV(text);

          // ì˜µì…˜ ì±„ìš°ê¸° (ìµœëŒ€ 200í–‰)
          el.dbRow.innerHTML = '<option value="">í–‰ ì„ íƒ</option>';
          const nameIdx = guessCol(csvCache.headers, ["ì´ë¦„", "ì„±ëª…", "name"]);
          const orgIdx  = guessCol(csvCache.headers, ["ê¸°ê´€", "íšŒì‚¬", "ì†Œì†", "organization", "org"]);
          const deptIdx = guessCol(csvCache.headers, ["ë¶€ì„œ", "ì—°êµ¬ì‹¤", "department", "dept"]);

          const max = Math.min(csvCache.rows.length, 200);
          for (let i = 0; i < max; i++) {
            const r = csvCache.rows[i] || [];
            const name = nameIdx >= 0 ? (r[nameIdx] || "") : "";
            const org  = orgIdx  >= 0 ? (r[orgIdx]  || "") : "";
            const dept = deptIdx >= 0 ? (r[deptIdx] || "") : "";
            const label = [org, dept, name].filter(Boolean).join(" Â· ") || `Row ${i+1}`;
            const opt = document.createElement("option");
            opt.value = String(i);
            opt.textContent = label;
            el.dbRow.appendChild(opt);
          }
        });

        el.btnApplyRow.addEventListener("click", function() {
          const idx = parseInt(el.dbRow.value, 10);
          if (isNaN(idx) || !csvCache.rows[idx]) return;

          const headers = csvCache.headers;
          const row = csvCache.rows[idx];

          const iName   = guessCol(headers, ["ì´ë¦„", "ì„±ëª…", "name"]);
          const iTitle  = guessCol(headers, ["ì§í•¨", "ì§ìœ„", "title", "position"]);
          const iOrg    = guessCol(headers, ["ê¸°ê´€", "íšŒì‚¬", "ì†Œì†", "organization", "org"]);
          const iDept   = guessCol(headers, ["ë¶€ì„œ", "ì—°êµ¬ì‹¤", "department", "dept"]);
          const iField  = guessCol(headers, ["ë¶„ì•¼", "í‚¤ì›Œë“œ", "ê´€ì‹¬", "field", "keyword"]);
          const iBudget = guessCol(headers, ["ì˜ˆì‚°", "ì—°êµ¬ë¹„", "budget"]);
          const iEmail  = guessCol(headers, ["ì´ë©”ì¼", "email"]);
          const iMemo   = guessCol(headers, ["ë©”ëª¨", "ë¹„ê³ ", "memo", "note"]);

          state.basic.customerName = iName>=0 ? (row[iName]||"") : state.basic.customerName;
          state.basic.customerTitle = iTitle>=0 ? (row[iTitle]||"") : state.basic.customerTitle;
          state.basic.customerOrg = iOrg>=0 ? (row[iOrg]||"") : state.basic.customerOrg;
          state.basic.customerDept = iDept>=0 ? (row[iDept]||"") : state.basic.customerDept;
          state.basic.customerField = iField>=0 ? (row[iField]||"") : state.basic.customerField;
          state.basic.customerBudget = iBudget>=0 ? (row[iBudget]||"") : state.basic.customerBudget;
          state.basic.customerEmail = iEmail>=0 ? (row[iEmail]||"") : state.basic.customerEmail;
          state.basic.customerShortMemo = iMemo>=0 ? (row[iMemo]||"") : state.basic.customerShortMemo;

          state.lastUpdated = new Date().toISOString();
          renderBasic();
          saveState(state);
        });
      }

      // ===== ìë™ ì €ì¥(ì…ë ¥ ë³€ê²½ ì‹œ) =====
      function wireAutoSave() {
        const basicInputs = [el.customerName, el.customerTitle, el.customerOrg, el.customerDept, el.customerField, el.customerBudget, el.customerEmail, el.customerShortMemo];
        const optionInputs = [el.guideType, el.tone, el.keywords, el.channel, el.reportList, el.detailMemo];
        const followInputs = [el.fuCall, el.fuMail, el.fuQuote, el.fuBid, el.fuMemo];

        function onBasic() { readBasicFromDOM(); renderBasic(); state.lastUpdated = new Date().toISOString(); saveState(state); }
        function onOpt()   { readOptionsFromDOM(); renderOptions(); state.lastUpdated = new Date().toISOString(); saveState(state); }
        function onFollow(){ readFollowupFromDOM(); state.lastUpdated = new Date().toISOString(); saveState(state); renderFollowupStatus(false); }

        basicInputs.forEach(x => x && x.addEventListener("input", onBasic));
        optionInputs.forEach(x => x && x.addEventListener("input", onOpt));
        optionInputs.forEach(x => x && x.addEventListener("change", onOpt));
        followInputs.forEach(x => x && x.addEventListener("input", onFollow));
        followInputs.forEach(x => x && x.addEventListener("change", onFollow));
      }


      // ===== ì•ˆë‚´ì„œ í…ìŠ¤íŠ¸ ìƒì„± =====
      function buildGuideText() {
        const b = state.basic;
        const o = state.options;

        const nameOrOrg = b.customerName || b.customerOrg;
        if (!nameOrOrg) {
          return "";
        }

        const lines = [];
        const titleLine = (b.customerOrg || "") + (b.customerDept ? " " + b.customerDept : "");
        const nameLine =
          (b.customerName || "") +
          (b.customerTitle ? " " + b.customerTitle : "");

        if (titleLine.trim()) lines.push(titleLine.trim());
        if (nameLine.trim()) lines.push(nameLine.trim());
        lines.push("");

        // ì¸ì‚¬ë§
        let greet = "";
        if (o.tone === "very_polite") {
          greet = `${nameOrOrg} ê·€í•˜ê»˜,\ní•­ìƒ ê·€ì¤‘í•œ ì—°êµ¬ì™€ ì—…ë¬´ì— ê¹Šì€ ì¡´ê²½ì˜ ë§ˆìŒì„ ì „í•©ë‹ˆë‹¤.`;
        } else if (o.tone === "simple") {
          greet = `${nameOrOrg}ê»˜,\në¬¸ì˜ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.`;
        } else {
          greet = `${nameOrOrg} ê·€í•˜ê»˜,\ní•­ìƒ ì†Œì¤‘í•œ ì—°êµ¬ì™€ í˜‘ë ¥ì— ê°ì‚¬ë“œë¦¬ë©°, ì•„ë˜ì™€ ê°™ì´ ê´€ë ¨ ìë£Œë¥¼ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.`;
        }
        lines.push(greet);
        lines.push("");

        // ìƒí™© ì„¤ëª…
        if (o.guideType === "new") {
          lines.push(
            "ì´ë²ˆ ì•ˆë‚´ì„œëŠ” ì‹ ê·œ ë¬¸ì˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, í˜„ì¬ ì—°êµ¬ ë°©í–¥ê³¼ ì˜ˆì‚° ë²”ìœ„ì— ë§ì¶”ì–´ ì„ ë³„í•œ ë³´ê³ ì„œì™€ ìë£Œë¥¼ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤."
          );
        } else if (o.guideType === "existing") {
          lines.push(
            "ì´ë²ˆ ì•ˆë‚´ì„œëŠ” ê¸°ì¡´ì— ì•ˆë‚´ë“œë¦° ë‚´ìš©ì— ìµœê·¼ ì—…ë°ì´íŠ¸ëœ ìë£Œì™€ ì¶”ê°€ ìš”ì²­ ì‚¬í•­ì„ ë°˜ì˜í•˜ì—¬ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤."
          );
        } else {
          lines.push(
            "ì´ë²ˆ ì•ˆë‚´ì„œëŠ” ì´ì „ ë¬¸ì˜ ì´í›„ ì¶”ê°€ë¡œ ìš”ì²­ ì£¼ì‹  ë‚´ìš©ê³¼ ìµœì‹  ë™í–¥ì„ ë°˜ì˜í•˜ì—¬ ë³´ì™„Â·ì •ë¦¬í•œ ìë£Œì…ë‹ˆë‹¤."
          );
        }

        // ì—°êµ¬ ë¶„ì•¼ / ì˜ˆì‚° / í‚¤ì›Œë“œ
        const researchParts = [];
        if (b.customerField) {
          researchParts.push(`ì—°êµ¬Â·ê´€ì‹¬ ë¶„ì•¼: ${b.customerField}`);
        }
        if (b.customerBudget) {
          researchParts.push(`ì˜ˆìƒ ì˜ˆì‚°/ì—°êµ¬ë¹„: ${b.customerBudget}`);
        }
        if (o.keywords) {
          researchParts.push(`í•µì‹¬ í‚¤ì›Œë“œ: ${o.keywords}`);
        }
        if (researchParts.length > 0) {
          lines.push("");
          lines.push(researchParts.join(" Â· "));
        }

        // ìƒì„¸ ë©”ëª¨
        if (o.detailMemo) {
          lines.push("");
          lines.push("ìš”ì²­Â·ìƒë‹´ ë©”ëª¨:");
          lines.push(o.detailMemo);
        }

        // ë³´ê³ ì„œ ëª©ë¡
        const reportLines = (o.reportList || "")
          .split(/\r?\n/)
          .map((s) => s.trim())
          .filter((s) => s.length > 0);

        if (reportLines.length > 0) {
          lines.push("");
          lines.push("â… . ì œì•ˆ ë“œë¦¬ëŠ” ì£¼ìš” ë³´ê³ ì„œ / ìë£Œ ëª©ë¡");
          reportLines.forEach((r, idx) => {
            lines.push(`${idx + 1}. ${r}`);
          });
        }

        // ì±„ë„ ì„¤ëª…
        lines.push("");
        if (o.channel === "email") {
          lines.push(
            "ìœ„ ë‚´ìš©ì€ ì´ë©”ì¼ ë³¸ë¬¸ê³¼ ì²¨ë¶€ íŒŒì¼ ì•ˆë‚´ìš©ìœ¼ë¡œ ë°”ë¡œ í™œìš©í•˜ì‹¤ ìˆ˜ ìˆë„ë¡ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤."
          );
        } else if (o.channel === "word") {
          lines.push(
            "ìœ„ ë‚´ìš©ì€ ì›Œë“œ íŒŒì¼(ì ê¸ˆ í…œí”Œë¦¿)ì— ê·¸ëŒ€ë¡œ ë¶™ì—¬ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆë„ë¡ ë‹¨ë½ë³„ë¡œ ì •ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤."
          );
        } else {
          lines.push(
            "ìœ„ ë‚´ìš©ì€ PDF ì•ˆë‚´ì„œ ë° ìš”ì•½ìë£Œë¡œ ë³€í™˜í•´ ì‚¬ìš©í•˜ì‹œê¸° ì‰½ë„ë¡ ë¬¸ë‹¨ êµ¬ì¡°ë¥¼ ë‹¨ìˆœí™”í•˜ì—¬ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤."
          );
        }

        // ë§ˆë¬´ë¦¬ ì•ˆë‚´
        lines.push("");
        lines.push(
          "ì¶”ê°€ë¡œ í•„ìš”í•˜ì‹  ì„¸ë¶€ ë°ì´í„°ë‚˜ ë‹¤ë¥¸ ì£¼ì œì˜ ë³´ê³ ì„œê°€ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ íšŒì‹  ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤."
        );
        if (b.customerEmail) {
          lines.push(`íšŒì‹ ì€ ë³¸ ë©”ì¼ ë˜ëŠ” ${b.customerEmail} ë¡œ ì£¼ì…”ë„ ë©ë‹ˆë‹¤.`);
        }
        lines.push("");
        lines.push("ê°ì‚¬í•©ë‹ˆë‹¤.");
        lines.push("ì›”ë“œì‚°ì—…ì •ë³´ì„¼í„° ë“œë¦¼");

        // ì§§ì€ ë©”ëª¨
        if (b.customerShortMemo) {
          lines.push("");
          lines.push("[ë‚´ë¶€ ë©”ëª¨]");
          lines.push(b.customerShortMemo);
        }

        return lines.join("\n");
      }

      // ===== Follow-up ìš”ì•½ ìƒì„± =====
      function buildFollowupSummary() {
        const f = state.followup;
        const lines = [];
        lines.push("ë‹¤ìŒ í•  ì¼ ìš”ì•½:");

        function line(label, value) {
          if (value) {
            lines.push(`- ${label}: ${value}`);
          } else {
            lines.push(`- ${label}: (ë¯¸ì •)`);
          }
        }

        line("ì „í™” ìƒë‹´ ì˜ˆì •", f.call);
        line("ì•ˆë‚´ ë©”ì¼ ë°œì†¡ / íšŒì‹  ëŒ€ê¸°", f.mail);
        line("ê³µì‹ ê²¬ì ì„œ / ì¸ë³´ì´ìŠ¤ ë°œì†¡", f.quote);
        line("ì…ì°° / ì¡°ë‹¬ ë“±ë¡ ì¤€ë¹„", f.bid);

        if (f.memo) {
          lines.push("");
          lines.push("[ì¶”ê°€ ë©”ëª¨]");
          lines.push(f.memo);
        }

        return lines.join("\n");
      }

      // ===== ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ =====
      el.btnGenerate.addEventListener("click", function() {
        readBasicFromDOM();
        readOptionsFromDOM();

        const hasNameOrOrg = !!(state.basic.customerName || state.basic.customerOrg);
        if (!hasNameOrOrg) {
          el.basicStatus.textContent = "ê¸°ë³¸ ì •ë³´ ìƒíƒœ: í•„ìˆ˜ í•­ëª© ëˆ„ë½ (ì´ë¦„ ë˜ëŠ” ê¸°ê´€ 1ê°œ ì´ìƒ í•„ìš”)";
          return;
        }

        const text = buildGuideText();
        if (!text) return;

        // ì¹´ìš´íŠ¸/ì‹œê°„ ì—…ë°ì´íŠ¸
        const now = new Date();
        const today = todayStr();
        if (state.todayDate !== today) {
          state.todayDate = today;
          state.todayCount = 0;
        }
        state.totalCount += 1;
        state.todayCount += 1;
        state.lastGeneratedAt = now.toISOString();

        state.preview.text = text;
        state.preview.mode = "formatted";

        state.lastUpdated = now.toISOString();

        renderStats();
        renderBasic();
        renderOptions();
        renderPreview();
        saveState(state);
      });

      el.btnAppendMemo.addEventListener("click", function() {
        const memo = el.detailMemo.value.trim();
        if (!memo) return;
        if (!state.preview.text || state.preview.text.trim().length === 0) {
          // ë¯¸ë¦¬ë³´ê¸°ê°€ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„± ìœ ë„
          el.previewStatus.textContent = "ì•ˆë‚´ì„œ ìƒíƒœ: ë¨¼ì € ìë™ ì•ˆë‚´ì„œ ì´ˆì•ˆì„ ìƒì„±í•´ ì£¼ì„¸ìš”.";
          return;
        }
        state.preview.text += "\n\n[ì¶”ê°€ ë©”ëª¨]\n" + memo;
        state.preview.mode = state.preview.mode || "formatted";
        state.lastUpdated = new Date().toISOString();
        renderPreview();
        saveState(state);
      });

      el.btnClearInputs.addEventListener("click", function() {
        state.basic = {
          customerName: "",
          customerTitle: "",
          customerOrg: "",
          customerDept: "",
          customerField: "",
          customerBudget: "",
          customerEmail: "",
          customerShortMemo: ""
        };
        state.options.keywords = "";
        state.options.reportList = "";
        state.options.detailMemo = "";
        renderBasic();
        renderOptions();
        state.lastUpdated = new Date().toISOString();
        saveState(state);
      });

      el.btnModeFormatted.addEventListener("click", function() {
        state.preview.mode = "formatted";
        renderPreview();
        saveState(state);
      });

      el.btnModePlain.addEventListener("click", function() {
        state.preview.mode = "plain";
        renderPreview();
        saveState(state);
      });

      el.btnCopy.addEventListener("click", function() {
        const text = state.preview.text || "";
        if (!text.trim()) return;
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(text).catch(function() {});
        } else {
          const ta = document.createElement("textarea");
          ta.value = text;
          document.body.appendChild(ta);
          ta.select();
          try { document.execCommand("copy"); } catch (_e) {}
          document.body.removeChild(ta);
        }
      });

      el.btnAddDivider.addEventListener("click", function() {
        if (!state.preview.text || state.preview.text.trim().length === 0) return;
        state.preview.text += "\n\n----------------------------------------\n";
        state.preview.mode = state.preview.mode || "formatted";
        state.lastUpdated = new Date().toISOString();
        renderPreview();
        saveState(state);
      });

      el.btnFollowupSave.addEventListener("click", function() {
        readFollowupFromDOM();
        state.followup.summary = buildFollowupSummary();
        state.lastUpdated = new Date().toISOString();
        renderFollowup();
        renderFollowupStatus(true);
        saveState(state);
      });

      el.btnFollowupRecalc.addEventListener("click", function() {
        readFollowupFromDOM();
        state.followup.summary = buildFollowupSummary();
        renderFollowup();
        renderFollowupStatus(false);
        saveState(state);
      });

      el.btnFollowupReset.addEventListener("click", function() {
        state.followup = {
          call: "",
          mail: "",
          quote: "",
          bid: "",
          memo: "",
          summary: ""
        };
        state.lastUpdated = new Date().toISOString();
        renderFollowup();
        renderFollowupStatus(false);
        saveState(state);
      });

      // ===== ì´ˆê¸° ë¡œë“œ =====
      function init() {
        const loaded = loadState();
        if (loaded && loaded.version === "1.0") {
          state = Object.assign(getInitialState(), loaded);
        }
        // ì˜¤ëŠ˜ ë‚ ì§œ ê°±ì‹  ì²˜ë¦¬
        const today = todayStr();
        if (state.todayDate !== today) {
          state.todayDate = today;
          state.todayCount = 0;
        }
        renderAll();
        wireAutoSave();
        wireCSVImport();
      }

      init();
    })();
  </script>
</body>
</html>
