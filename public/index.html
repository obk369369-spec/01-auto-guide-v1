<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>1ë²ˆ ë„êµ¬ Â· ê³ ê° ìë™í™” ì•ˆë‚´ì„œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f6f3e9;
      --bg-card: #ffffff;
      --border-soft: #e0d7c7;
      --border-strong: #c2b59b;
      --text-main: #2c2415;
      --text-sub: #6b6046;
      --accent: #c27b24;
      --accent-soft: #fbe8c9;
      --danger: #b91c1c;
      --success: #166534;
      --shadow-soft: 0 8px 24px rgba(60, 52, 38, 0.12);
      --radius-large: 16px;
      --radius-small: 10px;
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      font-family: var(--font-main);
      background: radial-gradient(circle at top left, #fbf7ee, #f1e8d7);
      color: var(--text-main);
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
    }

    .app-shell {
      width: 100%;
      max-width: 1150px;
      padding: 18px 12px 32px;
    }

    @media (min-width: 900px) {
      .app-shell { padding: 24px 0 40px; }
    }

    /* í—¤ë” */

    .header {
      background: linear-gradient(120deg, #fdf6e8, #f4ead7);
      border-radius: 18px;
      padding: 14px 16px 14px;
      box-shadow: var(--shadow-soft);
      border: 1px solid #e3d3b8;
      margin-bottom: 14px;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 12px;
    }

    @media (max-width: 800px) {
      .header { grid-template-columns: minmax(0, 1fr); }
    }

    .title-main {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .title-sub {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 8px;
      line-height: 1.4;
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(194, 123, 36, 0.5);
      background: rgba(255, 255, 255, 0.9);
      color: #8c5311;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .tag-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #c27b24;
    }

    .header-stats {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      align-items: center;
    }

    @media (max-width: 900px) {
      .header-stats { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.94);
      border-radius: 14px;
      padding: 7px 9px;
      border: 1px solid var(--border-soft);
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-height: 52px;
      justify-content: center;
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-sub);
    }

    .stat-value {
      font-size: 16px;
      font-weight: 700;
    }

    .stat-pill {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: #8c5311;
      align-self: flex-start;
    }

    .stat-meta {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 4px;
    }

    /* ë ˆì´ì•„ì›ƒ */

    .layout-main {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.2fr);
      gap: 12px;
    }

    @media (max-width: 980px) {
      .layout-main { grid-template-columns: minmax(0, 1fr); }
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-large);
      padding: 12px 12px 14px;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    .badge {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #fdfaf5;
      color: var(--text-sub);
      white-space: nowrap;
    }

    .section-body {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field-row {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 8px;
    }

    @media (max-width: 720px) {
      .field-row { grid-template-columns: minmax(0, 1fr); }
    }

    .field-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .field-label {
      font-size: 12px;
      font-weight: 500;
    }

    .field-hint {
      font-size: 11px;
      color: var(--text-sub);
    }

    input[type="text"],
    textarea,
    select,
    input[type="date"] {
      width: 100%;
      border-radius: var(--radius-small);
      border: 1px solid var(--border-soft);
      padding: 6px 8px;
      font-size: 12px;
      font-family: var(--font-main);
      background: #fdfaf5;
    }

    textarea {
      min-height: 70px;
      resize: vertical;
      max-height: 220px;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(194, 123, 36, 0.25);
      background: #ffffff;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid var(--border-soft);
      background: #fbf5ea;
      color: var(--text-sub);
      gap: 4px;
    }

    .status-pill.ok {
      background: #e0f6e9;
      color: var(--success);
      border-color: #bbf7d0;
    }

    .status-pill.warn {
      background: #fef3c7;
      color: #92400e;
      border-color: #fde68a;
    }

    .status-pill.error {
      background: #fee2e2;
      color: var(--danger);
      border-color: #fecaca;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #fdfaf5;
      padding: 6px 11px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.05s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(120deg, #c27b24, #d49232);
      color: #ffffff;
      border-color: #aa6310;
    }

    .btn-ghost {
      background: transparent;
    }

    .btn-icon {
      font-size: 14px;
      line-height: 0;
    }

    .btn:hover {
      box-shadow: 0 6px 16px rgba(60, 52, 38, 0.18);
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .pill-strip {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 4px;
      margin-top: 2px;
    }

    .pill-small {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #f7efe1;
      color: var(--text-sub);
      border: 1px solid var(--border-soft);
    }

    .pill-small.em {
      background: #e0f2fe;
      color: #075985;
      border-color: #bae6fd;
    }

    .preview-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
    }

    .toggle-group {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      overflow: hidden;
      background: #fdfaf5;
    }

    .toggle-btn {
      padding: 4px 9px;
      font-size: 11px;
      border: none;
      background: transparent;
      cursor: pointer;
      color: var(--text-sub);
    }

    .toggle-btn.active {
      background: #fbe8c9;
      color: #8c5311;
      font-weight: 600;
    }

    .preview-box {
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      background: #fffdf8;
      padding: 8px 9px;
      font-size: 12px;
      min-height: 130px;
      max-height: 260px;
      overflow-y: auto;
      white-space: pre-wrap;
      line-height: 1.45;
    }

    .preview-empty {
      font-size: 12px;
      color: var(--text-sub);
    }

    .note {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 4px;
    }

    .grid-two {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 10px;
    }

    @media (max-width: 820px) {
      .grid-two { grid-template-columns: minmax(0, 1fr); }
    }

    .summary-box {
      border-radius: 10px;
      border: 1px dashed var(--border-strong);
      padding: 7px 8px;
      background: #fdf9f0;
      font-size: 12px;
      min-height: 60px;
      white-space: pre-wrap;
    }

    .footer-note {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 8px;
      text-align: right;
    }

    .error-text {
      font-size: 11px;
      color: var(--danger);
      margin-top: 2px;
    }
  </style>
</head>
<body>
<div class="app-shell">
  <!-- í—¤ë” -->
  <header class="header">
    <div>
      <div class="title-main">1ë²ˆ ë„êµ¬ Â· ê³ ê° ìë™í™” ì•ˆë‚´ì„œ</div>
      <div class="title-sub">
        ì—°êµ¬ìÂ·ê³ ê° ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´, ì¸ì‚¬Â·ì†Œê°œÂ·ë§ì¶¤ ì œì•ˆÂ·í›„ì† ì•ˆë‚´ê¹Œì§€ í•œ ë²ˆì— ë¬¶ì¸ ì›Œë“œ/ë©”ì¼ìš© ì•ˆë‚´ì„œ ì´ˆì•ˆê³¼
        í›„ì† ì¡°ì¹˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ í•œ í™”ë©´ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.
      </div>
      <div class="tag-row">
        <div class="tag"><span class="tag-dot"></span> Local-only Â· Safe DOM Â· v1.0</div>
        <div class="tag"><span class="tag-dot"></span> í™”ë©´ì— ë³´ì´ëŠ” ê¸°ëŠ¥ë§Œ ë™ì‘</div>
        <div class="tag"><span class="tag-dot"></span> Word/ë©”ì¼ ì•ˆë‚´ì„œìš© í…ìŠ¤íŠ¸ ìƒì„±</div>
      </div>
      <div class="stat-meta" id="stateLine">ì´ˆê¸° ìƒíƒœ: ì•„ì§ ì €ì¥ ì—†ìŒ Â· ì €ì¥ ìœ„ì¹˜: localStorage Â· wic_tool1_state_v1</div>
    </div>
    <div class="header-stats">
      <div class="stat-card">
        <div class="stat-label">ëˆ„ì  ì•ˆë‚´ì„œ ìƒì„±</div>
        <div class="stat-value" id="statTotal">0</div>
        <div class="stat-pill">Generate count</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ì˜¤ëŠ˜ ë§Œë“  ì•ˆë‚´ì„œ</div>
        <div class="stat-value" id="statToday">0</div>
        <div class="stat-pill">Today</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ë§ˆì§€ë§‰ ìƒì„± ì‹œê°</div>
        <div class="stat-value" style="font-size:13px;" id="statLast">-</div>
      </div>
    </div>
  </header>

  <!-- ë©”ì¸ ë ˆì´ì•„ì›ƒ -->
  <main class="layout-main">
    <!-- ì¢Œì¸¡: A + B -->
    <section class="card">
      <div class="card-header">
        <div>
          <div class="card-title">A. ê³ ê° ê¸°ë³¸ ì •ë³´</div>
          <div class="card-subtitle">
            ì—‘ì…€ ê³ ê°DBì—ì„œ ì˜®ê²¨ ì ëŠ” ê¸°ì¤€ìœ¼ë¡œ, ì•ˆë‚´ì„œì— í•„ìˆ˜ë¡œ ë“¤ì–´ê°€ëŠ” ê¸°ë³¸ í•„ë“œì…ë‹ˆë‹¤. ì´ë¦„ ë˜ëŠ” ê¸°ê´€ ì¤‘ 1ê°œ ì´ìƒì€ ê¼­ ì ì–´ì•¼ í•©ë‹ˆë‹¤.
          </div>
        </div>
        <span class="status-pill" id="basicStatus">ê¸°ë³¸ ì •ë³´ ìƒíƒœ: ëŒ€ê¸° ì¤‘</span>
      </div>
      <div class="section-body">
        <div class="field-row">
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputName">ê³ ê° ì´ë¦„</label>
              <span class="field-hint">ì˜ˆ: í™ê¸¸ë™</span>
            </div>
            <input type="text" id="inputName" placeholder="ì˜ˆ: í™ê¸¸ë™" />
          </div>
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputTitle">ì§í•¨ / ì§ìœ„</label>
              <span class="field-hint">ì˜ˆ: ë°•ì‚¬ / ì±…ì„ì—°êµ¬ì›</span>
            </div>
            <input type="text" id="inputTitle" placeholder="ì˜ˆ: ë°•ì‚¬ / ì±…ì„ì—°êµ¬ì›" />
          </div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputOrg">ê¸°ê´€ / íšŒì‚¬</label>
              <span class="field-hint">ì˜ˆ: KIST / KITECH</span>
            </div>
            <input type="text" id="inputOrg" placeholder="ì˜ˆ: KIST / KITECH" />
          </div>
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputDept">ë¶€ì„œ / ì—°êµ¬ì‹¤</label>
              <span class="field-hint">ì˜ˆ: ì†Œì¬ë¶€í’ˆì—°êµ¬ë¶€</span>
            </div>
            <input type="text" id="inputDept" placeholder="ì˜ˆ: ì†Œì¬ë¶€í’ˆì—°êµ¬ë¶€" />
          </div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputField">ì—°êµ¬ / ê´€ì‹¬ ë¶„ì•¼</label>
              <span class="field-hint">ì˜ˆ: ë°˜ë„ì²´ íŒ¨í‚¤ì§• ì ‘ì°©ì œ</span>
            </div>
            <input type="text" id="inputField" placeholder="ì˜ˆ: ë°˜ë„ì²´ íŒ¨í‚¤ì§• ì ‘ì°©ì œ" />
          </div>
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputBudget">ì˜ˆìƒ ì˜ˆì‚° / ì—°êµ¬ë¹„</label>
              <span class="field-hint">ì˜ˆ: ì—° 1,200ë§Œì›</span>
            </div>
            <input type="text" id="inputBudget" placeholder="ì˜ˆ: ì—° 1,200ë§Œì›" />
          </div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputEmail">ì´ë©”ì¼ (ì„ íƒ)</label>
              <span class="field-hint">ì˜ˆ: example@org.re.kr</span>
            </div>
            <input type="text" id="inputEmail" placeholder="ì˜ˆ: example@org.re.kr" />
          </div>
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputShortMemo">ë‚´ ë©”ëª¨ (ì§§ê²Œ)</label>
              <span class="field-hint">ì˜ˆ: ê¸°ì¡´ ê³ ê° / ì˜ˆì‚° ìˆìŒ</span>
            </div>
            <input type="text" id="inputShortMemo" placeholder="ì˜ˆ: ê¸°ì¡´ ê³ ê° / ì˜ˆì‚° ìˆìŒ" />
          </div>
        </div>
        <div class="note">Â· ì´ë¦„Â·ê¸°ê´€Â·ì—°êµ¬ë¶„ì•¼ëŠ” ì•ˆë‚´ì„œ ì¸ì‚¬ë§, ë³¸ë¬¸ ìš”ì•½ì— ìë™ ë°˜ì˜ë©ë‹ˆë‹¤.</div>
      </div>

      <hr style="border:none;border-top:1px dashed var(--border-soft);margin:10px 0;" />

      <div class="card-header">
        <div>
          <div class="card-title">B. ì•ˆë‚´ì„œ ì˜µì…˜ Â· ë³´ê³ ì„œ ëª©ë¡</div>
          <div class="card-subtitle">
            ì‹ ê·œ ë¬¸ì˜ / ê¸°ì¡´ ê³ ê° / ì¬ë¬¸ì˜ ìƒí™©ì— ë”°ë¼, í…œí”Œë¦¿ êµ¬ì¡°ì™€ í†¤ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
          </div>
        </div>
        <span class="status-pill" id="optionStatus">ì˜µì…˜ ìƒíƒœ: ê¸°ë³¸ê°’ ì‚¬ìš© ì¤‘</span>
      </div>

      <div class="section-body">
        <div class="field-row">
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="selectType">ì•ˆë‚´ì„œ ìœ í˜•</label>
              <span class="field-hint">ìƒí™© ì„ íƒ</span>
            </div>
            <select id="selectType">
              <option value="new">ì‹ ê·œ ë¬¸ì˜ / ì²« ì•ˆë‚´</option>
              <option value="existing">ê¸°ì¡´ ê³ ê° / ì¶”ê°€ ì•ˆë‚´</option>
              <option value="revisit">ì¬ë¬¸ì˜ / ì—…ë°ì´íŠ¸ ì•ˆë‚´</option>
            </select>
          </div>
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="selectTone">ë¬¸ì²´ / í†¤</label>
              <span class="field-hint">ì˜ˆ: ì—°êµ¬ì ëŒ€ìƒ ì¡´ëŒ“ë§</span>
            </div>
            <select id="selectTone">
              <option value="research-polite">ì—°êµ¬ììš© ì •ì¤‘í•œ í†¤ (ê¸°ë³¸)</option>
              <option value="business-polite">ë¹„ì¦ˆë‹ˆìŠ¤ ì •ì¤‘ í†¤</option>
              <option value="simple-polite">ê°„ë‹¨Â·ë‹¨ë¬¸ ì¡´ëŒ“ë§</option>
            </select>
          </div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputKeywords">í•µì‹¬ í‚¤ì›Œë“œ (ì½¤ë§ˆ êµ¬ë¶„)</label>
              <span class="field-hint">ì˜ˆ: ê¸€ë¼ìŠ¤ ì„œë¸ŒìŠ¤íŠ¸ë ˆì´íŠ¸, ì ‘ì°©ì œ</span>
            </div>
            <input type="text" id="inputKeywords" placeholder="í‚¤ì›Œë“œ1, í‚¤ì›Œë“œ2, ..." />
          </div>
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="selectChannel">ì˜ˆìƒ ì‚¬ìš© ì±„ë„</label>
              <span class="field-hint">ë©”ì¼ / ì›Œë“œ / PDF</span>
            </div>
            <select id="selectChannel">
              <option value="email">ì´ë©”ì¼ ë³¸ë¬¸ìš©</option>
              <option value="word">Word ë¬¸ì„œìš©</option>
              <option value="pdf">PDF ì•ˆë‚´ì„œìš©</option>
            </select>
          </div>
        </div>

        <div class="field-group">
          <div class="field-label-row">
            <label class="field-label" for="textareaReports">ë³´ê³ ì„œ / ìë£Œ ëª©ë¡</label>
            <span class="field-hint">í•œ ì¤„ë‹¹ 1ê°œ Â· ì œëª©ë§Œ ì ìœ¼ë©´ ë²ˆí˜¸ ë§¤ê¹€</span>
          </div>
          <textarea id="textareaReports" placeholder="ì˜ˆì‹œ)
Glass Substrate for Advanced Packaging 2025
Semiconductor Packaging Adhesives: Global Market 2024
ê³ ê¸°ëŠ¥ ì ‘ì°©ì œÂ·ì‹¤ë€íŠ¸ ì„¸ê³„ì‹œì¥ 2023"></textarea>
        </div>

        <div class="field-group">
          <div class="field-label-row">
            <label class="field-label" for="textareaDetailMemo">ê³ ê° ìƒì„¸ ë©”ëª¨ (ì•ˆë‚´ì„œ ë³¸ë¬¸ ë°˜ì˜)</label>
            <span class="field-hint">ì „í™” ë‚´ìš©, ì˜ˆì‚°, ì›í•˜ëŠ” í¬ì¸íŠ¸ ë“± ììœ  ì…ë ¥</span>
          </div>
          <textarea id="textareaDetailMemo" placeholder="ì˜ˆ)
- ìµœê·¼ íŒ¨í‚¤ì§•ìš© ìœ ë¦¬ê¸°íŒ ê´€ë ¨ ì¤‘ì¥ê¸° ë¡œë“œë§µ ìˆ˜ë¦½ ì¤‘
- êµ­ë‚´Â·í•´ì™¸ ì—…ì²´ ë™í–¥, ê³µì •ë³„ ê¸°ìˆ  í¬ì¸íŠ¸, ë¹„ìš©Â·íˆ¬ì ê·œëª¨ ë°ì´í„° í•„ìš”
- ê¸°í•œ: ë‹¤ìŒ ë‹¬ ì˜ˆì‚° ì§‘í–‰ ì „ê¹Œì§€"></textarea>
        </div>

        <div class="btn-row">
          <button class="btn btn-primary" id="btnGenerate"><span class="btn-icon">âš™ï¸</span> ìë™ ì•ˆë‚´ì„œ ì´ˆì•ˆ ìƒì„±</button>
          <button class="btn" id="btnAppendMemo"><span class="btn-icon">â•</span> ë©”ëª¨ë¥¼ ì•ˆë‚´ì„œì— ë§ë¶™ì´ê¸°</button>
          <button class="btn btn-ghost" id="btnClearInputs"><span class="btn-icon">ğŸ§¹</span> ì…ë ¥ ë‚´ìš© ì´ˆê¸°í™”</button>
        </div>
        <div id="optionError" class="error-text" style="display:none;"></div>
      </div>
    </section>

    <!-- ìš°ì¸¡: C + D -->
    <section class="card">
      <!-- C. ë¯¸ë¦¬ë³´ê¸° -->
      <div class="card-header">
        <div>
          <div class="card-title">C. ìë™ ì•ˆë‚´ì„œ ë¯¸ë¦¬ë³´ê¸°</div>
          <div class="card-subtitle">
            ì¸ì‚¬Â·ì†Œê°œÂ·ë§ì¶¤ ì œì•ˆÂ·í›„ì† ì•ˆë‚´ê¹Œì§€ í•œ ë²ˆì— ë¶™ì—¬ ë„£ì„ ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.
          </div>
        </div>
        <span class="status-pill" id="previewStatus">ì•ˆë‚´ì„œ ìƒíƒœ: ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</span>
      </div>

      <div class="section-body">
        <div class="preview-header">
          <div class="toggle-group" aria-label="ë³´ê¸° ëª¨ë“œ ì„ íƒ">
            <button type="button" class="toggle-btn active" id="btnModeFormatted">ğŸ“„ ì•ˆë‚´ì„œ í˜•ì‹</button>
            <button type="button" class="toggle-btn" id="btnModePlain">ğŸ“‹ ìˆœìˆ˜ í…ìŠ¤íŠ¸</button>
          </div>
          <div class="btn-row" style="margin-top:0;">
            <button class="btn" id="btnCopy"><span class="btn-icon">ğŸ“</span> ë³µì‚¬</button>
            <button class="btn btn-ghost" id="btnAddSeparator"><span class="btn-icon">ğŸ“</span> ì›Œë“œ êµ¬ë¶„ì„ </button>
          </div>
        </div>
        <div id="previewBox" class="preview-box">
          <div class="preview-empty">
            ì•„ì§ ìë™ ì•ˆë‚´ì„œê°€ ì—†ìŠµë‹ˆë‹¤. ì™¼ìª½ì—ì„œ ê³ ê° ì •ë³´ì™€ ì˜µì…˜ì„ ì…ë ¥í•œ ë’¤
            ã€Œìë™ ì•ˆë‚´ì„œ ì´ˆì•ˆ ìƒì„±ã€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.
          </div>
        </div>
        <div class="note">
          Â· ì´ ì•ˆë‚´ì„œëŠ” ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©°, ìƒˆë¡œê³ ì¹¨ í›„ì—ë„ ë³µì›ë©ë‹ˆë‹¤. (Word ì ê¸ˆì€ ë³„ë„ í…œí”Œë¦¿ì—ì„œ ì²˜ë¦¬)
        </div>
      </div>

      <hr style="border:none;border-top:1px dashed var(--border-soft);margin:10px 0;" />

      <!-- D. í›„ì† ì¡°ì¹˜ -->
      <div class="card-header">
        <div>
          <div class="card-title">D. í›„ì† ì¡°ì¹˜ Â· Follow-up ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
          <div class="card-subtitle">
            ì•ˆë‚´ì„œì™€ ì—°ê²°ëœ ì „í™” / ë©”ì¼ / ê²¬ì  / ì…ì°° ë“± í›„ì† í–‰ë™ì„ ë¡œì»¬ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.
          </div>
        </div>
        <span class="status-pill" id="followStatus">í›„ì† ì¡°ì¹˜ ìƒíƒœ: ë¯¸ì €ì¥</span>
      </div>

      <div class="section-body">
        <div class="pill-strip">
          <span class="pill-small">ê³ ê° ë‹¨ìœ„ ë¡œì»¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</span>
          <span class="pill-small em" id="nextTodoBadge">ë‹¤ìŒ í•  ì¼ ìš”ì•½: ì—†ìŒ</span>
        </div>

        <div class="grid-two">
          <div>
            <div class="field-group">
              <div class="field-label-row">
                <label class="field-label" for="datePhone">ì „í™” ìƒë‹´ ì˜ˆì •</label>
                <span class="field-hint">ì—°ë„-ì›”-ì¼</span>
              </div>
              <input type="date" id="datePhone" />
            </div>
            <div class="field-group">
              <div class="field-label-row">
                <label class="field-label" for="dateMail">ì•ˆë‚´ ë©”ì¼ ë°œì†¡ / íšŒì‹  ëŒ€ê¸°</label>
                <span class="field-hint">ì—°ë„-ì›”-ì¼</span>
              </div>
              <input type="date" id="dateMail" />
            </div>
          </div>
          <div>
            <div class="field-group">
              <div class="field-label-row">
                <label class="field-label" for="dateQuote">ê³µì‹ ê²¬ì ì„œ / ì¸ë³´ì´ìŠ¤ ë°œì†¡</label>
                <span class="field-hint">ì—°ë„-ì›”-ì¼</span>
              </div>
              <input type="date" id="dateQuote" />
            </div>
            <div class="field-group">
              <div class="field-label-row">
                <label class="field-label" for="dateBid">ì…ì°° / ì¡°ë‹¬ ë“±ë¡ ì¤€ë¹„</label>
                <span class="field-hint">ì—°ë„-ì›”-ì¼</span>
              </div>
              <input type="date" id="dateBid" />
            </div>
          </div>
        </div>

        <div class="field-group">
          <div class="field-label-row">
            <label class="field-label" for="textareaFollowMemo">ì¶”ê°€ ë©”ëª¨ (í›„ì† ì¡°ì¹˜ìš©)</label>
            <span class="field-hint">ì˜ˆ: ì…ì°° ë§ˆê°ì¼ / ë‚´ë¶€ ê²°ì¬ ì¼ì •</span>
          </div>
          <textarea id="textareaFollowMemo" placeholder="ì˜ˆ)
- KISTI ì¡°ë‹¬ ë“±ë¡ í•„ìš” ì—¬ë¶€ í™•ì¸
- ë‚´ë¶€ ê²°ì¬ë¼ì¸: íŒ€ì¥ â†’ ë³¸ë¶€ì¥
- ì˜ˆì‚° ì§‘í–‰ ê¸°í•œ: 1ì›” ë§ê¹Œì§€"></textarea>
        </div>

        <div class="field-group">
          <div class="field-label-row">
            <label class="field-label">ë‹¤ìŒ í•  ì¼ ìš”ì•½</label>
            <span class="field-hint">ì²´í¬ë¦¬ìŠ¤íŠ¸ ê°’ìœ¼ë¡œ ìë™ ì •ë¦¬</span>
          </div>
          <div id="followSummary" class="summary-box">
ì•„ì§ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ ì±„ìš´ ë’¤ ã€Œìš”ì•½ ë‹¤ì‹œ ê³„ì‚°ã€ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.
          </div>
        </div>

        <div class="btn-row">
          <button class="btn" id="btnSaveFollow"><span class="btn-icon">ğŸ’¾</span> í›„ì† ì¡°ì¹˜ ìƒíƒœ ì €ì¥</button>
          <button class="btn btn-ghost" id="btnRecalcFollow"><span class="btn-icon">ğŸ”„</span> ìš”ì•½ ë‹¤ì‹œ ê³„ì‚°</button>
          <button class="btn btn-ghost" id="btnClearFollow"><span class="btn-icon">â™»ï¸</span> ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”</button>
        </div>
      </div>

      <div class="footer-note">Local-only / Static Â· public/index.html Â· ê³ ê° ìë™í™” ì•ˆë‚´ì„œ v1.0</div>
    </section>
  </main>
</div>

<script>
(function () {
  "use strict";

  const STATE_KEY = "wic_tool1_state_v1";

  const $ = (id) => document.getElementById(id);

  // ê¸°ë³¸ ì •ë³´
  const inputName = $("inputName");
  const inputTitle = $("inputTitle");
  const inputOrg = $("inputOrg");
  const inputDept = $("inputDept");
  const inputField = $("inputField");
  const inputBudget = $("inputBudget");
  const inputEmail = $("inputEmail");
  const inputShortMemo = $("inputShortMemo");

  const basicStatus = $("basicStatus");
  const optionStatus = $("optionStatus");
  const previewStatus = $("previewStatus");
  const followStatus = $("followStatus");
  const stateLine = $("stateLine");
  const optionError = $("optionError");

  // ì˜µì…˜Â·ë³´ê³ ì„œ
  const selectType = $("selectType");
  const selectTone = $("selectTone");
  const inputKeywords = $("inputKeywords");
  const selectChannel = $("selectChannel");
  const textareaReports = $("textareaReports");
  const textareaDetailMemo = $("textareaDetailMemo");

  // ë²„íŠ¼
  const btnGenerate = $("btnGenerate");
  const btnAppendMemo = $("btnAppendMemo");
  const btnClearInputs = $("btnClearInputs");

  // ë¯¸ë¦¬ë³´ê¸°
  const btnModeFormatted = $("btnModeFormatted");
  const btnModePlain = $("btnModePlain");
  const previewBox = $("previewBox");
  const btnCopy = $("btnCopy");
  const btnAddSeparator = $("btnAddSeparator");

  // í†µê³„
  const statTotal = $("statTotal");
  const statToday = $("statToday");
  const statLast = $("statLast");

  // í›„ì† ì¡°ì¹˜
  const datePhone = $("datePhone");
  const dateMail = $("dateMail");
  const dateQuote = $("dateQuote");
  const dateBid = $("dateBid");
  const textareaFollowMemo = $("textareaFollowMemo");
  const followSummary = $("followSummary");
  const nextTodoBadge = $("nextTodoBadge");
  const btnSaveFollow = $("btnSaveFollow");
  const btnRecalcFollow = $("btnRecalcFollow");
  const btnClearFollow = $("btnClearFollow");

  // ë‚´ë¶€ ìƒíƒœ
  let mode = "formatted"; // "formatted" | "plain"
  let formattedText = "";
  let plainText = "";
  let stats = {
    total: 0,
    todayCount: 0,
    todayDate: null,
    lastTime: null,
  };

  function safeLoadState() {
    try {
      const raw = localStorage.getItem(STATE_KEY);
      if (!raw) return null;
      return JSON.parse(raw);
    } catch (e) {
      return null;
    }
  }

  function safeSaveState(state) {
    try {
      localStorage.setItem(STATE_KEY, JSON.stringify(state));
      stateLine.textContent =
        "í˜„ì¬ ìƒíƒœ: localStorageì— ì €ì¥ë¨ Â· key: " + STATE_KEY;
    } catch (e) {
      stateLine.textContent = "ìƒíƒœ ì €ì¥ ì‹¤íŒ¨ (localStorage ì œí•œ ê°€ëŠ¥ì„±)";
    }
  }

  function formatDateTime(dt) {
    const y = dt.getFullYear();
    const m = String(dt.getMonth() + 1).padStart(2, "0");
    const d = String(dt.getDate()).padStart(2, "0");
    const hh = String(dt.getHours()).padStart(2, "0");
    const mm = String(dt.getMinutes()).padStart(2, "0");
    return `${y}-${m}-${d} ${hh}:${mm}`;
  }

  function todayKey(dt) {
    const y = dt.getFullYear();
    const m = String(dt.getMonth() + 1).padStart(2, "0");
    const d = String(dt.getDate()).padStart(2, "0");
    return `${y}-${m}-${d}`;
  }

  function updateBasicStatus() {
    const name = inputName.value.trim();
    const org = inputOrg.value.trim();
    const field = inputField.value.trim();
    const hasCore = name || org || field;
    basicStatus.className = "status-pill" + (hasCore ? " ok" : "");
    basicStatus.textContent = hasCore
      ? "ê¸°ë³¸ ì •ë³´ ìƒíƒœ: OK (í•µì‹¬ í•„ë“œ ì±„ì›Œì§)"
      : "ê¸°ë³¸ ì •ë³´ ìƒíƒœ: ëŒ€ê¸° ì¤‘";
  }

  function updateOptionStatus() {
    optionStatus.className = "status-pill ok";
    optionStatus.textContent = "ì˜µì…˜ ìƒíƒœ: ì„¤ì • ì™„ë£Œ";
  }

  function setPreviewEmpty() {
    previewBox.textContent =
      "ì•„ì§ ìë™ ì•ˆë‚´ì„œê°€ ì—†ìŠµë‹ˆë‹¤. ì™¼ìª½ì—ì„œ ê³ ê° ì •ë³´ì™€ ì˜µì…˜ì„ ì…ë ¥í•œ ë’¤ ã€Œìë™ ì•ˆë‚´ì„œ ì´ˆì•ˆ ìƒì„±ã€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.";
    previewStatus.className = "status-pill";
    previewStatus.textContent = "ì•ˆë‚´ì„œ ìƒíƒœ: ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
  }

  function renderPreview() {
    if (!formattedText && !plainText) {
      setPreviewEmpty();
      return;
    }
    previewStatus.className = "status-pill ok";
    previewStatus.textContent = "ì•ˆë‚´ì„œ ìƒíƒœ: ìƒì„± ì™„ë£Œ";
    previewBox.textContent = mode === "formatted" ? formattedText : plainText;
  }

  function setMode(newMode) {
    mode = newMode;
    if (mode === "formatted") {
      btnModeFormatted.classList.add("active");
      btnModePlain.classList.remove("active");
    } else {
      btnModeFormatted.classList.remove("active");
      btnModePlain.classList.add("active");
    }
    renderPreview();
  }

  function requiredCheck() {
    const name = inputName.value.trim();
    const org = inputOrg.value.trim();
    const field = inputField.value.trim();

    if (!name && !org) {
      return "ì´ë¦„ ë˜ëŠ” ê¸°ê´€ ì¤‘ 1ê°œ ì´ìƒì€ ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.";
    }
    if (!field) {
      return "ì—°êµ¬ / ê´€ì‹¬ ë¶„ì•¼ëŠ” ì•ˆë‚´ì„œ ë³¸ë¬¸ì— ê¼­ í•„ìš”í•©ë‹ˆë‹¤.";
    }
    return "";
  }

  function buildGuideText() {
    const name = inputName.value.trim();
    const org = inputOrg.value.trim();
    const dept = inputDept.value.trim();
    const title = inputTitle.value.trim();
    const field = inputField.value.trim();
    const budget = inputBudget.value.trim();
    const email = inputEmail.value.trim();
    const shortMemo = inputShortMemo.value.trim();

    const type = selectType.value;
    const tone = selectTone.value;
    const keywords = inputKeywords.value.trim();
    const channel = selectChannel.value;
    const reportsRaw = textareaReports.value;
    const detailMemo = textareaDetailMemo.value.trim();

    // ì¸ì‚¬ë§
    let greetLine = "ì•ˆë…•í•˜ì„¸ìš”.";
    if (org && dept && name && title) {
      greetLine = `ì•ˆë…•í•˜ì„¸ìš”, ${org} ${dept}ì—ì„œ ${field} ê´€ë ¨ ì—°êµ¬ë¥¼ ì§„í–‰í•˜ì‹œëŠ” ${title} ${name}ë‹˜.`;
    } else if (org && name) {
      greetLine = `ì•ˆë…•í•˜ì„¸ìš”, ${org}ì—ì„œ ${field}ë¥¼ ì—°êµ¬í•˜ì‹œëŠ” ${name}ë‹˜.`;
    } else if (name) {
      greetLine = `ì•ˆë…•í•˜ì„¸ìš”, ${field} ì—°êµ¬ë¥¼ ì§„í–‰ ì¤‘ì´ì‹  ${name}ë‹˜.`;
    } else if (org) {
      greetLine = `ì•ˆë…•í•˜ì„¸ìš”, ${org}ì—ì„œ ${field}ë¥¼ ë‹´ë‹¹í•˜ê³  ê³„ì‹  ì—°êµ¬ìë¶„ê»˜ ë“œë¦¬ëŠ” ì•ˆë‚´ì…ë‹ˆë‹¤.`;
    }

    // ìƒí™©ë³„ í•œ ì¤„
    let situationLine = "";
    if (type === "new") {
      situationLine =
        "ì›”ë“œì‚°ì—…ì •ë³´ì„¼í„°ì—ì„œ ê´€ë ¨ ì‹œì¥Â·ê¸°ìˆ  ìë£Œë¥¼ ì²˜ìŒìœ¼ë¡œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.";
    } else if (type === "existing") {
      situationLine =
        "ì´ì „ì— ì•ˆë‚´ë“œë¦° ìë£Œì™€ ì—°ê³„í•˜ì—¬, ì¶”ê°€ë¡œ ì°¸ê³ í•˜ì‹¤ ìˆ˜ ìˆëŠ” ìµœì‹  ë³´ê³ ì„œë¥¼ ì •ë¦¬í•´ ë“œë¦½ë‹ˆë‹¤.";
    } else if (type === "revisit") {
      situationLine =
        "ê¸°ì¡´ì— ê²€í† í•˜ì…¨ë˜ ì£¼ì œì— ëŒ€í•´, ì—…ë°ì´íŠ¸ëœ ìë£Œì™€ í•¨ê»˜ ë‹¤ì‹œ í•œ ë²ˆ ì •ë¦¬í•´ì„œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.";
    }

    // í†¤ / ì±„ë„ í•œ ì¤„
    let toneChannelLine = "";
    if (tone === "research-polite") {
      toneChannelLine =
        "ì—°êµ¬ì— ë°”ë¡œ í™œìš©í•˜ì‹¤ ìˆ˜ ìˆë„ë¡, ì—°êµ¬ì ë¶„ë“¤ê»˜ ë§ì¶˜ ì •ì¤‘í•˜ê³  ë‹¨ë¬¸ ìœ„ì£¼ì˜ ì•ˆë‚´ í˜•ì‹ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.";
    } else if (tone === "business-polite") {
      toneChannelLine =
        "ë‚´ë¶€ ê²°ì¬ ë° í˜‘ì˜ìš©ìœ¼ë¡œ í™œìš©í•˜ì‹¤ ìˆ˜ ìˆë„ë¡, ë¹„ì¦ˆë‹ˆìŠ¤ ë¬¸ë§¥ì— ë§ê²Œ ì •ë¦¬ëœ ë¬¸ì¥ êµ¬ì¡°ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.";
    } else {
      toneChannelLine =
        "ì½ê¸° ë¶€ë‹´ì´ ì ë„ë¡, í•µì‹¬ë§Œ ì§§ê²Œ ì •ë¦¬í•œ ì¡´ëŒ“ë§ ë¬¸ì²´ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.";
    }

    if (channel === "email") {
      toneChannelLine += " ë³¸ë¬¸ì€ ë©”ì¼ì— ê·¸ëŒ€ë¡œ ë¶™ì—¬ ë„£ì–´ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
    } else if (channel === "word") {
      toneChannelLine +=
        " ë³¸ë¬¸ì€ Word íŒŒì¼ì— ë¶™ì—¬ ë„£ì€ ë’¤, ë‚´ë¶€ ì–‘ì‹ì— ë§ê²Œ í¸ì§‘í•˜ì‹œë©´ ë©ë‹ˆë‹¤.";
    } else {
      toneChannelLine +=
        " ë³¸ë¬¸ì€ PDF ì•ˆë‚´ ìë£Œë¡œ ë³€í™˜í•˜ì—¬ ë‚´ë¶€ ê³µìœ ìš©ìœ¼ë¡œ í™œìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
    }

    // í‚¤ì›Œë“œ
    let keywordLine = "";
    if (keywords) {
      keywordLine = `ì£¼ìš” í‚¤ì›Œë“œëŠ” ${keywords} ì…ë‹ˆë‹¤.`;
    }

    // ì˜ˆì‚°
    let budgetLine = "";
    if (budget) {
      budgetLine = `ì˜ˆìƒ ì˜ˆì‚° ê·œëª¨ëŠ” ${budget} ìˆ˜ì¤€ìœ¼ë¡œ ì´í•´í•˜ê³  ìˆìŠµë‹ˆë‹¤.`;
    }

    // ë³´ê³ ì„œ ëª©ë¡
    const reportLines = reportsRaw
      .split(/\r?\n/)
      .map((l) => l.trim())
      .filter((l) => l.length > 0);

    let reportsBlock = "";
    if (reportLines.length > 0) {
      const numbered = reportLines.map((t, idx) => `${idx + 1}. ${t}`);
      reportsBlock =
        "â–  ê´€ë ¨ ë³´ê³ ì„œ / ìë£Œ ëª©ë¡\n" + numbered.join("\n");
    }

    // ìƒì„¸ ë©”ëª¨
    let memoBlock = "";
    if (detailMemo) {
      memoBlock =
        "â–  ê³ ê° ìš”ì²­ / ë°°ê²½ ë©”ëª¨\n" + detailMemo;
    }

    // ë§ˆë¬´ë¦¬
    let closing = "ìƒê¸° ìë£Œë“¤ì´ í˜„ì¬ ì§„í–‰ ì¤‘ì´ì‹  ì—°êµ¬ ë° ê³¼ì œ ê¸°íšì— ì‹¤ì§ˆì ì¸ ë„ì›€ì´ ë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.";
    if (email) {
      closing += `\nì¶”ê°€ë¡œ í•„ìš”í•˜ì‹  ì‚¬í•­ì´ ìˆìœ¼ë©´ ì–¸ì œë“ ì§€ ${email} ì£¼ì†Œë¡œ íšŒì‹  ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.`;
    } else {
      closing += "\nì¶”ê°€ë¡œ í•„ìš”í•˜ì‹  ì‚¬í•­ì´ ìˆìœ¼ë©´ ì–¸ì œë“ ì§€ íšŒì‹  ë˜ëŠ” ì „í™”ë¡œ ë§ì”€í•´ ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.";
    }

    if (shortMemo) {
      closing += `\n(ë‚´ë¶€ ë©”ëª¨: ${shortMemo})`;
    }

    // í¬ë§· ë²„ì „
    const partsFormatted = [];
    partsFormatted.push("â–  ì¸ì‚¬ ë° ì•ˆë‚´ ë°°ê²½");
    partsFormatted.push(greetLine);
    if (situationLine) partsFormatted.push(situationLine);
    if (toneChannelLine) partsFormatted.push(toneChannelLine);
    if (keywordLine) partsFormatted.push(keywordLine);
    if (budgetLine) partsFormatted.push(budgetLine);

    partsFormatted.push("");
    if (reportsBlock) {
      partsFormatted.push(reportsBlock);
      partsFormatted.push("");
    }
    if (memoBlock) {
      partsFormatted.push(memoBlock);
      partsFormatted.push("");
    }

    partsFormatted.push("â–  í›„ì† ì•ˆë‚´");
    partsFormatted.push(
      "í•„ìš”í•˜ì‹œë©´ ê²¬ì ì„œ, ìƒ˜í”Œ ëª©ì°¨, ì¶”ê°€ ë°œí–‰ì‚¬ ìë£Œ ë“±ë„ í•¨ê»˜ ì •ë¦¬í•´ì„œ ë³´ë‚´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
    );
    partsFormatted.push(closing);

    const formatted = partsFormatted.join("\n");

    // ìˆœìˆ˜ í…ìŠ¤íŠ¸ ë²„ì „ì€ ê°™ì€ ë‚´ìš©ì´ì§€ë§Œ, ì„¹ì…˜ í‘œì‹œ ì¤„ì„ ì¡°ê¸ˆ ë‹¨ìˆœí™”
    const plain = formatted;

    formattedText = formatted;
    plainText = plain;
  }

  function updateStatsAfterGenerate() {
    const now = new Date();
    const tKey = todayKey(now);
    stats.total = (stats.total || 0) + 1;
    if (stats.todayDate === tKey) {
      stats.todayCount = (stats.todayCount || 0) + 1;
    } else {
      stats.todayDate = tKey;
      stats.todayCount = 1;
    }
    stats.lastTime = now.toISOString();

    statTotal.textContent = String(stats.total || 0);
    statToday.textContent = String(stats.todayCount || 0);
    statLast.textContent = formatDateTime(now);
  }

  function refreshStatsFromState(state) {
    if (state && state.stats) {
      stats = state.stats;
    }
    statTotal.textContent = String(stats.total || 0);
    statToday.textContent = String(stats.todayCount || 0);
    statLast.textContent = stats.lastTime
      ? formatDateTime(new Date(stats.lastTime))
      : "-";
  }

  function loadFromState() {
    const state = safeLoadState();
    if (!state) {
      stateLine.textContent =
        "ì´ˆê¸° ìƒíƒœ: ì•„ì§ ì €ì¥ ì—†ìŒ Â· ì €ì¥ ìœ„ì¹˜: localStorage Â· " + STATE_KEY;
      setPreviewEmpty();
      return;
    }

    // ê¸°ë³¸ ì •ë³´
    if (state.customer) {
      inputName.value = state.customer.name || "";
      inputTitle.value = state.customer.title || "";
      inputOrg.value = state.customer.org || "";
      inputDept.value = state.customer.dept || "";
      inputField.value = state.customer.field || "";
      inputBudget.value = state.customer.budget || "";
      inputEmail.value = state.customer.email || "";
      inputShortMemo.value = state.customer.shortMemo || "";
    }

    // ì˜µì…˜
    if (state.options) {
      selectType.value = state.options.type || "new";
      selectTone.value = state.options.tone || "research-polite";
      inputKeywords.value = state.options.keywords || "";
      selectChannel.value = state.options.channel || "email";
      textareaReports.value = state.options.reports || "";
      textareaDetailMemo.value = state.options.detailMemo || "";
    }

    // ì•ˆë‚´ì„œ
    formattedText = state.guideFormatted || "";
    plainText = state.guidePlain || "";
    mode = state.mode || "formatted";
    if (mode === "formatted") {
      btnModeFormatted.classList.add("active");
      btnModePlain.classList.remove("active");
    } else {
      btnModeFormatted.classList.remove("active");
      btnModePlain.classList.add("active");
    }

    // í†µê³„
    refreshStatsFromState(state);

    // í›„ì† ì¡°ì¹˜
    if (state.follow) {
      datePhone.value = state.follow.phone || "";
      dateMail.value = state.follow.mail || "";
      dateQuote.value = state.follow.quote || "";
      dateBid.value = state.follow.bid || "";
      textareaFollowMemo.value = state.follow.memo || "";
      followSummary.textContent =
        state.follow.summary ||
        "ì•„ì§ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ ì±„ìš´ ë’¤ ã€Œìš”ì•½ ë‹¤ì‹œ ê³„ì‚°ã€ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.";
      followStatus.className = "status-pill ok";
      followStatus.textContent = "í›„ì† ì¡°ì¹˜ ìƒíƒœ: ì €ì¥ë¨";
      nextTodoBadge.textContent =
        state.follow.next || "ë‹¤ìŒ í•  ì¼ ìš”ì•½: ì—†ìŒ";
    }

    updateBasicStatus();
    renderPreview();
    stateLine.textContent =
      "í˜„ì¬ ìƒíƒœ: localStorageì—ì„œ ë¶ˆëŸ¬ì˜´ Â· key: " + STATE_KEY;
  }

  function buildFollowSummary() {
    const phone = datePhone.value;
    const mail = dateMail.value;
    const quote = dateQuote.value;
    const bid = dateBid.value;
    const memo = textareaFollowMemo.value.trim();

    const lines = [];
    if (phone) lines.push(`ì „í™” ìƒë‹´ ì˜ˆì •: ${phone}`);
    if (mail) lines.push(`ì•ˆë‚´ ë©”ì¼ ë°œì†¡ / íšŒì‹  ëŒ€ê¸°: ${mail}`);
    if (quote) lines.push(`ê³µì‹ ê²¬ì ì„œ / ì¸ë³´ì´ìŠ¤ ë°œì†¡: ${quote}`);
    if (bid) lines.push(`ì…ì°° / ì¡°ë‹¬ ë“±ë¡ ì¤€ë¹„: ${bid}`);
    if (memo) {
      lines.push("");
      lines.push("ì¶”ê°€ ë©”ëª¨:");
      lines.push(memo);
    }

    const summary =
      lines.length > 0
        ? lines.join("\n")
        : "ì•„ì§ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ ì±„ìš´ ë’¤ ã€Œìš”ì•½ ë‹¤ì‹œ ê³„ì‚°ã€ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.";

    followSummary.textContent = summary;

    // ê°€ì¥ ë¹ ë¥¸ ë‚ ì§œ ì°¾ê¸°
    const dates = [phone, mail, quote, bid].filter(Boolean).sort();
    let nextLine = "ë‹¤ìŒ í•  ì¼ ìš”ì•½: ì—†ìŒ";
    if (dates.length > 0) {
      nextLine = `ë‹¤ìŒ í•  ì¼ ìš”ì•½: ê°€ì¥ ê°€ê¹Œìš´ ì¼ì •ì€ ${dates[0]} ì…ë‹ˆë‹¤.`;
    }
    nextTodoBadge.textContent = nextLine;

    return { summary, next: nextLine };
  }

  function saveAllState() {
    const customer = {
      name: inputName.value.trim(),
      title: inputTitle.value.trim(),
      org: inputOrg.value.trim(),
      dept: inputDept.value.trim(),
      field: inputField.value.trim(),
      budget: inputBudget.value.trim(),
      email: inputEmail.value.trim(),
      shortMemo: inputShortMemo.value.trim(),
    };

    const options = {
      type: selectType.value,
      tone: selectTone.value,
      keywords: inputKeywords.value.trim(),
      channel: selectChannel.value,
      reports: textareaReports.value,
      detailMemo: textareaDetailMemo.value,
    };

    const follow = {
      phone: datePhone.value,
      mail: dateMail.value,
      quote: dateQuote.value,
      bid: dateBid.value,
      memo: textareaFollowMemo.value,
      summary: followSummary.textContent,
      next: nextTodoBadge.textContent,
    };

    const state = {
      customer,
      options,
      guideFormatted: formattedText,
      guidePlain: plainText,
      mode,
      stats,
      follow,
      savedAt: new Date().toISOString(),
    };

    safeSaveState(state);
  }

  // ì´ë²¤íŠ¸

  btnGenerate.addEventListener("click", function () {
    optionError.style.display = "none";
    optionError.textContent = "";

    const err = requiredCheck();
    if (err) {
      optionError.style.display = "block";
      optionError.textContent = err;
      basicStatus.className = "status-pill error";
      basicStatus.textContent = "ê¸°ë³¸ ì •ë³´ ìƒíƒœ: í•„ìˆ˜ í•­ëª© ëˆ„ë½";
      return;
    }

    buildGuideText();
    updateStatsAfterGenerate();
    updateBasicStatus();
    updateOptionStatus();
    renderPreview();
    saveAllState();
  });

  btnAppendMemo.addEventListener("click", function () {
    const memo = textareaDetailMemo.value.trim();
    if (!memo) return;
    if (!formattedText && !plainText) {
      buildGuideText();
    } else {
      formattedText += "\n\n[ì¶”ê°€ ë©”ëª¨]\n" + memo;
      plainText += "\n\n[ì¶”ê°€ ë©”ëª¨]\n" + memo;
    }
    renderPreview();
    saveAllState();
  });

  btnClearInputs.addEventListener("click", function () {
    inputName.value = "";
    inputTitle.value = "";
    inputOrg.value = "";
    inputDept.value = "";
    inputField.value = "";
    inputBudget.value = "";
    inputEmail.value = "";
    inputShortMemo.value = "";
    textareaReports.value = "";
    textareaDetailMemo.value = "";
    optionError.style.display = "none";
    optionError.textContent = "";
    basicStatus.className = "status-pill";
    basicStatus.textContent = "ê¸°ë³¸ ì •ë³´ ìƒíƒœ: ëŒ€ê¸° ì¤‘";
    optionStatus.className = "status-pill";
    optionStatus.textContent = "ì˜µì…˜ ìƒíƒœ: ê¸°ë³¸ê°’ ì‚¬ìš© ì¤‘";
    formattedText = "";
    plainText = "";
    setPreviewEmpty();
    saveAllState();
  });

  [inputName, inputOrg, inputField].forEach((el) => {
    el.addEventListener("input", updateBasicStatus);
  });

  btnModeFormatted.addEventListener("click", function () {
    setMode("formatted");
  });

  btnModePlain.addEventListener("click", function () {
    setMode("plain");
  });

  btnCopy.addEventListener("click", function () {
    const textToCopy = mode === "formatted" ? formattedText : plainText;
    if (!textToCopy) return;
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(textToCopy).catch(function () {});
    } else {
      // fallback
      const temp = document.createElement("textarea");
      temp.value = textToCopy;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand("copy");
      document.body.removeChild(temp);
    }
  });

  btnAddSeparator.addEventListener("click", function () {
    const sep = "\n------------------------------\n";
    formattedText = (formattedText || "") + sep;
    plainText = (plainText || "") + sep;
    renderPreview();
    saveAllState();
  });

  btnRecalcFollow.addEventListener("click", function () {
    const out = buildFollowSummary();
    followStatus.className = "status-pill";
    followStatus.textContent = "í›„ì† ì¡°ì¹˜ ìƒíƒœ: ë¯¸ì €ì¥ (ìš”ì•½ë§Œ ì—…ë°ì´íŠ¸)";
    saveAllState();
  });

  btnSaveFollow.addEventListener("click", function () {
    const out = buildFollowSummary();
    followStatus.className = "status-pill ok";
    followStatus.textContent = "í›„ì† ì¡°ì¹˜ ìƒíƒœ: ì €ì¥ë¨";
    saveAllState();
  });

  btnClearFollow.addEventListener("click", function () {
    datePhone.value = "";
    dateMail.value = "";
    dateQuote.value = "";
    dateBid.value = "";
    textareaFollowMemo.value = "";
    followSummary.textContent =
      "ì•„ì§ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ ì±„ìš´ ë’¤ ã€Œìš”ì•½ ë‹¤ì‹œ ê³„ì‚°ã€ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.";
    followStatus.className = "status-pill";
    followStatus.textContent = "í›„ì† ì¡°ì¹˜ ìƒíƒœ: ë¯¸ì €ì¥";
    nextTodoBadge.textContent = "ë‹¤ìŒ í•  ì¼ ìš”ì•½: ì—†ìŒ";
    saveAllState();
  });

  // ì´ˆê¸° ë¡œë“œ
  loadFromState();

})();
</script>
</body>
</html>
