<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>1ë²ˆ ë„êµ¬ Â· ê³ ê° ìë™í™” ì•ˆë‚´ì„œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0f172a;
      --bg-soft: #020617;
      --card: #020617;
      --card-soft: #020617;
      --border: #1f2937;
      --border-soft: #111827;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.12);
      --accent-strong: #0ea5e9;
      --danger: #f97373;
      --warning: #facc15;
      --success: #4ade80;
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --text-muted: #6b7280;
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --radius-lg: 16px;
      --radius-md: 12px;
      --radius-sm: 8px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.7);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #0b1120 0, #020617 55%, #000 100%);
      color: var(--text-main);
      font-family: var(--font-main);
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 1180px;
      padding: 18px 12px 28px;
    }

    @media (min-width: 900px) {
      .app {
        padding: 24px 0 32px;
      }
    }

    header {
      background: radial-gradient(circle at top left, #0f172a, #020617 55%, #000 100%);
      border-radius: 20px;
      padding: 16px 18px;
      margin-bottom: 18px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: var(--shadow-soft);
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.2fr);
      gap: 14px;
    }

    @media (max-width: 860px) {
      header {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .title-main {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-pill {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.5);
      background: rgba(15, 23, 42, 0.7);
      color: var(--accent);
    }

    .title-sub {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 8px;
    }

    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .meta-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 55, 0.8);
      background: rgba(15, 23, 42, 0.9);
    }

    .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.7);
    }

    .header-stats {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      align-items: stretch;
    }

    @media (max-width: 520px) {
      .header-stats {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .stat-card {
      background: radial-gradient(circle at top, #020617, #020617 55%, #000 100%);
      border-radius: 14px;
      padding: 8px 9px;
      border: 1px solid rgba(30, 64, 175, 0.6);
      display: flex;
      flex-direction: column;
      gap: 2px;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }

    .stat-inner {
      position: relative;
      z-index: 1;
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-sub);
    }

    .stat-value {
      font-size: 18px;
      font-weight: 700;
      margin-top: 2px;
    }

    .stat-pill {
      font-size: 11px;
      margin-top: 3px;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.8);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: var(--text-sub);
    }

    .layout-main {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 12px;
    }

    @media (max-width: 980px) {
      .layout-main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: radial-gradient(circle at top, #020617, #020617 60%, #000 100%);
      border-radius: var(--radius-lg);
      padding: 12px 12px 14px;
      border: 1px solid var(--border);
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.8);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-kicker {
      font-size: 11px;
      color: var(--text-sub);
    }

    .badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-sub);
      white-space: nowrap;
    }

    .badge-pill {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-sub);
    }

    .badge-pill.state-ok {
      border-color: rgba(74, 222, 128, 0.7);
      color: #bbf7d0;
    }
    .badge-pill.state-warn {
      border-color: rgba(234, 179, 8, 0.9);
      color: #facc15;
    }

    .field-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    @media (max-width: 640px) {
      .field-row {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 8px;
    }

    .field-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .field-label {
      font-size: 11px;
      font-weight: 500;
      color: var(--text-main);
    }

    .field-hint {
      font-size: 10px;
      color: var(--text-muted);
    }

    label {
      font-size: 11px;
      font-weight: 500;
    }

    input[type="text"],
    textarea,
    select,
    input[type="date"] {
      width: 100%;
      padding: 7px 9px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-soft);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      font-size: 12px;
      font-family: var(--font-main);
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input::placeholder,
    textarea::placeholder {
      color: var(--text-muted);
    }

    textarea {
      resize: vertical;
      min-height: 70px;
      max-height: 180px;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.25);
      background: rgba(15, 23, 42, 0.95);
    }

    select {
      appearance: none;
      background-image: linear-gradient(45deg, transparent 50%, #64748b 50%),
        linear-gradient(135deg, #64748b 50%, transparent 50%);
      background-position: right 8px top 9px, right 4px top 9px;
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
      padding-right: 24px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    button {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.05s ease, border-color 0.15s;
      white-space: nowrap;
    }

    button:hover {
      background: rgba(15, 23, 42, 1);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.9);
      transform: translateY(-1px);
      border-color: rgba(56, 189, 248, 0.8);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.8);
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      border-color: var(--border);
    }

    .btn-main {
      background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      border-color: rgba(56, 189, 248, 0.85);
      color: #0b1120;
    }

    .btn-main:hover {
      background: linear-gradient(135deg, #0ea5e9, #38bdf8);
    }

    .btn-ghost {
      background: transparent;
      border-style: dashed;
      border-color: rgba(75, 85, 99, 0.9);
    }

    .btn-icon {
      font-size: 14px;
      line-height: 0;
    }

    .status-text {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .status-text strong {
      color: var(--accent-strong);
    }

    .section-caption {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .preview-tabs {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: rgba(15, 23, 42, 0.9);
      padding: 2px;
      gap: 2px;
    }

    .tab-btn {
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 11px;
      border: none;
      background: transparent;
      color: var(--text-sub);
      cursor: pointer;
    }

    .tab-btn.active {
      background: rgba(56, 189, 248, 0.18);
      color: var(--accent-strong);
    }

    .preview-shell {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-soft);
      background: radial-gradient(circle at top, #020617, #020617 55%, #000 100%);
      min-height: 140px;
      max-height: 260px;
      overflow-y: auto;
      padding: 9px 10px;
      font-size: 12px;
      line-height: 1.55;
      position: relative;
    }

    .preview-empty {
      font-size: 12px;
      color: var(--text-muted);
      padding: 10px 6px;
    }

    .preview-text {
      white-space: pre-wrap;
    }

    .preview-meta {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 4px;
      text-align: right;
    }

    .follow-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 4px;
    }

    @media (max-width: 720px) {
      .follow-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .follow-block {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-soft);
      padding: 8px 8px 9px;
      background: rgba(15, 23, 42, 0.9);
    }

    .follow-title {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .follow-inline {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }

    .follow-inline label {
      font-size: 11px;
      color: var(--text-sub);
    }

    .follow-inline input[type="checkbox"] {
      width: 14px;
      height: 14px;
      border-radius: 4px;
      border: 1px solid var(--border-soft);
      background: rgba(15, 23, 42, 0.9);
    }

    .follow-inline input[type="date"] {
      max-width: 140px;
      font-size: 11px;
      padding: 4px 7px;
    }

    .next-summary {
      border-radius: var(--radius-md);
      border: 1px dashed rgba(75, 85, 99, 0.9);
      padding: 7px 8px;
      font-size: 12px;
      margin-top: 6px;
      background: rgba(15, 23, 42, 0.9);
    }

    .next-summary span {
      color: var(--accent-strong);
    }

    .footer-note {
      margin-top: 6px;
      font-size: 10px;
      color: var(--text-muted);
      text-align: right;
    }

    .footer-note code {
      font-size: 10px;
      color: var(--accent-strong);
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <div class="title-main">
          1ë²ˆ ë„êµ¬ Â· ê³ ê° ìë™í™” ì•ˆë‚´ì„œ
          <span class="title-pill">Local-only Â· Safe DOM Â· v1.0</span>
        </div>
        <div class="title-sub">
          ì—°êµ¬ìÂ·ê³ ê° ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´, ì¸ì‚¬Â·ì†Œê°œÂ·ë§ì¶¤ ì œì•ˆÂ·í›„ì† ì•ˆë‚´ê¹Œì§€ í•œ ë²ˆì— ë¬¶ì¸ ì›Œë“œ/ë©”ì¼ìš© ì•ˆë‚´ì„œ ì´ˆì•ˆê³¼
          í›„ì† ì¡°ì¹˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ í•œ í™”ë©´ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.
        </div>
        <div class="meta-row">
          <div class="meta-badge">
            <span class="dot"></span>
            <span id="metaReadyText">ì´ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ë™ì‘ Â· ì„œë²„/íƒ€ì´ë¨¸ ì—†ìŒ</span>
          </div>
          <div class="meta-badge">
            ì €ì¥ ìœ„ì¹˜: <code>localStorage Â· wic_tool1_state_v1</code>
          </div>
        </div>
      </div>
      <div class="header-stats">
        <div class="stat-card">
          <div class="stat-inner">
            <div class="stat-label">ëˆ„ì  ì•ˆë‚´ì„œ ìƒì„±</div>
            <div class="stat-value" id="statTotalCount">0</div>
            <div class="stat-pill">
              <span>Generate count</span>
            </div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-inner">
            <div class="stat-label">ì˜¤ëŠ˜ ë§Œë“  ì•ˆë‚´ì„œ</div>
            <div class="stat-value" id="statTodayCount">0</div>
            <div class="stat-pill">
              <span>Today</span>
            </div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-inner">
            <div class="stat-label">ë§ˆì§€ë§‰ ìƒì„± ì‹œê°</div>
            <div class="stat-value" id="statLastTime">-</div>
            <div class="stat-pill">
              <span>Local-only ê¸°ë¡</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="layout-main">
      <!-- ì™¼ìª½: A + B ì…ë ¥ -->
      <section class="card" aria-label="ê³ ê° ì •ë³´ ë° ì˜µì…˜">
        <div class="card-header">
          <div>
            <div class="card-title">A. ê³ ê° ê¸°ë³¸ ì •ë³´</div>
            <div class="card-kicker">ì—‘ì…€ ê³ ê°DBì—ì„œ ì˜®ê²¨ ì ëŠ” ê¸°ì¤€ìœ¼ë¡œ, ì•ˆë‚´ì„œì— í•„ìˆ˜ë¡œ ë“¤ì–´ê°€ëŠ” ê¸°ë³¸ í•„ë“œì…ë‹ˆë‹¤.</div>
          </div>
          <div class="badge-pill" id="basicInfoState">ê¸°ë³¸ ì •ë³´ ìƒíƒœ: ëŒ€ê¸° ì¤‘</div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputName">ê³ ê° ì´ë¦„</label>
              <div class="field-hint">ì˜ˆ: í™ê¸¸ë™</div>
            </div>
            <input id="inputName" type="text" placeholder="ì˜ˆ: í™ê¸¸ë™" autocomplete="off" />
          </div>
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputTitle">ì§í•¨ / ì§ìœ„</label>
              <div class="field-hint">ì˜ˆ: ë°•ì‚¬ / ì±…ì„ì—°êµ¬ì›</div>
            </div>
            <input id="inputTitle" type="text" placeholder="ì˜ˆ: ë°•ì‚¬ / ì±…ì„ì—°êµ¬ì›" autocomplete="off" />
          </div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputOrg">ê¸°ê´€ / íšŒì‚¬</label>
              <div class="field-hint">ì˜ˆ: KIST / KITECH</div>
            </div>
            <input id="inputOrg" type="text" placeholder="ì˜ˆ: KIST / KITECH" autocomplete="off" />
          </div>
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputDept">ë¶€ì„œ / ì—°êµ¬ì‹¤</label>
              <div class="field-hint">ì˜ˆ: ì†Œì¬ë¶€í’ˆì—°êµ¬ë¶€</div>
            </div>
            <input id="inputDept" type="text" placeholder="ì˜ˆ: ì†Œì¬ë¶€í’ˆì—°êµ¬ë¶€" autocomplete="off" />
          </div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputField">ì—°êµ¬ / ê´€ì‹¬ ë¶„ì•¼</label>
              <div class="field-hint">ì˜ˆ: ë°˜ë„ì²´ íŒ¨í‚¤ì§• ì ‘ì°©ì œ</div>
            </div>
            <input id="inputField" type="text" placeholder="ì˜ˆ: ë°˜ë„ì²´ íŒ¨í‚¤ì§• ì ‘ì°©ì œ" autocomplete="off" />
          </div>
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputBudget">ì˜ˆìƒ ì˜ˆì‚° / ì—°êµ¬ë¹„</label>
              <div class="field-hint">ì˜ˆ: ì—° 1,200ë§Œì›</div>
            </div>
            <input id="inputBudget" type="text" placeholder="ì˜ˆ: ì—° 1,200ë§Œì›" autocomplete="off" />
          </div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputEmail">ì´ë©”ì¼ (ì„ íƒ)</label>
              <div class="field-hint">ì˜ˆ: example@org.re.kr</div>
            </div>
            <input id="inputEmail" type="text" placeholder="example@org.re.kr" autocomplete="off" />
          </div>
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputShortMemo">ë‚´ ë©”ëª¨ (ì§§ê²Œ)</label>
              <div class="field-hint">ì˜ˆ: ê¸°ì¡´ ê³ ê° / ì˜ˆì‚° ìˆìŒ</div>
            </div>
            <input id="inputShortMemo" type="text" placeholder="ì˜ˆ: ê¸°ì¡´ ê³ ê° / ì˜ˆì‚° ìˆìŒ" autocomplete="off" />
          </div>
        </div>

        <div class="status-text">
          Â· <strong>ì´ë¦„Â·ê¸°ê´€Â·ì—°êµ¬ë¶„ì•¼</strong>ëŠ” ì•ˆë‚´ì„œ ì¸ì‚¬ë§, ë³¸ë¬¸ ìš”ì•½ì— ìë™ ë°˜ì˜ë©ë‹ˆë‹¤.
        </div>

        <hr style="border: none; border-top: 1px dashed #1f2937; margin: 10px 0;" />

        <div class="card-header" style="margin-top: 2px;">
          <div>
            <div class="card-title">B. ì•ˆë‚´ì„œ ì˜µì…˜ Â· ë³´ê³ ì„œ ëª©ë¡</div>
            <div class="card-kicker">ì‹ ê·œ ë¬¸ì˜ / ê¸°ì¡´ ê³ ê° / ì¬ë¬¸ì˜ ìƒí™©ì— ë”°ë¼, í…œí”Œë¦¿ êµ¬ì¡°ì™€ í†¤ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.</div>
          </div>
          <div class="badge-pill" id="optionState">ì˜µì…˜ ìƒíƒœ: ê¸°ë³¸ê°’ ì‚¬ìš© ì¤‘</div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="selectType">ì•ˆë‚´ì„œ ìœ í˜•</label>
              <div class="field-hint">ìƒí™© ì„ íƒ</div>
            </div>
            <select id="selectType">
              <option value="new">ì‹ ê·œ ë¬¸ì˜ / ì²« ì•ˆë‚´</option>
              <option value="existing">ê¸°ì¡´ ê³ ê° / ì¶”ê°€ ì•ˆë‚´</option>
              <option value="revisit">ì¬ë¬¸ì˜ / ì—…ë°ì´íŠ¸ ì•ˆë‚´</option>
            </select>
          </div>
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="selectTone">ë¬¸ì²´ / í†¤</label>
              <div class="field-hint">ì˜ˆ: ì—°êµ¬ì ëŒ€ìƒ ì¡´ëŒ“ë§</div>
            </div>
            <select id="selectTone">
              <option value="researcher_polite">ì—°êµ¬ììš© ì •ì¤‘í•œ í†¤ (ê¸°ë³¸)</option>
              <option value="business_formal">ì‚¬ì—…/ì¡°ë‹¬ ë‹´ë‹¹ììš© ê²©ì‹ í†¤</option>
              <option value="light_polite">ì¡°ê¸ˆ ê°€ë²¼ìš´ ì¡´ëŒ“ë§ í†¤</option>
            </select>
          </div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="inputKeywords">í•µì‹¬ í‚¤ì›Œë“œ (ì½¤ë§ˆ êµ¬ë¶„)</label>
              <div class="field-hint">ì˜ˆ: ê¸€ë¼ìŠ¤ ì„œë¸ŒìŠ¤íŠ¸ë ˆì´íŠ¸, ì ‘ì°©ì œ</div>
            </div>
            <input id="inputKeywords" type="text" placeholder="í‚¤ì›Œë“œ1, í‚¤ì›Œë“œ2, ..." autocomplete="off" />
          </div>
          <div class="field-group">
            <div class="field-label-row">
              <label class="field-label" for="selectChannel">ì˜ˆìƒ ì‚¬ìš© ì±„ë„</label>
              <div class="field-hint">ë©”ì¼ / ì›Œë“œ / PDF</div>
            </div>
            <select id="selectChannel">
              <option value="email">ì´ë©”ì¼ ë³¸ë¬¸ìš©</option>
              <option value="word">ì›Œë“œ íŒŒì¼ìš© (ë¬¸ë‹¨í˜•)</option>
              <option value="both">ì´ë©”ì¼ + ì›Œë“œ ê²¸ìš©</option>
            </select>
          </div>
        </div>

        <div class="field-group">
          <div class="field-label-row">
            <label class="field-label" for="textareaReports">ë³´ê³ ì„œ / ìë£Œ ëª©ë¡</label>
            <div class="field-hint">í•œ ì¤„ë‹¹ 1ê°œ Â· ì œëª©ë§Œ ì ìœ¼ë©´ ë²ˆí˜¸ ë§¤ê¹€</div>
          </div>
          <textarea id="textareaReports" placeholder="ì˜ˆì‹œ)
Glass Substrate for Advanced Packaging 2025
Semiconductor Packaging Adhesives: Global Market 2024
ê³ ê¸°ëŠ¥ ì ‘ì°©ì œÂ·ì‹¤ë€íŠ¸ ì„¸ê³„ì‹œì¥ 2023"></textarea>
        </div>

        <div class="field-group">
          <div class="field-label-row">
            <label class="field-label" for="textareaDetailMemo">ê³ ê° ìƒì„¸ ë©”ëª¨ (ì•ˆë‚´ì„œ ë³¸ë¬¸ ë°˜ì˜)</label>
            <div class="field-hint">ì „í™” ë‚´ìš©, ì˜ˆì‚°, ì›í•˜ëŠ” í¬ì¸íŠ¸ ë“± ììœ  ì…ë ¥</div>
          </div>
          <textarea id="textareaDetailMemo" placeholder="ì˜ˆ)
- ìµœê·¼ íŒ¨í‚¤ì§•ìš© ìœ ë¦¬ê¸°íŒ ê´€ë ¨ ì¤‘ì¥ê¸° ë¡œë“œë§µ ìˆ˜ë¦½ ì¤‘
- êµ­ë‚´Â·í•´ì™¸ ì—…ì²´ ë™í–¥, ê³µì •ë³„ ê¸°ìˆ  í¬ì¸íŠ¸, ë¹„ìš©Â·íˆ¬ì ê·œëª¨ ë°ì´í„° í•„ìš”
- ê¸°í•œ: ë‹¤ìŒ ë‹¬ ì˜ˆì‚° ì§‘í–‰ ì „ê¹Œì§€"></textarea>
        </div>

        <div class="btn-row">
          <button type="button" class="btn-main" id="btnGenerate">
            <span class="btn-icon">âš™ï¸</span>
            ìë™ ì•ˆë‚´ì„œ ì´ˆì•ˆ ìƒì„±
          </button>
          <button type="button" id="btnAppendMemo">
            <span class="btn-icon">â•</span>
            ë©”ëª¨ë¥¼ ì•ˆë‚´ì„œì— ë§ë¶™ì´ê¸°
          </button>
          <button type="button" class="btn-ghost" id="btnClearInputs">
            <span class="btn-icon">ğŸ§¹</span>
            ì…ë ¥ ë‚´ìš© ì´ˆê¸°í™”
          </button>
        </div>

        <div class="status-text">
          Â· ì•ˆë‚´ì„œ ìƒì„± í›„ì—ë„ ì˜µì…˜ì„ ë°”ê¿” ë‹¤ì‹œ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
      </section>

      <!-- ì˜¤ë¥¸ìª½: C ë¯¸ë¦¬ë³´ê¸° + D í›„ì† ì¡°ì¹˜ -->
      <section class="card" aria-label="ì•ˆë‚´ì„œ ë¯¸ë¦¬ë³´ê¸° ë° í›„ì† ì¡°ì¹˜">
        <div class="card-header">
          <div>
            <div class="card-title">C. ìë™ ì•ˆë‚´ì„œ ë¯¸ë¦¬ë³´ê¸°</div>
            <div class="card-kicker">ì¸ì‚¬Â·ì†Œê°œÂ·ë§ì¶¤ ì œì•ˆÂ·í›„ì† ì•ˆë‚´ê¹Œì§€ í•œ ë²ˆì— ë¶™ì—¬ ë„£ì„ ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.</div>
          </div>
          <div class="badge-pill" id="previewState">ì•ˆë‚´ì„œ ìƒíƒœ: ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>
        </div>

        <div class="preview-header">
          <div class="preview-tabs" aria-label="ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ ì „í™˜">
            <button type="button" class="tab-btn active" id="tabFormatted">ğŸ“„ ì•ˆë‚´ì„œ í˜•ì‹</button>
            <button type="button" class="tab-btn" id="tabPlain">ğŸ“‹ ìˆœìˆ˜ í…ìŠ¤íŠ¸</button>
          </div>
          <div class="btn-row" style="margin-top:0;">
            <button type="button" id="btnCopy" title="í´ë¦½ë³´ë“œ ë³µì‚¬">
              <span class="btn-icon">ğŸ“</span>
              ë³µì‚¬
            </button>
            <button type="button" id="btnAddSeparator" title="ì›Œë“œ êµ¬ë¶„ì„  ì¶”ê°€">
              <span class="btn-icon">ğŸ“</span>
              ì›Œë“œ êµ¬ë¶„ì„ 
            </button>
          </div>
        </div>

        <div class="preview-shell" id="previewShell">
          <div id="previewEmpty" class="preview-empty">
            ì•„ì§ ìë™ ì•ˆë‚´ì„œê°€ ì—†ìŠµë‹ˆë‹¤. ì™¼ìª½ì—ì„œ ê³ ê° ì •ë³´ì™€ ì˜µì…˜ì„ ì…ë ¥í•œ ë’¤
            <strong>ã€Œìë™ ì•ˆë‚´ì„œ ì´ˆì•ˆ ìƒì„±ã€</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.
          </div>
          <div id="previewFormatted" class="preview-text" style="display:none;"></div>
          <textarea id="previewPlain" style="display:none; width:100%; border:none; background:transparent; color:inherit; resize:none; min-height:160px; font-size:12px; line-height:1.55;"></textarea>
        </div>
        <div class="preview-meta" id="previewMeta">
          ì´ ì•ˆë‚´ì„œëŠ” ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©°, ìƒˆë¡œê³ ì¹¨ í›„ì—ë„ ë³µì›ë©ë‹ˆë‹¤. (Word ì ê¸ˆì€ ë³„ë„ í…œí”Œë¦¿ì—ì„œ ì²˜ë¦¬)
        </div>

        <hr style="border: none; border-top: 1px dashed #1f2937; margin: 10px 0;" />

        <div class="card-header" style="margin-top: 2px;">
          <div>
            <div class="card-title">D. í›„ì† ì¡°ì¹˜ Â· Follow-up ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
            <div class="card-kicker">ì•ˆë‚´ì„œì™€ ì—°ê²°ëœ ì „í™” / ë©”ì¼ / ê²¬ì  / ì…ì°° ë“± í›„ì† í–‰ë™ì„ ë¡œì»¬ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.</div>
          </div>
          <div class="badge-pill" id="followState">í›„ì† ì¡°ì¹˜ ìƒíƒœ: ë¯¸ì €ì¥</div>
        </div>

        <div class="follow-grid">
          <div class="follow-block">
            <div class="follow-title">ê³ ê° ë‹¨ìœ„ ë¡œì»¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</div>

            <div class="follow-inline">
              <input type="checkbox" id="chkCall" />
              <label for="chkCall">ì „í™” ìƒë‹´ ì˜ˆì •</label>
              <input type="date" id="dateCall" />
            </div>

            <div class="follow-inline">
              <input type="checkbox" id="chkMail" />
              <label for="chkMail">ì•ˆë‚´ ë©”ì¼ ë°œì†¡ / íšŒì‹  ëŒ€ê¸°</label>
              <input type="date" id="dateMail" />
            </div>

            <div class="follow-inline">
              <input type="checkbox" id="chkQuote" />
              <label for="chkQuote">ê³µì‹ ê²¬ì ì„œ / ì¸ë³´ì´ìŠ¤ ë°œì†¡</label>
              <input type="date" id="dateQuote" />
            </div>

            <div class="follow-inline">
              <input type="checkbox" id="chkBid" />
              <label for="chkBid">ì…ì°° / ì¡°ë‹¬ ë“±ë¡ ì¤€ë¹„</label>
              <input type="date" id="dateBid" />
            </div>
          </div>

          <div class="follow-block">
            <div class="field-group">
              <div class="field-label-row">
                <label class="field-label" for="textareaFollowMemo">ì¶”ê°€ ë©”ëª¨ (í›„ì† ì¡°ì¹˜ìš©)</label>
                <div class="field-hint">ì˜ˆ: ì…ì°° ë§ˆê°ì¼ / ë‚´ë¶€ ê²°ì¬ ì¼ì •</div>
              </div>
              <textarea id="textareaFollowMemo" placeholder="ì˜ˆ)
- KISTI ì¡°ë‹¬ ë“±ë¡ í•„ìš” ì—¬ë¶€ í™•ì¸
- ë‚´ë¶€ ê²°ì¬ë¼ì¸: íŒ€ì¥ â†’ ë³¸ë¶€ì¥
- ì˜ˆì‚° ì§‘í–‰ ê¸°í•œ: 1ì›” ë§ê¹Œì§€"></textarea>
            </div>

            <div class="next-summary" id="nextSummary">
              <strong>ë‹¤ìŒ í•  ì¼ ìš”ì•½</strong><br />
              <span>ì•„ì§ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤.</span> ì²´í¬ë¦¬ìŠ¤íŠ¸ ì„ íƒ í›„ ã€Œìš”ì•½ ë‹¤ì‹œ ê³„ì‚°ã€ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.
            </div>

            <div class="btn-row" style="margin-top:6px;">
              <button type="button" id="btnSaveFollow">
                <span class="btn-icon">ğŸ’¾</span>
                í›„ì† ì¡°ì¹˜ ìƒíƒœ ì €ì¥
              </button>
              <button type="button" id="btnRecalcFollow">
                <span class="btn-icon">ğŸ”„</span>
                ìš”ì•½ ë‹¤ì‹œ ê³„ì‚°
              </button>
              <button type="button" class="btn-ghost" id="btnClearFollow">
                <span class="btn-icon">â™»ï¸</span>
                ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
              </button>
            </div>
          </div>
        </div>

        <div class="footer-note">
          Â· ì²´í¬ë¦¬ìŠ¤íŠ¸ì™€ ë©”ëª¨ëŠ” ì´ ë¸Œë¼ìš°ì €ì˜ <code>localStorage</code>ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.
        </div>
      </section>
    </main>
  </div>

  <script>
    (function () {
      "use strict";

      const STORAGE_KEY = "wic_tool1_state_v1";

      const $ = (id) => document.getElementById(id);

      // í—¤ë”/ìƒíƒœ
      const metaReadyText = $("metaReadyText");
      const statTotalCount = $("statTotalCount");
      const statTodayCount = $("statTodayCount");
      const statLastTime = $("statLastTime");

      // A. ê¸°ë³¸ ì •ë³´
      const inputName = $("inputName");
      const inputTitle = $("inputTitle");
      const inputOrg = $("inputOrg");
      const inputDept = $("inputDept");
      const inputField = $("inputField");
      const inputBudget = $("inputBudget");
      const inputEmail = $("inputEmail");
      const inputShortMemo = $("inputShortMemo");
      const basicInfoState = $("basicInfoState");

      // B. ì˜µì…˜
      const selectType = $("selectType");
      const selectTone = $("selectTone");
      const inputKeywords = $("inputKeywords");
      const selectChannel = $("selectChannel");
      const textareaReports = $("textareaReports");
      const textareaDetailMemo = $("textareaDetailMemo");
      const optionState = $("optionState");

      const btnGenerate = $("btnGenerate");
      const btnAppendMemo = $("btnAppendMemo");
      const btnClearInputs = $("btnClearInputs");

      // C. ë¯¸ë¦¬ë³´ê¸°
      const tabFormatted = $("tabFormatted");
      const tabPlain = $("tabPlain");
      const previewShell = $("previewShell");
      const previewEmpty = $("previewEmpty");
      const previewFormatted = $("previewFormatted");
      const previewPlain = $("previewPlain");
      const previewMeta = $("previewMeta");
      const previewState = $("previewState");
      const btnCopy = $("btnCopy");
      const btnAddSeparator = $("btnAddSeparator");

      // D. í›„ì† ì¡°ì¹˜
      const followState = $("followState");
      const chkCall = $("chkCall");
      const chkMail = $("chkMail");
      const chkQuote = $("chkQuote");
      const chkBid = $("chkBid");
      const dateCall = $("dateCall");
      const dateMail = $("dateMail");
      const dateQuote = $("dateQuote");
      const dateBid = $("dateBid");
      const textareaFollowMemo = $("textareaFollowMemo");
      const nextSummary = $("nextSummary");
      const btnSaveFollow = $("btnSaveFollow");
      const btnRecalcFollow = $("btnRecalcFollow");
      const btnClearFollow = $("btnClearFollow");

      function safeParse(json, fallback) {
        try {
          if (!json) return fallback;
          const parsed = JSON.parse(json);
          return parsed ?? fallback;
        } catch (e) {
          return fallback;
        }
      }

      function loadState() {
        const raw = localStorage.getItem(STORAGE_KEY);
        const state = safeParse(raw, null);
        if (!state) {
          updateMetaReady("ì´ˆê¸° ìƒíƒœ Â· ì•„ì§ ì €ì¥ ì—†ìŒ");
          return;
        }

        const s = state;

        // í—¤ë”
        statTotalCount.textContent = String(s.totalCount || 0);
        statTodayCount.textContent = String(s.todayCount || 0);
        statLastTime.textContent = s.lastGeneratedAtText || "-";

        // A
        inputName.value = s.name || "";
        inputTitle.value = s.title || "";
        inputOrg.value = s.org || "";
        inputDept.value = s.dept || "";
        inputField.value = s.field || "";
        inputBudget.value = s.budget || "";
        inputEmail.value = s.email || "";
        inputShortMemo.value = s.shortMemo || "";

        setBasicInfoState();

        // B
        if (s.type) selectType.value = s.type;
        if (s.tone) selectTone.value = s.tone;
        if (s.keywords) inputKeywords.value = s.keywords;
        if (s.channel) selectChannel.value = s.channel;
        if (s.reports) textareaReports.value = s.reports;
        if (s.detailMemo) textareaDetailMemo.value = s.detailMemo;

        optionState.textContent = "ì˜µì…˜ ìƒíƒœ: ì €ì¥ëœ ì„¤ì • ë¶ˆëŸ¬ì˜´";

        // C
        if (s.previewRaw) {
          applyPreviewText(s.previewRaw);
          previewState.textContent = "ì•ˆë‚´ì„œ ìƒíƒœ: ì €ì¥ëœ ì•ˆë‚´ì„œê°€ ìˆìŠµë‹ˆë‹¤.";
        }

        // D
        chkCall.checked = !!s.followCall;
        chkMail.checked = !!s.followMail;
        chkQuote.checked = !!s.followQuote;
        chkBid.checked = !!s.followBid;
        if (s.dateCall) dateCall.value = s.dateCall;
        if (s.dateMail) dateMail.value = s.dateMail;
        if (s.dateQuote) dateQuote.value = s.dateQuote;
        if (s.dateBid) dateBid.value = s.dateBid;
        textareaFollowMemo.value = s.followMemo || "";

        if (s.followSummary) {
          nextSummary.innerHTML =
            "<strong>ë‹¤ìŒ í•  ì¼ ìš”ì•½</strong><br /><span>" +
            escapeHtml(s.followSummary) +
            "</span>";
          followState.textContent = "í›„ì† ì¡°ì¹˜ ìƒíƒœ: ì €ì¥ë¨";
        }

        updateMetaReady("ì´ì „ì— ì €ì¥ëœ ìƒíƒœë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.");
      }

      function saveState(extra) {
        const now = new Date();
        const todayKey =
          now.getFullYear() +
          "-" +
          String(now.getMonth() + 1).padStart(2, "0") +
          "-" +
          String(now.getDate()).padStart(2, "0");

        const raw = localStorage.getItem(STORAGE_KEY);
        const prev = safeParse(raw, {}) || {};

        const base = {
          name: inputName.value || "",
          title: inputTitle.value || "",
          org: inputOrg.value || "",
          dept: inputDept.value || "",
          field: inputField.value || "",
          budget: inputBudget.value || "",
          email: inputEmail.value || "",
          shortMemo: inputShortMemo.value || "",
          type: selectType.value,
          tone: selectTone.value,
          keywords: inputKeywords.value || "",
          channel: selectChannel.value,
          reports: textareaReports.value || "",
          detailMemo: textareaDetailMemo.value || "",
          // í—¤ë” ì¹´ìš´íŠ¸
          totalCount: prev.totalCount || 0,
          todayCount: prev.todayCount || 0,
          lastGeneratedAtText: prev.lastGeneratedAtText || "-",
          lastGeneratedDateKey: prev.lastGeneratedDateKey || "",
          // ë¯¸ë¦¬ë³´ê¸° rawëŠ” extraì—ì„œ ì„¤ì •
          previewRaw: prev.previewRaw || "",
          // í›„ì† ì¡°ì¹˜
          followCall: chkCall.checked,
          followMail: chkMail.checked,
          followQuote: chkQuote.checked,
          followBid: chkBid.checked,
          dateCall: dateCall.value || "",
          dateMail: dateMail.value || "",
          dateQuote: dateQuote.value || "",
          dateBid: dateBid.value || "",
          followMemo: textareaFollowMemo.value || "",
          followSummary: prev.followSummary || "",
          updatedAt: now.toISOString(),
          todayKey: todayKey,
        };

        const merged = Object.assign({}, base, extra || {});
        localStorage.setItem(STORAGE_KEY, JSON.stringify(merged));
      }

      function updateMetaReady(text) {
        metaReadyText.textContent = text;
      }

      function setBasicInfoState() {
        const hasMain =
          (inputName.value || "").trim() ||
          (inputOrg.value || "").trim() ||
          (inputField.value || "").trim();

        basicInfoState.textContent = hasMain
          ? "ê¸°ë³¸ ì •ë³´ ìƒíƒœ: ì•ˆë‚´ì„œì— ë°˜ì˜ ê°€ëŠ¥"
          : "ê¸°ë³¸ ì •ë³´ ìƒíƒœ: ëŒ€ê¸° ì¤‘";

        basicInfoState.className = "badge-pill " + (hasMain ? "state-ok" : "");
      }

      function escapeHtml(str) {
        return (str || "")
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
      }

      function formatDateTime(date) {
        const pad = (n) => String(n).padStart(2, "0");
        return (
          date.getFullYear() +
          "-" +
          pad(date.getMonth() + 1) +
          "-" +
          pad(date.getDate()) +
          " " +
          pad(date.getHours()) +
          ":" +
          pad(date.getMinutes())
        );
      }

      function buildGreeting(tone, name, title, org, dept) {
        const lines = [];
        const namePart = name ? name + (title ? " " + title : "") : "";
        const orgPart = org || "";
        const deptPart = dept || "";

        const fullLine = [orgPart, deptPart, namePart].filter(Boolean).join(" ");

        if (tone === "business_formal") {
          if (fullLine) {
            lines.push(fullLine + " ê·€ì¤‘");
            lines.push("");
          }
          lines.push("ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ. ì›”ë“œì‚°ì—…ì •ë³´ì„¼í„°ì…ë‹ˆë‹¤.");
        } else if (tone === "light_polite") {
          if (name) {
            lines.push(name + " ì—°êµ¬ìë‹˜,");
          } else if (org) {
            lines.push(org + " ë‹´ë‹¹ìë‹˜ê»˜,");
          }
          lines.push("");
          lines.push("ì›”ë“œì‚°ì—…ì •ë³´ì„¼í„°ì—ì„œ ì¸ì‚¬ë“œë¦½ë‹ˆë‹¤.");
        } else {
          if (fullLine) {
            lines.push(fullLine + " ê·€í•˜");
            lines.push("");
          }
          lines.push("ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ. ì›”ë“œì‚°ì—…ì •ë³´ì„¼í„°ì…ë‹ˆë‹¤.");
        }
        return lines.join("\n");
      }

      function buildIntro(type, field, budget, keywords) {
        const lines = [];
        const fieldText = field ? field : "ê´€ì‹¬ ë¶„ì•¼";
        const keywordList = (keywords || "")
          .split(",")
          .map((k) => k.trim())
          .filter(Boolean);

        if (type === "existing") {
          lines.push(
            "í•­ìƒ ì €í¬ ì›”ë“œì‚°ì—…ì •ë³´ì„¼í„°ë¥¼ ì´ìš©í•´ ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤."
          );
          lines.push(
            "ì´ì „ì— ì•ˆë‚´ë“œë¦° ìë£Œì— ì´ì–´, ì•„ë˜ì™€ ê°™ì´ ì¶”ê°€ë¡œ ì°¸ê³ í•˜ì‹¤ ìˆ˜ ìˆëŠ” ì‹œì¥Â·ê¸°ìˆ ìë£Œë¥¼ ì •ë¦¬í•´ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤."
          );
        } else if (type === "revisit") {
          lines.push(
            "ì´ì „ì— ë¬¸ì˜ ì£¼ì…¨ë˜ ë‚´ìš©ê³¼ ê´€ë ¨í•˜ì—¬, ìµœì‹  ìë£Œì™€ ì—…ë°ì´íŠ¸ëœ ì •ë³´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ë‹¤ì‹œ í•œë²ˆ ì •ë¦¬í•´ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤."
          );
        } else {
          lines.push(
            "ê·€í•˜ì˜ " +
              fieldText +
              " ê´€ë ¨ ê²€í†  ë° ì—°êµ¬ì— ë„ì›€ì´ ë  ìˆ˜ ìˆëŠ” ì‹œì¥Â·ê¸°ìˆ ìë£Œë¥¼ ì•„ë˜ì™€ ê°™ì´ ì œì•ˆë“œë¦½ë‹ˆë‹¤."
          );
        }

        if (budget || keywordList.length) {
          lines.push("");
          if (budget) {
            lines.push("Â· ì˜ˆìƒ ì˜ˆì‚°/ì—°êµ¬ë¹„: " + budget);
          }
          if (keywordList.length) {
            lines.push("Â· í•µì‹¬ í‚¤ì›Œë“œ: " + keywordList.join(", "));
          }
        }

        return lines.join("\n");
      }

      function buildReportList(rawReports) {
        const lines = [];
        const items = (rawReports || "")
          .split("\n")
          .map((l) => l.trim())
          .filter(Boolean);

        if (!items.length) {
          return "";
        }

        lines.push("");
        lines.push("[ì œì•ˆ ë“œë¦¬ëŠ” ì£¼ìš” ë³´ê³ ì„œ/ìë£Œ ëª©ë¡]");
        items.forEach((item, idx) => {
          lines.push(String(idx + 1) + ". " + item);
        });

        return lines.join("\n");
      }

      function buildDetailMemo(detailMemo) {
        if (!detailMemo || !detailMemo.trim()) return "";
        const lines = [];
        lines.push("");
        lines.push("[ê³ ê° ìš”ì²­ ë° ë©”ëª¨ ìš”ì•½]");
        lines.push(detailMemo.trim());
        return lines.join("\n");
      }

      function buildClosing(channel) {
        const lines = [];
        lines.push("");
        lines.push("ìƒê¸° ìë£Œ ì™¸ì—ë„ ì¶”ê°€ë¡œ í•„ìš”í•˜ì‹  ì£¼ì œê°€ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ì—°ë½ ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.");

        if (channel === "email") {
          lines.push(
            "ê²€í†  í›„ íšŒì‹  ì£¼ì‹œë©´, ê·€ ê¸°ê´€ì˜ ê²€í† Â·êµ¬ë§¤ ì ˆì°¨ì— ë§ì¶”ì–´ ê²¬ì ì„œ ë° ê´€ë ¨ ì„œë¥˜ë¥¼ ì‹ ì†íˆ ì „ë‹¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
          );
        } else if (channel === "word") {
          lines.push(
            "ë‚´ë¶€ ê²°ì¬ìš© ìë£Œë‚˜ ì¶”ê°€ ì„œë©´ ì•ˆë‚´ê°€ í•„ìš”í•˜ì‹  ê²½ìš°, ë³„ë„ì˜ ì›Œë“œ/ì¸ì‡„ìš© ì•ˆë‚´ë¬¸ë„ í•¨ê»˜ ì œê³µí•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
          );
        } else {
          lines.push(
            "ì´ë©”ì¼ ë° ì›Œë“œ íŒŒì¼ ì–‘ì‹ìœ¼ë¡œ ëª¨ë‘ ì œê³µ ê°€ëŠ¥í•˜ì˜¤ë‹ˆ, ì„ í˜¸í•˜ì‹œëŠ” ë°©ì‹ìœ¼ë¡œ ì•Œë ¤ ì£¼ì‹œë©´ ì¦‰ì‹œ ì¤€ë¹„í•˜ê² ìŠµë‹ˆë‹¤."
          );
        }

        lines.push("");
        lines.push("ê°ì‚¬í•©ë‹ˆë‹¤.");
        lines.push("");
        lines.push("ì›”ë“œì‚°ì—…ì •ë³´ì„¼í„° ë“œë¦¼");

        return lines.join("\n");
      }

      function buildFullLetter() {
        const name = inputName.value.trim();
        const title = inputTitle.value.trim();
        const org = inputOrg.value.trim();
        const dept = inputDept.value.trim();
        const field = inputField.value.trim();
        const budget = inputBudget.value.trim();
        const email = inputEmail.value.trim();
        const shortMemo = inputShortMemo.value.trim();
        const type = selectType.value;
        const tone = selectTone.value;
        const keywords = inputKeywords.value.trim();
        const channel = selectChannel.value;
        const reports = textareaReports.value;
        const detailMemo = textareaDetailMemo.value;

        const hasBasic =
          name || org || field || email || shortMemo || reports || detailMemo;

        if (!hasBasic) {
          alert("ìµœì†Œí•œ ì´ë¦„Â·ê¸°ê´€Â·ì—°êµ¬ë¶„ì•¼ ë˜ëŠ” ë³´ê³ ì„œ ëª©ë¡ ì¤‘ 1ê°œ ì´ìƒì€ ì…ë ¥í•´ì•¼ ì•ˆë‚´ì„œë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
          return null;
        }

        const parts = [];

        parts.push(buildGreeting(tone, name, title, org, dept));
        parts.push("");
        parts.push(buildIntro(type, field, budget, keywords));
        parts.push(buildReportList(reports));
        parts.push(buildDetailMemo(detailMemo || shortMemo));
        parts.push(buildClosing(channel));

        const letter = parts.join("\n").replace(/\n{3,}/g, "\n\n");
        return {
          letter,
          meta: {
            name,
            title,
            org,
            field,
            channel,
          },
        };
      }

      function applyPreviewText(rawText) {
        if (!rawText) {
          previewEmpty.style.display = "block";
          previewFormatted.style.display = "none";
          previewPlain.style.display = "none";
          previewPlain.value = "";
          return;
        }

        previewEmpty.style.display = "none";
        previewFormatted.style.display = "block";
        previewPlain.style.display = "none";

        const safe = escapeHtml(rawText);
        const paragraphs = safe.split(/\n{2,}/).map((p) => p.trim());
        previewFormatted.innerHTML = paragraphs
          .map((p) => "<p style='margin:0 0 8px;'>" + p.replace(/\n/g, "<br />") + "</p>")
          .join("");

        previewPlain.value = rawText;
      }

      function updatePreviewState(has) {
        previewState.textContent = has
          ? "ì•ˆë‚´ì„œ ìƒíƒœ: ìƒì„±ë¨"
          : "ì•ˆë‚´ì„œ ìƒíƒœ: ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
      }

      function switchPreviewTab(mode) {
        if (mode === "formatted") {
          tabFormatted.classList.add("active");
          tabPlain.classList.remove("active");
          if (previewPlain.value.trim()) {
            const safe = escapeHtml(previewPlain.value);
            const paragraphs = safe.split(/\n{2,}/).map((p) => p.trim());
            previewFormatted.innerHTML = paragraphs
              .map(
                (p) => "<p style='margin:0 0 8px;'>" + p.replace(/\n/g, "<br />") + "</p>"
              )
              .join("");
          }
          previewFormatted.style.display = previewEmpty.style.display === "block" ? "none" : "block";
          previewPlain.style.display = "none";
        } else {
          tabPlain.classList.add("active");
          tabFormatted.classList.remove("active");
          if (previewPlain.value.trim()) {
            previewPlain.style.display = "block";
            previewFormatted.style.display = "none";
          } else if (previewFormatted.innerHTML.trim()) {
            // í¬ë§· â†’ í…ìŠ¤íŠ¸ ì—­ë³€í™˜ì€ ê°„ë‹¨ ì²˜ë¦¬ (innerText ì‚¬ìš©)
            previewPlain.value = previewFormatted.innerText.trim();
            previewPlain.style.display = "block";
            previewFormatted.style.display = "none";
          } else {
            previewPlain.style.display = "none";
          }
        }
      }

      function recalcCountsOnGenerate() {
        const now = new Date();
        const todayKey =
          now.getFullYear() +
          "-" +
          String(now.getMonth() + 1).padStart(2, "0") +
          "-" +
          String(now.getDate()).padStart(2, "0");

        const raw = localStorage.getItem(STORAGE_KEY);
        const prev = safeParse(raw, {}) || {};
        let total = prev.totalCount || 0;
        let today = prev.todayCount || 0;
        const lastDateKey = prev.lastGeneratedDateKey || "";

        total += 1;
        if (lastDateKey === todayKey) {
          today += 1;
        } else {
          today = 1;
        }

        const lastText = formatDateTime(now);
        statTotalCount.textContent = String(total);
        statTodayCount.textContent = String(today);
        statLastTime.textContent = lastText;

        return {
          totalCount: total,
          todayCount: today,
          lastGeneratedAtText: lastText,
          lastGeneratedDateKey: todayKey,
        };
      }

      function onGenerateClick() {
        const result = buildFullLetter();
        if (!result) return;

        applyPreviewText(result.letter);
        updatePreviewState(true);
        switchPreviewTab("formatted");

        const countInfo = recalcCountsOnGenerate();
        saveState(
          Object.assign({}, countInfo, {
            previewRaw: result.letter,
          })
        );
      }

      function onAppendMemo() {
        const memo = textareaDetailMemo.value.trim() || inputShortMemo.value.trim();
        if (!memo) {
          alert("ë§ë¶™ì¼ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒì„¸ ë©”ëª¨ ë˜ëŠ” ì§§ì€ ë©”ëª¨ë¥¼ ë¨¼ì € ì…ë ¥í•´ ì£¼ì„¸ìš”.");
          return;
        }

        let current = previewPlain.value.trim();
        if (!current) {
          alert("ë¨¼ì € ì•ˆë‚´ì„œë¥¼ ìƒì„±í•œ ë’¤ì— ë©”ëª¨ë¥¼ ë§ë¶™ì´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.");
          return;
        }

        current += "\n\n[ì¶”ê°€ ë©”ëª¨]\n" + memo;
        previewPlain.value = current;
        applyPreviewText(current);
        switchPreviewTab("formatted");

        saveState({
          previewRaw: current,
        });
      }

      function onClearInputs() {
        if (!window.confirm("ê³ ê° ê¸°ë³¸ ì •ë³´ì™€ ì˜µì…˜ ì…ë ¥ ë‚´ìš©ì„ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          return;
        }
        inputName.value = "";
        inputTitle.value = "";
        inputOrg.value = "";
        inputDept.value = "";
        inputField.value = "";
        inputBudget.value = "";
        inputEmail.value = "";
        inputShortMemo.value = "";
        selectType.value = "new";
        selectTone.value = "researcher_polite";
        inputKeywords.value = "";
        selectChannel.value = "email";
        textareaReports.value = "";
        textareaDetailMemo.value = "";
        setBasicInfoState();
        optionState.textContent = "ì˜µì…˜ ìƒíƒœ: ê¸°ë³¸ê°’ ì‚¬ìš© ì¤‘";

        saveState();
      }

      function onCopy() {
        const text = previewPlain.value.trim();
        if (!text) {
          alert("ë³µì‚¬í•  ì•ˆë‚´ì„œê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì•ˆë‚´ì„œë¥¼ ìƒì„±í•´ ì£¼ì„¸ìš”.");
          return;
        }
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(text)
            .then(() => {
              previewMeta.textContent =
                "í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼/ì›Œë“œì— ë°”ë¡œ ë¶™ì—¬ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
            })
            .catch(() => {
              alert("ë³µì‚¬ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í•„ìš”í•˜ë©´ ì§ì ‘ ë“œë˜ê·¸í•´ì„œ ë³µì‚¬í•´ ì£¼ì„¸ìš”.");
            });
        } else {
          alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìë™ ë³µì‚¬ê°€ ì§€ì›ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•„ìš”í•˜ë©´ ì§ì ‘ ë³µì‚¬í•´ ì£¼ì„¸ìš”.");
        }
      }

      function onAddSeparator() {
        const text = previewPlain.value.trim();
        const sep = "\n\n------------------------------\n";
        const next = text ? text + sep : "------------------------------\n";
        previewPlain.value = next;
        applyPreviewText(next);
        switchPreviewTab("formatted");
        saveState({
          previewRaw: next,
        });
      }

      function calcNextSummary() {
        const actions = [];

        if (chkCall.checked) {
          const d = dateCall.value ? " (" + dateCall.value + ")" : "";
          actions.push("ì „í™” ìƒë‹´ ì˜ˆì •" + d);
        }
        if (chkMail.checked) {
          const d = dateMail.value ? " (" + dateMail.value + ")" : "";
          actions.push("ì•ˆë‚´ ë©”ì¼ ë°œì†¡/íšŒì‹  ëŒ€ê¸°" + d);
        }
        if (chkQuote.checked) {
          const d = dateQuote.value ? " (" + dateQuote.value + ")" : "";
          actions.push("ê³µì‹ ê²¬ì ì„œ/ì¸ë³´ì´ìŠ¤ ë°œì†¡" + d);
        }
        if (chkBid.checked) {
          const d = dateBid.value ? " (" + dateBid.value + ")" : "";
          actions.push("ì…ì°°/ì¡°ë‹¬ ë“±ë¡ ì¤€ë¹„" + d);
        }

        if (!actions.length) {
          return "ì²´í¬ëœ í›„ì† ì¡°ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.";
        }
        return actions.join(" â†’ ");
      }

      function onRecalcFollow() {
        const summary = calcNextSummary();
        nextSummary.innerHTML =
          "<strong>ë‹¤ìŒ í•  ì¼ ìš”ì•½</strong><br /><span>" +
          escapeHtml(summary) +
          "</span>";
      }

      function onSaveFollow() {
        const summary = calcNextSummary();

        nextSummary.innerHTML =
          "<strong>ë‹¤ìŒ í•  ì¼ ìš”ì•½</strong><br /><span>" +
          escapeHtml(summary) +
          "</span>";
        followState.textContent = "í›„ì† ì¡°ì¹˜ ìƒíƒœ: ì €ì¥ë¨";

        saveState({
          followSummary: summary,
        });
      }

      function onClearFollow() {
        if (!window.confirm("í›„ì† ì¡°ì¹˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ì™€ ë©”ëª¨ë¥¼ ëª¨ë‘ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          return;
        }
        chkCall.checked = false;
        chkMail.checked = false;
        chkQuote.checked = false;
        chkBid.checked = false;
        dateCall.value = "";
        dateMail.value = "";
        dateQuote.value = "";
        dateBid.value = "";
        textareaFollowMemo.value = "";
        nextSummary.innerHTML =
          "<strong>ë‹¤ìŒ í•  ì¼ ìš”ì•½</strong><br /><span>ì•„ì§ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤.</span> ì²´í¬ë¦¬ìŠ¤íŠ¸ ì„ íƒ í›„ ã€Œìš”ì•½ ë‹¤ì‹œ ê³„ì‚°ã€ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.";
        followState.textContent = "í›„ì† ì¡°ì¹˜ ìƒíƒœ: ë¯¸ì €ì¥";

        saveState({
          followSummary: "",
        });
      }

      function init() {
        updateMetaReady("ë¡œì»¬ ìƒíƒœë¥¼ ì¤€ë¹„í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...");
        loadState();
        setBasicInfoState();
      }

      // ì´ë²¤íŠ¸
      [inputName, inputOrg, inputField].forEach((el) => {
        el.addEventListener("input", () => {
          setBasicInfoState();
          saveState();
        });
      });

      [
        inputTitle,
        inputBudget,
        inputEmail,
        inputShortMemo,
        inputKeywords,
        textareaReports,
        textareaDetailMemo,
      ].forEach((el) => {
        el.addEventListener("input", () => {
          saveState();
        });
      });

      selectType.addEventListener("change", () => {
        optionState.textContent = "ì˜µì…˜ ìƒíƒœ: ì‚¬ìš©ì ì§€ì •";
        saveState();
      });
      selectTone.addEventListener("change", () => {
        optionState.textContent = "ì˜µì…˜ ìƒíƒœ: ì‚¬ìš©ì ì§€ì •";
        saveState();
      });
      selectChannel.addEventListener("change", () => {
        optionState.textContent = "ì˜µì…˜ ìƒíƒœ: ì‚¬ìš©ì ì§€ì •";
        saveState();
      });

      btnGenerate.addEventListener("click", onGenerateClick);
      btnAppendMemo.addEventListener("click", onAppendMemo);
      btnClearInputs.addEventListener("click", onClearInputs);

      tabFormatted.addEventListener("click", () => switchPreviewTab("formatted"));
      tabPlain.addEventListener("click", () => switchPreviewTab("plain"));

      btnCopy.addEventListener("click", onCopy);
      btnAddSeparator.addEventListener("click", onAddSeparator);

      [chkCall, chkMail, chkQuote, chkBid, dateCall, dateMail, dateQuote, dateBid].forEach(
        (el) => {
          el.addEventListener("change", () => {
            saveState();
          });
        }
      );
      textareaFollowMemo.addEventListener("input", () => saveState());

      btnRecalcFollow.addEventListener("click", onRecalcFollow);
      btnSaveFollow.addEventListener("click", onSaveFollow);
      btnClearFollow.addEventListener("click", onClearFollow);

      document.addEventListener("DOMContentLoaded", init);
    })();
  </script>
</body>
</html>
